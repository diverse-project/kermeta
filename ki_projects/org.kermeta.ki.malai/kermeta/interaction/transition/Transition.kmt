/*
 * Creation : February 22, 2010
 * Licence  : EPL 
 * Copyright:
 * Authors  : Arnaud Blouin
 */

package kermeta::ki::malai::interaction;


require kermeta
require "platform:/resource/org.kermeta.ki.malai/kermeta/interaction/State.kmt"
require "platform:/resource/org.kermeta.ki.malai/kermeta/interaction/event/MouseEvent.kmt"
require "platform:/resource/org.kermeta.ki.malai/kermeta/interaction/event/KeyEvent.kmt"
require "platform:/resource/org.kermeta.ki.malai/kermeta/widget/Widget.kmt"

using kermeta::standard
using kermeta::ki::malai::interaction::event
using kermeta::ki::malai::widget


abstract class Transition
{
	reference inputState : State
	
	reference outputState : State
	
	
	operation initialise(inputState : State, outputState : State) : Void is do
		if(inputState.isVoid or outputState.isVoid) then raise kermeta::exceptions::Exception.new end
		
		if(inputState.isInstanceOf(AbortingState) or inputState.isInstanceOf(TerminalState)) then
			var ex : kermeta::exceptions::Exception init kermeta::exceptions::Exception.new
			ex.message := "Input state cannot be an ending nor an aborting state."
			raise ex
		end
		
		if(outputState.isInstanceOf(InitState)) then
			var ex : kermeta::exceptions::Exception init kermeta::exceptions::Exception.new
			ex.message := "Onput state cannot be an init state."
			raise ex
		end
		
		self.inputState  := inputState
		self.outputState := outputState
		
		self.inputState.transitions.add(self)
	end
	
	
	operation action() : Void is do end

	
	operation isGuardRespected() : Boolean is do
		result := true
	end
	
	
	method toString() : String is do
		result := super + "[" + inputState.name + ">>" + outputState.name + "]"
	end
}







class ButtonPressedTransition inherits Transition {
	reference button : Button
}



class KeyPressureTransition inherits KeyboardTransition {
}




class KeyReleaseTransition inherits KeyboardTransition {
}



class MoveTransition inherits PointingDeviceTransition {
	attribute pressed : Boolean
	
	method initialise(inputState : State, outputState : State) : Void is do
		super(inputState, outputState)
		
		pressed := false
	end
}




abstract class PointingDeviceTransition inherits Transition {
	attribute px : Real
	
	attribute py : Real
	
	attribute button : Integer
	
	
	
	method initialise(inputState : State, outputState : State) : Void is do
		super(inputState, outputState)

		px := void
		py := void
		button := void
	end
}



class PressureTransition inherits PointingDeviceTransition {
}




class ReleaseTransition inherits PointingDeviceTransition {
}




class TextChangedTransition inherits Transition {
	attribute textCompName : String
	
	attribute text : String
}





abstract class KeyboardTransition inherits Transition {
	attribute key : Integer
	
	method initialise(inputState : State, outputState : State) : Void is do
		super(inputState, outputState)
		
		key := -1
	end
}
