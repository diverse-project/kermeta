/* $Id:$ 
 * Creation : February 24, 2010
 * Licence  : EPL 
 * Copyright:
 * Authors  : Arnaud Blouin
 */

package kermeta::ki::malai::dispatcher;


require kermeta

using kermeta::standard


abstract class AbstractDispatcher
{
	attribute running : Boolean
	
	
	operation run() : Void is abstract
}




abstract class Dispatchable
{
	operation isWaiting() : Boolean is abstract
	
	operation run() : Void is abstract
	
	operation sleep() : Void is abstract
}



class SingleDisptacher inherits AbstractDispatcher 
{
	reference component : Dispatchable
	
	
	method run() : Void is do
		from running := true
		until not running
		loop
			do
				if(component.isWaiting) then component.run() end
				component.sleep()
			rescue(ex : kermeta::exceptions::Exception) running := false end
		end
	end
}



class ListDisptacher inherits AbstractDispatcher
{
	reference components : Dispatchable[0..*]
	
	
	method run() : Void is do
		from running := true
		until not running
		loop
			do
				components.each{c| 
					if(c.isWaiting) then c.run() end
					c.sleep()
				}
			rescue(ex : kermeta::exceptions::Exception) running := false end
		end
	end
}
