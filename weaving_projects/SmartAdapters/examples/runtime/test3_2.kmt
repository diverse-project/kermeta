/* $Id: test3_2.kmt,v 1.1 2008-05-30 08:20:20 bmorin Exp $
 * Creation date: March 19, 2008
 * License:
 * Copyright: IRISA / INRIA Rennes Bretagne Atlantique
 * Authors: Brice Morin bmorin@irisa.fr
 */
@mainClass "test::TestRuntime3_2"
@mainOperation "main"


package test;
require kermeta

//Loading the aspect weaver (optional, we can use directly Kermeta or another tool like Kompose)
require "platform:/resource/SmartAdapters/program/weaving/weaver4Runtime.kmt"

using kermeta::standard 
using kermeta::utils
using weaver

class TestRuntime3_2
{
	operation main() : Void is do 
		stdio.writeln("K> ###START###")
		var modelUri : String init "platform:/resource/SmartAdapters/examples/runtime/model/referenceModel.art"
		var wovenModelUri : String init "platform:/resource/SmartAdapters/examples/runtime/model/wovenModel.art"
		var metamodelUri : String init "platform:/resource/SmartAdapters/metamodel/domain/metamodel@runtime.ecore"
			
		var adapterUri : String init "platform:/resource/SmartAdapters/examples/runtime/Adapter2.xmi"
		var adaptMMUri : String init "platform:/resource/SmartAdapters/metamodel/specific/runtime_AOM_Framework1.ecore"
		var MMPatternUri : String init "platform:/resource/SmartAdapters/metamodel/domain/metamodel@runtimePattern.ecore"

		var weaver:Weaver init Weaver.new
		weaver.initWeaver()
		weaver.loadMetamodel(metamodelUri)
		weaver.loadMetamodelPattern(MMPatternUri)
		weaver.loadModel(modelUri,"http://art"/*metamodelUri*/)
		weaver.loadAdapter(adapterUri, adaptMMUri)
		weaver.initDefaultValues()
		
		stdio.writeln("K> Aspect weaving with SmartAdapters...")
		weaver.weaving(metamodelUri, MMPatternUri)
		weaver.saveModel(wovenModelUri,"http://art"/*metamodelUri*/)
		stdio.writeln("K> OK!")
			
		weaver.finalizeWeaver()
		stdio.writeln("K> ###END###")
	end
}