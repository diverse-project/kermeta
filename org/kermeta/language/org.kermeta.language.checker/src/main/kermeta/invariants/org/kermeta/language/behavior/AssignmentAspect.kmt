/* $Id:$ 
 * Creation : September 28, 2011
 * Licence  : EPL 
 * Copyright:
 * Authors  : 
 *            jfalcou
 */

package org::kermeta::language::behavior;


require kermeta

require "platform:/lookup/org.kermeta.language.model/src/main/ecore/kermeta.ecore"

require "platform:/lookup/org.kermeta.language.mdk/src/kmt/language/helpers/structure/IsSubtypeOf.kmt"

using org::kermeta::language::structure
using kermeta::utils

aspect class Assignment
{
	/**
	 * You are trying to overwrite the internal reflective collection of the property.
	 * Did you mean to use clear or addAll ?
	 */
	@Scope "RESOLVED"
	inv no_internal_reflexive_collection_att_overwrite is do
	
		//stdio.writeln("Checking assignment : " + self.toString)
		//stdio.writeln(" the target : " + self.target.toString)
		if (self.target.isInstanceOf(CallProperty))
		then
			stdio.writeln(self.target.asType(CallProperty).staticProperty.upper.toString)
			not(self.target.asType(CallProperty).staticProperty.upper != 1)
		else
			true
		end
	end

	/**
	 * Type mismatch. Value does not match the variable's type
	 */
	@Scope "RESOLVED"
	inv type_mismatch is do
		
		//stdio.writeln("Assignment type_mismatch check")
		if ((not(self.isCast.isVoid)).andThen{b| not(self.isCast)})
		then
			var typeVariableToSet : Hashtable<TypeVariable, Type> init Hashtable<TypeVariable, Type>.new
			self.~value.staticType.isSubTypeOf(self.target.staticType,typeVariableToSet)
		else
			true
			
		end
		
	end
}
