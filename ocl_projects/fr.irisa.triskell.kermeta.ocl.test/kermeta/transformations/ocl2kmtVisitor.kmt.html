<html>
<head>
<title>~/runtime-EclipseApplication/fr.irisa.triskell.kermeta.ocl/kermeta/transformations/ocl2kmtVisitor.kmt.html</title>
<meta name="Generator" content="Vim/7.0">
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
</head>
<body bgcolor="#ffffff" text="#111111">
<pre>
<font color="#33cc99"><i>/* $Id: ocl2kmtVisitor.kmt.html,v 1.1 2007-12-07 04:17:32 ffleurey Exp $</i></font>
<font color="#33cc99"><i> * Creation date: February 5, 2007</i></font>
<font color="#33cc99"><i> * License:</i></font>
<font color="#33cc99"><i> * Copyright:</i></font>
<font color="#33cc99"><i> * Authors:</i></font>
<font color="#33cc99"><i> */</i></font>
@mainClass <font color="#cc0099"><b>&quot;::&quot;</b></font>
@mainOperation <font color="#cc0099"><b>&quot;&quot;</b></font>


<font color="#3399ff"><b>package</b></font> ocl2kmt;

<font color="#3399ff"><b>require</b></font> kermeta
<font color="#3399ff"><b>require</b></font> <font color="#cc0099"><b>&quot;../../mmodel/oclcstvisitor.kmt&quot;</b></font>
<font color="#3399ff"><b>require</b></font> <font color="#cc0099"><b>&quot;OperatorPolicies.kmt&quot;</b></font>
<font color="#3399ff"><b>require</b></font> <font color="#cc0099"><b>&quot;platform:/resource/fr.irisa.triskell.kermeta.ecore/src/kermeta/helpers/EcoreHelper.kmt&quot;</b></font>

<font color="#3399ff"><b>using</b></font> kermeta::standard
<font color="#3399ff"><b>using</b></font> kermeta::exceptions
<font color="#3399ff"><b>using</b></font> ocl::cst
<font color="#3399ff"><b>using</b></font> ocl::cst::visitors
<font color="#3399ff"><b>using</b></font> kermeta::utils
<font color="#3399ff"><b>using</b></font> kermeta::io

<font color="#3399ff"><b>class</b></font> StringWriter <font color="#3399ff"><b>inherits</b></font> StdIO
{

    <font color="#3399ff"><b>reference</b></font> s: String

    <font color="#3399ff"><b>method</b></font> write(object: String) <font color="#3399ff"><b>is</b></font>
        <font color="#3399ff"><b>do</b></font>
            <font color="#3399ff"><b>if</b></font> s == <font color="#3399ff"><b>void</b></font> <font color="#3399ff"><b>then</b></font>
                s := object
            <font color="#3399ff"><b>else</b></font>
                s := s + object
            <font color="#3399ff"><b>end</b></font>
        <font color="#3399ff"><b>end</b></font>

    <font color="#3399ff"><b>method</b></font> writeln(object: String) <font color="#3399ff"><b>is</b></font>
        <font color="#3399ff"><b>do</b></font>
            <font color="#3399ff"><b>self</b></font>.write(object)
            <font color="#3399ff"><b>self</b></font>.write(<font color="#cc0099"><b>&quot; &quot;</b></font>)
        <font color="#3399ff"><b>end</b></font>

    <font color="#3399ff"><b>method</b></font> read(prompt: String): String <font color="#3399ff"><b>is</b></font>
        <font color="#3399ff"><b>do</b></font>
            <font color="#3399ff"><b>var</b></font> e: Exception <font color="#3399ff"><b>init</b></font> Exception.new
            e.message := <font color="#cc0099"><b>&quot;Sorry, you can't read from a writer&quot;</b></font>
            <font color="#3399ff"><b>raise</b></font> e
        <font color="#3399ff"><b>end</b></font>
}

 <font color="#3399ff"><b>class</b></font> Ocl2kmtVisitor <font color="#3399ff"><b>inherits</b></font> ocl::cst::visitors::Visitor {


        <font color="#3399ff"><b>reference</b></font> ecoreHelper : EcoreHelpers::EcoreHelper
        <font color="#3399ff"><b>reference</b></font>  __io: StdIO

        <font color="#3399ff"><b>operation</b></font> getIo(): StdIO <font color="#3399ff"><b>is</b></font>
            <font color="#3399ff"><b>do</b></font>
                <font color="#3399ff"><b>if</b></font> __io == <font color="#3399ff"><b>void</b></font> <font color="#3399ff"><b>then</b></font>
                    __io := stdio
                <font color="#3399ff"><b>end</b></font>
                <font color="#3399ff"><b>result</b></font> := __io
            <font color="#3399ff"><b>end</b></font>

        <font color="#33cc99"><i>/**</i></font>
<font color="#33cc99"><i>         * Use this to set a string writer to get the generated source as a string</i></font>
<font color="#33cc99"><i>         */</i></font>
        <font color="#3399ff"><b>operation</b></font> setIo(newio: StdIO) <font color="#3399ff"><b>is</b></font>
            <font color="#3399ff"><b>do</b></font>
                <font color="#3399ff"><b>self</b></font>.__io := newio
            <font color="#3399ff"><b>end</b></font>

        <font color="#3399ff"><b>operation</b></font> write(s: String) : <font color="#3399ff"><b>Void</b></font> <font color="#3399ff"><b>is</b></font>
            <font color="#3399ff"><b>do</b></font>
                getIo.write(s)
            <font color="#3399ff"><b>end</b></font>

        <font color="#3399ff"><b>operation</b></font> writeln(s: String): <font color="#3399ff"><b>Void</b></font> <font color="#3399ff"><b>is</b></font>
            <font color="#3399ff"><b>do</b></font>
                getIo.writeln(s)
            <font color="#3399ff"><b>end</b></font>


        <font color="#3399ff"><b>attribute</b></font> __name : Integer

        <font color="#3399ff"><b>operation</b></font> nextName(root: String) : String <font color="#3399ff"><b>is</b></font>
            <font color="#3399ff"><b>do</b></font>
                <font color="#3399ff"><b>if</b></font> __name == <font color="#3399ff"><b>void</b></font> <font color="#3399ff"><b>then</b></font>
                    __name := 0
                <font color="#3399ff"><b>end</b></font>
                __name := __name + 1
                <font color="#3399ff"><b>result</b></font> := root + __name.toString
            <font color="#3399ff"><b>end</b></font>

        <font color="#3399ff"><b>operation</b></font> visit(visitable : Visitable) : <font color="#3399ff"><b>Void</b></font> <font color="#3399ff"><b>is</b></font>
            <font color="#3399ff"><b>do</b></font>
                write( visitable.toString)
            <font color="#3399ff"><b>end</b></font>

        <font color="#3399ff"><b>method</b></font> visitCSTNode(visitable : CSTNode) : <font color="#3399ff"><b>Void</b></font> <font color="#3399ff"><b>is</b></font>
            <font color="#3399ff"><b>do</b></font>
                visit(visitable)
            <font color="#3399ff"><b>end</b></font>

        <font color="#3399ff"><b>method</b></font> visitPackageDeclarationCS(visitable : PackageDeclarationCS) : <font color="#3399ff"><b>Void</b></font> <font color="#3399ff"><b>is</b></font>
            <font color="#3399ff"><b>do</b></font>

                <font color="#3399ff"><b>self</b></font>.pathExpression := String.new
                <font color="#3399ff"><b>self</b></font>.previousIsMultiple := <font color="#3399ff"><b>false</b></font>
                pathContextCounter :=0
                currentPackagename :=<font color="#cc0099"><b>&quot;&quot;</b></font>
                visitable.pathNameCS.sequenceOfNames.each{ e | currentPackagename := currentPackagename + <font color="#cc0099"><b>&quot;::&quot;</b></font>+e}
                currentPackagename:=currentPackagename.substring(2,currentPackagename.size)
                write(<font color="#cc0099"><b>&quot;package &quot;</b></font>)
                visitable.pathNameCS.accept(<font color="#3399ff"><b>self</b></font>)
                writeln(<font color="#cc0099"><b>&quot;;\n&quot;</b></font>)
                write(<font color="#cc0099"><b>&quot;require kermeta \n&quot;</b></font>)
                write(<font color="#cc0099"><b>&quot;require \&quot;&quot;)</b></font>
                visitable.pathNameCS.accept(<font color="#3399ff"><b>self</b></font>)
                write(<font color="#cc0099"><b>&quot;.ecore\&quot;</b></font>\n<font color="#cc0099"><b>&quot;)</b></font>

                write(<font color="#cc0099"><b>&quot;using kermeta::standard \n&quot;</b></font>)

                visitable.contextDecls.each{ c |
                        c.accept(<font color="#3399ff"><b>self</b></font>)
                    }
            <font color="#3399ff"><b>end</b></font>

        <font color="#3399ff"><b>reference</b></font> currentPackagename : String
        <font color="#3399ff"><b>reference</b></font> currentClassifiername : String
        <font color="#3399ff"><b>reference</b></font> currentOperationname : String

        <font color="#3399ff"><b>method</b></font> visitContextDeclCS(visitable : ContextDeclCS) : <font color="#3399ff"><b>Void</b></font> <font color="#3399ff"><b>is</b></font>
            <font color="#3399ff"><b>do</b></font>
                visit(visitable)
            <font color="#3399ff"><b>end</b></font>

        <font color="#3399ff"><b>method</b></font> visitPropertyContextCS(visitable : PropertyContextCS) : <font color="#3399ff"><b>Void</b></font> <font color="#3399ff"><b>is</b></font>
            <font color="#3399ff"><b>do</b></font>
                visit(visitable)
            <font color="#3399ff"><b>end</b></font>

        <font color="#3399ff"><b>method</b></font> visitClassifierContextDeclCS(visitable : ClassifierContextDeclCS) : <font color="#3399ff"><b>Void</b></font> <font color="#3399ff"><b>is</b></font>
            <font color="#3399ff"><b>do</b></font>
                currentClassifiername :=<font color="#cc0099"><b>&quot;&quot;</b></font>
                visitable.pathNameCS.sequenceOfNames.each{ e | currentClassifiername := currentClassifiername + <font color="#cc0099"><b>&quot;::&quot;</b></font>+e}
                currentClassifiername:=currentClassifiername.substring(2,currentClassifiername.size)
                <font color="#33cc99"><i>//writeln(currentClassifiername )</i></font>
                writeln(<font color="#cc0099"><b>&quot;@aspect \&quot;</b></font><font color="#3399ff"><b>true</b></font>\<font color="#cc0099"><b>&quot;&quot;</b></font>)
                write(<font color="#cc0099"><b>&quot;class &quot;</b></font>)
                visitable.pathNameCS.accept(<font color="#3399ff"><b>self</b></font>)
                writeln(<font color="#cc0099"><b>&quot;{&quot;</b></font>)
                visitable.invOrDefCS.accept(<font color="#3399ff"><b>self</b></font>)
                writeln(<font color="#cc0099"><b>&quot;}&quot;</b></font>)
            <font color="#3399ff"><b>end</b></font>
            <font color="#3399ff"><b>attribute</b></font> currentContextClassifier : ecore::EClassifier

        <font color="#3399ff"><b>method</b></font> visitOperationContextDeclCS(visitable : OperationContextDeclCS) : <font color="#3399ff"><b>Void</b></font> <font color="#3399ff"><b>is</b></font>
            <font color="#3399ff"><b>do</b></font>

                currentClassifiername :=<font color="#cc0099"><b>&quot;&quot;</b></font>
                currentOperationname :=<font color="#cc0099"><b>&quot;&quot;</b></font>
                visitable.operationCS.pathNameCS.sequenceOfNames.each{ e | currentClassifiername := currentClassifiername + <font color="#cc0099"><b>&quot;::&quot;</b></font>+e}
                currentClassifiername:=currentClassifiername.substring(2,currentClassifiername.size)

                writeln(<font color="#cc0099"><b>&quot;@aspect \&quot;</b></font><font color="#3399ff"><b>true</b></font>\<font color="#cc0099"><b>&quot;&quot;</b></font>)
                write(<font color="#cc0099"><b>&quot;class &quot;</b></font>)
                visitable.operationCS.pathNameCS.accept(<font color="#3399ff"><b>self</b></font>)
                writeln(<font color="#cc0099"><b>&quot;{&quot;</b></font>)
                writeln(<font color="#cc0099"><b>&quot;@overloadable \&quot;</b></font><font color="#3399ff"><b>true</b></font>\<font color="#cc0099"><b>&quot;&quot;</b></font>)
                visitable.operationCS.accept(<font color="#3399ff"><b>self</b></font>)
                writeln(<font color="#cc0099"><b>&quot;&quot;</b></font>)
                visitable.prePostOrBodyDecls.each{ ppbd |
                    ppbd.accept(<font color="#3399ff"><b>self</b></font>)
                }
                writeln(<font color="#cc0099"><b>&quot;is&quot;</b></font>)
                writeln(<font color="#cc0099"><b>&quot;do&quot;</b></font>)
                writeln(<font color="#cc0099"><b>&quot;var e: Exception init NotImplementedException.new&quot;</b></font>)
                write(<font color="#cc0099"><b>&quot;e.message := \&quot;</b></font>OCL <font color="#3399ff"><b>pre</b></font>/<font color="#3399ff"><b>post</b></font>/body: <font color="#cc0099"><b>&quot; )</b></font>
                visitable.operationCS.pathNameCS.accept(<font color="#3399ff"><b>self</b></font>)
                write(<font color="#cc0099"><b>&quot;.&quot;</b></font>)
                visitable.operationCS.simpleNameCS.accept(<font color="#3399ff"><b>self</b></font>)
                writeln(<font color="#cc0099"><b>&quot;\&quot;&quot;)</b></font>
                writeln(<font color="#cc0099"><b>&quot;raise e&quot;</b></font>)
                writeln(<font color="#cc0099"><b>&quot;end&quot;</b></font>)
                writeln(<font color="#cc0099"><b>&quot;}&quot;</b></font>)
            <font color="#3399ff"><b>end</b></font>

        <font color="#3399ff"><b>method</b></font> visitPrePostOrBodyDeclCS(visitable : PrePostOrBodyDeclCS) : <font color="#3399ff"><b>Void</b></font> <font color="#3399ff"><b>is</b></font>
            <font color="#3399ff"><b>do</b></font>
                write(visitable.kind.name.toString)
                writeln(<font color="#cc0099"><b>&quot; &quot;</b></font> + nextName(visitable.kind.name.toString ))
                writeln(<font color="#cc0099"><b>&quot;is do&quot;</b></font>)
                visitable.expressionCS.accept(<font color="#3399ff"><b>self</b></font>)
                writeln(<font color="#cc0099"><b>&quot; end&quot;</b></font>)
            <font color="#3399ff"><b>end</b></font>


        <font color="#3399ff"><b>method</b></font> visitOperationCS(visitable : OperationCS) : <font color="#3399ff"><b>Void</b></font> <font color="#3399ff"><b>is</b></font>
            <font color="#3399ff"><b>do</b></font>
                currentOperationname := visitable.simpleNameCS.~<font color="#3399ff"><b>value</b></font>

                write(<font color="#cc0099"><b>&quot;operation &quot;</b></font>)
                visitable.simpleNameCS.accept(<font color="#3399ff"><b>self</b></font>)
                write(<font color="#cc0099"><b>&quot;(&quot;</b></font>)
                visitable.parameters.each{ p |
                        p.accept(<font color="#3399ff"><b>self</b></font>)
                    }
                write(<font color="#cc0099"><b>&quot;):&quot;</b></font>)
                visitable.typeCS.accept(<font color="#3399ff"><b>self</b></font>)
            <font color="#3399ff"><b>end</b></font>

        <font color="#3399ff"><b>method</b></font> visitInitOrDerValueCS(visitable : InitOrDerValueCS) : <font color="#3399ff"><b>Void</b></font> <font color="#3399ff"><b>is</b></font>
            <font color="#3399ff"><b>do</b></font>
                visit(visitable)
            <font color="#3399ff"><b>end</b></font>

        <font color="#3399ff"><b>method</b></font> visitDerValueCS(visitable : DerValueCS) : <font color="#3399ff"><b>Void</b></font> <font color="#3399ff"><b>is</b></font>
            <font color="#3399ff"><b>do</b></font>
                visit(visitable)
            <font color="#3399ff"><b>end</b></font>

        <font color="#3399ff"><b>method</b></font> visitInitValueCS(visitable : InitValueCS) : <font color="#3399ff"><b>Void</b></font> <font color="#3399ff"><b>is</b></font>
            <font color="#3399ff"><b>do</b></font>
                visit(visitable)
            <font color="#3399ff"><b>end</b></font>

        <font color="#3399ff"><b>method</b></font> visitInvOrDefCS(visitable : InvOrDefCS) : <font color="#3399ff"><b>Void</b></font> <font color="#3399ff"><b>is</b></font>
            <font color="#3399ff"><b>do</b></font>
                visit(visitable)
            <font color="#3399ff"><b>end</b></font>

        <font color="#3399ff"><b>method</b></font> visitInvCS(visitable : InvCS) : <font color="#3399ff"><b>Void</b></font> <font color="#3399ff"><b>is</b></font>
            <font color="#3399ff"><b>do</b></font>
                writeln(<font color="#cc0099"><b>&quot;inv  &quot;</b></font> + nextName(<font color="#cc0099"><b>&quot;invariant&quot;</b></font>) + <font color="#cc0099"><b>&quot; is &quot;</b></font>)
                writeln(<font color="#cc0099"><b>&quot;do&quot;</b></font> )
                visitable.expressionCS.accept(<font color="#3399ff"><b>self</b></font>)
                writeln(<font color="#cc0099"><b>&quot;&quot;</b></font>)
                writeln(<font color="#cc0099"><b>&quot;end&quot;</b></font> )
            <font color="#3399ff"><b>end</b></font>

        <font color="#3399ff"><b>method</b></font> visitDefCS(visitable : DefCS) : <font color="#3399ff"><b>Void</b></font> <font color="#3399ff"><b>is</b></font>
            <font color="#3399ff"><b>do</b></font>
                 visitable.defExpressionCS.accept(<font color="#3399ff"><b>self</b></font>)
            <font color="#3399ff"><b>end</b></font>

        <font color="#3399ff"><b>method</b></font> visitDefExpressionCS(visitable : DefExpressionCS) : <font color="#3399ff"><b>Void</b></font> <font color="#3399ff"><b>is</b></font>
            <font color="#3399ff"><b>do</b></font>
                visitable.operationCS.accept(<font color="#3399ff"><b>self</b></font>)
                writeln(<font color="#cc0099"><b>&quot; is&quot;</b></font>)
                writeln(<font color="#cc0099"><b>&quot;do&quot;</b></font>)
                write(<font color="#cc0099"><b>&quot;result := &quot;</b></font>)
                visitable.expressionCS.accept(<font color="#3399ff"><b>self</b></font>)
                writeln(<font color="#cc0099"><b>&quot;&quot;</b></font>)
                write(<font color="#cc0099"><b>&quot;end&quot;</b></font>)
            <font color="#3399ff"><b>end</b></font>

        <font color="#3399ff"><b>method</b></font> visitPathNameCS(visitable : PathNameCS) : <font color="#3399ff"><b>Void</b></font> <font color="#3399ff"><b>is</b></font>
            <font color="#3399ff"><b>do</b></font>
                visitable.sequenceOfNames.each{o|
                    <font color="#3399ff"><b>if</b></font> o != <font color="#3399ff"><b>void</b></font> <font color="#3399ff"><b>then</b></font>
                        write( o.toString)
                    <font color="#3399ff"><b>else</b></font>
                        write(<font color="#cc0099"><b>&quot;[void path name]&quot;</b></font>)
                    <font color="#3399ff"><b>end</b></font>
                    <font color="#33cc99"><i>//o.accept(self) </i></font>
                    }
            <font color="#3399ff"><b>end</b></font>

        <font color="#3399ff"><b>method</b></font> visitVariableExpCS(visitable : VariableExpCS) : <font color="#3399ff"><b>Void</b></font> <font color="#3399ff"><b>is</b></font>
            <font color="#3399ff"><b>do</b></font>
                pathExpression := pathExpression + visitable.simpleNameCS.~<font color="#3399ff"><b>value</b></font>+<font color="#cc0099"><b>&quot;.&quot;</b></font>

                <font color="#33cc99"><i>//self.currentPackagename + &quot;::&quot; + self.currentClassifiername</i></font>
                <font color="#33cc99"><i>//writeln(self.currentPackagename + &quot;::&quot; + self.currentClassifiername)</i></font>
                <font color="#33cc99"><i>//writeln(pathExpression.substring(0, pathExpression.size -1))</i></font>

                <font color="#3399ff"><b>var</b></font> isMultiple : Boolean <font color="#3399ff"><b>init</b></font> <font color="#3399ff"><b>self</b></font>.ecoreHelper.isMultiple(<font color="#3399ff"><b>self</b></font>.currentPackagename + <font color="#cc0099"><b>&quot;::&quot;</b></font> + <font color="#3399ff"><b>self</b></font>.currentClassifiername, pathExpression.substring(0, pathExpression.size -1),<font color="#cc0099"><b>&quot;.&quot;</b></font>)
                <font color="#33cc99"><i>//writeln(isMultiple.toString)</i></font>

                <font color="#3399ff"><b>if</b></font> (previousIsMultiple) <font color="#3399ff"><b>then</b></font>
                    write(<font color="#cc0099"><b>&quot;collect{e | e.&quot;</b></font>)
                    write( visitable.simpleNameCS.~<font color="#3399ff"><b>value</b></font>)
                    write(<font color="#cc0099"><b>&quot;}&quot;</b></font>)
                <font color="#3399ff"><b>else</b></font>
                    write( visitable.simpleNameCS.~<font color="#3399ff"><b>value</b></font>)
                <font color="#3399ff"><b>end</b></font>

                previousIsMultiple:=isMultiple
                <font color="#33cc99"><i>//visitable.simpleNameCS.accept(self)</i></font>
            <font color="#3399ff"><b>end</b></font>



        <font color="#3399ff"><b>method</b></font> visitSimpleNameCS(visitable : SimpleNameCS) : <font color="#3399ff"><b>Void</b></font> <font color="#3399ff"><b>is</b></font>
            <font color="#3399ff"><b>do</b></font>
                <font color="#3399ff"><b>var</b></font> name : String <font color="#3399ff"><b>init</b></font> visitable.~<font color="#3399ff"><b>value</b></font>.toString
                <font color="#3399ff"><b>if</b></font> isKermetaKeyword(name) <font color="#3399ff"><b>then</b></font>
                    write(<font color="#cc0099"><b>&quot;~&quot;</b></font>)
                <font color="#3399ff"><b>end</b></font>
                write(name)
            <font color="#3399ff"><b>end</b></font>

        <font color="#3399ff"><b>method</b></font> visitTypeCS(visitable : TypeCS) : <font color="#3399ff"><b>Void</b></font> <font color="#3399ff"><b>is</b></font>
            <font color="#3399ff"><b>do</b></font>
                visit(visitable)
            <font color="#3399ff"><b>end</b></font>

        <font color="#3399ff"><b>method</b></font> visitPrimitiveTypeCS(visitable : PrimitiveTypeCS) : <font color="#3399ff"><b>Void</b></font> <font color="#3399ff"><b>is</b></font>
            <font color="#3399ff"><b>do</b></font>
                <font color="#3399ff"><b>if</b></font> visitable.~<font color="#3399ff"><b>value</b></font>.toString.equals(<font color="#cc0099"><b>&quot;OclAny&quot;</b></font>) <font color="#3399ff"><b>then</b></font>
                    write(<font color="#cc0099"><b>&quot;Object&quot;</b></font>)
                <font color="#3399ff"><b>else</b></font>
                    visitSimpleNameCS(visitable)
                <font color="#3399ff"><b>end</b></font>
            <font color="#3399ff"><b>end</b></font>

        <font color="#3399ff"><b>method</b></font> visitTupleTypeCS(visitable : TupleTypeCS) : <font color="#3399ff"><b>Void</b></font> <font color="#3399ff"><b>is</b></font>
            <font color="#3399ff"><b>do</b></font>
                visit(visitable)
            <font color="#3399ff"><b>end</b></font>

        <font color="#3399ff"><b>method</b></font> visitCollectionTypeCS(visitable : CollectionTypeCS) : <font color="#3399ff"><b>Void</b></font> <font color="#3399ff"><b>is</b></font>
            <font color="#3399ff"><b>do</b></font>
                write(visitable.collectionTypeIdentifier.name)
                write(<font color="#cc0099"><b>&quot;&lt;&quot;</b></font>)
                visitable.typeCS.accept(<font color="#3399ff"><b>self</b></font>)
                write(<font color="#cc0099"><b>&quot;&gt;&quot;</b></font>)
            <font color="#3399ff"><b>end</b></font>

        <font color="#3399ff"><b>method</b></font> visitOCLExpressionCS(visitable : OCLExpressionCS) : <font color="#3399ff"><b>Void</b></font> <font color="#3399ff"><b>is</b></font>
            <font color="#3399ff"><b>do</b></font>
                visit(visitable)
            <font color="#3399ff"><b>end</b></font>

        <font color="#3399ff"><b>method</b></font> visitLetExpCS(visitable : LetExpCS) : <font color="#3399ff"><b>Void</b></font> <font color="#3399ff"><b>is</b></font>
            <font color="#3399ff"><b>do</b></font>
                write(<font color="#cc0099"><b>&quot;do&quot;</b></font>)
                <font color="#33cc99"><i>//variables</i></font>
                visitable.variables.each{ v |
                        writeln(<font color="#cc0099"><b>&quot;&quot;</b></font>)
                        write(<font color="#cc0099"><b>&quot;var &quot;</b></font> )
                        v.accept(<font color="#3399ff"><b>self</b></font>)
                    }
                writeln(<font color="#cc0099"><b>&quot;&quot;</b></font>)
                <font color="#33cc99"><i>//body</i></font>
                visitable.inExpression.accept(<font color="#3399ff"><b>self</b></font>)
                writeln(<font color="#cc0099"><b>&quot;&quot;</b></font>)
                write(<font color="#cc0099"><b>&quot;end&quot;</b></font>)
            <font color="#3399ff"><b>end</b></font>

        <font color="#3399ff"><b>method</b></font> visitIfExpCS(visitable : IfExpCS) : <font color="#3399ff"><b>Void</b></font> <font color="#3399ff"><b>is</b></font>
            <font color="#3399ff"><b>do</b></font>
                write(<font color="#cc0099"><b>&quot;if &quot;</b></font>)
                visitable.condition.accept(<font color="#3399ff"><b>self</b></font>)
                write(<font color="#cc0099"><b>&quot; then &quot;</b></font>)
                visitable.thenExpression.accept(<font color="#3399ff"><b>self</b></font>)
                write(<font color="#cc0099"><b>&quot; else &quot;</b></font>)
                visitable.elseExpression.accept(<font color="#3399ff"><b>self</b></font>)
                write(<font color="#cc0099"><b>&quot; endif&quot;</b></font>)
            <font color="#3399ff"><b>end</b></font>

        <font color="#3399ff"><b>method</b></font> visitMessageExpCS(visitable : MessageExpCS) : <font color="#3399ff"><b>Void</b></font> <font color="#3399ff"><b>is</b></font>
            <font color="#3399ff"><b>do</b></font>
                visit(visitable)
            <font color="#3399ff"><b>end</b></font>

        <font color="#3399ff"><b>method</b></font> visitOCLMessageArgCS(visitable : OCLMessageArgCS) : <font color="#3399ff"><b>Void</b></font> <font color="#3399ff"><b>is</b></font>
            <font color="#3399ff"><b>do</b></font>
                visit(visitable)
            <font color="#3399ff"><b>end</b></font>

        <font color="#3399ff"><b>method</b></font> visitVariableCS(visitable : VariableCS) : <font color="#3399ff"><b>Void</b></font> <font color="#3399ff"><b>is</b></font>
            <font color="#3399ff"><b>do</b></font>
                write(visitable.name.toString)
                <font color="#33cc99"><i>//visitable.name.accept(self)</i></font>
                <font color="#3399ff"><b>if</b></font> visitable.typeCS != <font color="#3399ff"><b>void</b></font> <font color="#3399ff"><b>then</b></font>
                    write(<font color="#cc0099"><b>&quot; : &quot;</b></font>)
                    visitable.typeCS.accept(<font color="#3399ff"><b>self</b></font>)
                <font color="#3399ff"><b>end</b></font>
                <font color="#3399ff"><b>if</b></font> visitable.initExpression != <font color="#3399ff"><b>void</b></font> <font color="#3399ff"><b>then</b></font>
                    write(<font color="#cc0099"><b>&quot; init &quot;</b></font>)
                    visitable.initExpression.accept(<font color="#3399ff"><b>self</b></font>)
                <font color="#3399ff"><b>end</b></font>
            <font color="#3399ff"><b>end</b></font>

        <font color="#3399ff"><b>method</b></font> visitLiteralExpCS(visitable : LiteralExpCS) : <font color="#3399ff"><b>Void</b></font> <font color="#3399ff"><b>is</b></font>
            <font color="#3399ff"><b>do</b></font>
                visit(visitable)
            <font color="#3399ff"><b>end</b></font>

        <font color="#3399ff"><b>method</b></font> visitEnumLiteralExpCS(visitable : EnumLiteralExpCS) : <font color="#3399ff"><b>Void</b></font> <font color="#3399ff"><b>is</b></font>
            <font color="#3399ff"><b>do</b></font>
                visitable.pathNameCS.accept(<font color="#3399ff"><b>self</b></font>)
                write(<font color="#cc0099"><b>&quot;.&quot;</b></font>)
                visitable.simpleNameCS.accept(<font color="#3399ff"><b>self</b></font>)
            <font color="#3399ff"><b>end</b></font>

        <font color="#3399ff"><b>method</b></font> visitCollectionLiteralExpCS(visitable : CollectionLiteralExpCS) : <font color="#3399ff"><b>Void</b></font> <font color="#3399ff"><b>is</b></font>
            <font color="#3399ff"><b>do</b></font>
                <font color="#3399ff"><b>var</b></font> varName :  String <font color="#3399ff"><b>init</b></font> nextName(<font color="#cc0099"><b>&quot;variable&quot;</b></font>)
                <font color="#33cc99"><i>//TODO: do we have to infer the element type here?</i></font>
                <font color="#3399ff"><b>var</b></font> type : String <font color="#3399ff"><b>init</b></font> visitable.collectionType.name +<font color="#cc0099"><b>&quot;&lt;&quot;</b></font> + <font color="#cc0099"><b>&quot;????????&quot;</b></font> +<font color="#cc0099"><b>&quot;&gt;&quot;</b></font>
                writeln(<font color="#cc0099"><b>&quot;do&quot;</b></font>)
                write(<font color="#cc0099"><b>&quot;var &quot;</b></font> + varName + <font color="#cc0099"><b>&quot; : &quot;</b></font> + type)
                writeln(<font color="#cc0099"><b>&quot;init &quot;</b></font> + type + <font color="#cc0099"><b>&quot;.new&quot;</b></font>)
                visitable.collectionLiteralParts.each{ clp |
                        write(varName + <font color="#cc0099"><b>&quot;.add(&quot;</b></font>)
                        clp.accept(<font color="#3399ff"><b>self</b></font>)
                        writeln(<font color="#cc0099"><b>&quot;)&quot;</b></font>)
                    }
                writeln(varName)
                write(<font color="#cc0099"><b>&quot;end&quot;</b></font>)
            <font color="#3399ff"><b>end</b></font>

        <font color="#3399ff"><b>method</b></font> visitTupleLiteralExpCS(visitable : TupleLiteralExpCS) : <font color="#3399ff"><b>Void</b></font> <font color="#3399ff"><b>is</b></font>
            <font color="#3399ff"><b>do</b></font>
                visit(visitable)
            <font color="#3399ff"><b>end</b></font>

        <font color="#3399ff"><b>method</b></font> visitPrimitiveLiteralExpCS(visitable : PrimitiveLiteralExpCS) : <font color="#3399ff"><b>Void</b></font> <font color="#3399ff"><b>is</b></font>
            <font color="#3399ff"><b>do</b></font>
                write(visitable.symbol)
            <font color="#3399ff"><b>end</b></font>

        <font color="#3399ff"><b>method</b></font> visitIntegerLiteralExpCS(visitable : IntegerLiteralExpCS) : <font color="#3399ff"><b>Void</b></font> <font color="#3399ff"><b>is</b></font>
            <font color="#3399ff"><b>do</b></font>
                write(visitable.symbol)
            <font color="#3399ff"><b>end</b></font>

        <font color="#3399ff"><b>method</b></font> visitRealLiteralExpCS(visitable : RealLiteralExpCS) : <font color="#3399ff"><b>Void</b></font> <font color="#3399ff"><b>is</b></font>
            <font color="#3399ff"><b>do</b></font>
                write(visitable.symbol.toString)
            <font color="#3399ff"><b>end</b></font>

        <font color="#3399ff"><b>method</b></font> visitStringLiteralExpCS(visitable : StringLiteralExpCS) : <font color="#3399ff"><b>Void</b></font> <font color="#3399ff"><b>is</b></font>
            <font color="#3399ff"><b>do</b></font>
                write(visitable.symbol)
            <font color="#3399ff"><b>end</b></font>

        <font color="#3399ff"><b>method</b></font> visitBooleanLiteralExpCS(visitable : BooleanLiteralExpCS) : <font color="#3399ff"><b>Void</b></font> <font color="#3399ff"><b>is</b></font>
            <font color="#3399ff"><b>do</b></font>
                visitPrimitiveLiteralExpCS(visitable)
            <font color="#3399ff"><b>end</b></font>

        <font color="#3399ff"><b>method</b></font> visitNullLiteralExpCS(visitable : NullLiteralExpCS) : <font color="#3399ff"><b>Void</b></font> <font color="#3399ff"><b>is</b></font>
            <font color="#3399ff"><b>do</b></font>
                write(<font color="#cc0099"><b>&quot;void&quot;</b></font>)
            <font color="#3399ff"><b>end</b></font>

        <font color="#3399ff"><b>method</b></font> visitInvalidLiteralExpCS(visitable : InvalidLiteralExpCS) : <font color="#3399ff"><b>Void</b></font> <font color="#3399ff"><b>is</b></font>
            <font color="#3399ff"><b>do</b></font>
                visit(visitable)
            <font color="#3399ff"><b>end</b></font>

        <font color="#3399ff"><b>method</b></font> visitCollectionLiteralPartCS(visitable : CollectionLiteralPartCS) : <font color="#3399ff"><b>Void</b></font> <font color="#3399ff"><b>is</b></font>
            <font color="#3399ff"><b>do</b></font>
                visitable.expressionCS.accept(<font color="#3399ff"><b>self</b></font>)
            <font color="#3399ff"><b>end</b></font>

        <font color="#3399ff"><b>method</b></font> visitCollectionRangeCS(visitable : CollectionRangeCS) : <font color="#3399ff"><b>Void</b></font> <font color="#3399ff"><b>is</b></font>
            <font color="#3399ff"><b>do</b></font>
                visit(visitable)
            <font color="#3399ff"><b>end</b></font>

        <font color="#3399ff"><b>method</b></font> visitCallExpCS(visitable : CallExpCS) : <font color="#3399ff"><b>Void</b></font> <font color="#3399ff"><b>is</b></font>
            <font color="#3399ff"><b>do</b></font>
                visit(visitable)
            <font color="#3399ff"><b>end</b></font>

        <font color="#3399ff"><b>method</b></font> visitLoopExpCS(visitable : LoopExpCS) : <font color="#3399ff"><b>Void</b></font> <font color="#3399ff"><b>is</b></font>
            <font color="#3399ff"><b>do</b></font>
                visit(visitable)
            <font color="#3399ff"><b>end</b></font>

        <font color="#3399ff"><b>attribute</b></font> __iterators : Hashtable&lt;String, IteratorPolicy&gt;

        <font color="#3399ff"><b>operation</b></font> addIterator(oclIteratorName: String, policy: IteratorPolicy) : <font color="#3399ff"><b>Void</b></font> <font color="#3399ff"><b>is</b></font>
        <font color="#3399ff"><b>do</b></font>
            __iterators.put(oclIteratorName, policy)
        <font color="#3399ff"><b>end</b></font>

        <font color="#3399ff"><b>property</b></font> <font color="#3399ff"><b>readonly</b></font> iterators : Hashtable&lt;String, IteratorPolicy&gt;
            <font color="#3399ff"><b>getter</b></font> <font color="#3399ff"><b>is</b></font>
                <font color="#3399ff"><b>do</b></font>
                    <font color="#3399ff"><b>if</b></font> __iterators == <font color="#3399ff"><b>void</b></font> <font color="#3399ff"><b>then</b></font>
                        __iterators := Hashtable&lt;String, IteratorPolicy&gt;.new
                        <font color="#3399ff"><b>var</b></font> doNothing : IteratorPolicy <font color="#3399ff"><b>init</b></font> IteratorPolicy.new
                        <font color="#3399ff"><b>var</b></font> sameName: IteratorPolicy <font color="#3399ff"><b>init</b></font> SimpleIteratorIP.new
                        <font color="#3399ff"><b>var</b></font> functionWithSameName : IteratorPolicy <font color="#3399ff"><b>init</b></font> FunctionIP.new
                        addIterator(<font color="#cc0099"><b>&quot;exists&quot;</b></font>, sameName)
                        addIterator(<font color="#cc0099"><b>&quot;forAll&quot;</b></font>, sameName)
                        addIterator(<font color="#cc0099"><b>&quot;isUnique&quot;</b></font>, UniqueIP.new)
                        addIterator(<font color="#cc0099"><b>&quot;any&quot;</b></font>, SimpleIteratorIP.new.withName(<font color="#cc0099"><b>&quot;detect&quot;</b></font>))
                        addIterator(<font color="#cc0099"><b>&quot;one&quot;</b></font>, SimpleIteratorIP.new.withName(<font color="#cc0099"><b>&quot;select&quot;</b></font>).withSuffix(<font color="#cc0099"><b>&quot;.size.equals(1)&quot;</b></font>))
                        addIterator(<font color="#cc0099"><b>&quot;select&quot;</b></font>, SimpleIteratorIP.new.withName(<font color="#cc0099"><b>&quot;select&quot;</b></font>))
                        addIterator(<font color="#cc0099"><b>&quot;collect&quot;</b></font>, sameName)
                        addIterator(<font color="#cc0099"><b>&quot;collectNested&quot;</b></font>, doNothing)
                        addIterator(<font color="#cc0099"><b>&quot;sortedBy&quot;</b></font>, sameName)
                        addIterator(<font color="#cc0099"><b>&quot;reject&quot;</b></font>, sameName)
                    <font color="#3399ff"><b>end</b></font>
                    <font color="#3399ff"><b>result</b></font> := __iterators
                <font color="#3399ff"><b>end</b></font>

        <font color="#3399ff"><b>method</b></font> visitIteratorExpCS(visitable : IteratorExpCS) : <font color="#3399ff"><b>Void</b></font> <font color="#3399ff"><b>is</b></font>
            <font color="#3399ff"><b>do</b></font>
                <font color="#33cc99"><i>// &lt;source&gt; &lt;accessor&gt; &lt;simpleNameCS&gt;( &lt;body&gt; )</i></font>
                <font color="#33cc99"><i>// &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</i></font>
                <font color="#33cc99"><i>// why can't I compare the enumerations normally</i></font>
                <font color="#33cc99"><i>// i.e. visitable.simpleNameCS.~type.equals(SimpleTypeEnum.keyword)</i></font>
                <font color="#33cc99"><i>//  &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</i></font>
                <font color="#3399ff"><b>if</b></font> visitable.simpleNameCS.~type.name.equals(SimpleTypeEnum.keyword.name) <font color="#3399ff"><b>then</b></font>
                    <font color="#33cc99"><i>// check which keyword type and act accordingly</i></font>
                    <font color="#33cc99"><i>// TODO: this won't work in cases where the inner expression defines its own variables</i></font>
                    <font color="#3399ff"><b>var</b></font> policy: IteratorPolicy <font color="#3399ff"><b>init</b></font> iterators.getValue(visitable.simpleNameCS.~<font color="#3399ff"><b>value</b></font>.toString)
                    <font color="#3399ff"><b>if</b></font> policy != <font color="#3399ff"><b>void</b></font> <font color="#3399ff"><b>then</b></font>
                        <font color="#33cc99"><i>// TODO: assert that the accessor was an arrow</i></font>
                        policy.generate(visitable, <font color="#3399ff"><b>self</b></font>)
                    <font color="#3399ff"><b>else</b></font>
                        writeln(<font color="#cc0099"><b>&quot;Unknown keyword type &quot;</b></font> +visitable.simpleNameCS.~<font color="#3399ff"><b>value</b></font>.toString )
                    <font color="#3399ff"><b>end</b></font>
                <font color="#3399ff"><b>end</b></font>
            <font color="#3399ff"><b>end</b></font>

        <font color="#3399ff"><b>method</b></font> visitIterateExpCS(visitable : IterateExpCS) : <font color="#3399ff"><b>Void</b></font> <font color="#3399ff"><b>is</b></font>
            <font color="#3399ff"><b>do</b></font>
                visit(visitable)
            <font color="#3399ff"><b>end</b></font>

        <font color="#3399ff"><b>attribute</b></font> pathExpression : String

        <font color="#3399ff"><b>attribute</b></font> previousIsMultiple : Boolean

        <font color="#3399ff"><b>attribute</b></font> pathContextCounter : Integer

        <font color="#3399ff"><b>method</b></font> visitFeatureCallExpCS(visitable : FeatureCallExpCS) : <font color="#3399ff"><b>Void</b></font> <font color="#3399ff"><b>is</b></font>
            <font color="#3399ff"><b>do</b></font>
                pathContextCounter := pathContextCounter+1
                <font color="#3399ff"><b>if</b></font> visitable.source != <font color="#3399ff"><b>void</b></font> <font color="#3399ff"><b>then</b></font>
                    visitable.source.accept(<font color="#3399ff"><b>self</b></font>)
                    <font color="#3399ff"><b>if</b></font> visitable.accessor.name == <font color="#cc0099"><b>&quot;dot&quot;</b></font> <font color="#3399ff"><b>then</b></font>
                       write(<font color="#cc0099"><b>&quot;.&quot;</b></font>)
                    <font color="#3399ff"><b>end</b></font>
                    <font color="#3399ff"><b>if</b></font> visitable.accessor.name == <font color="#cc0099"><b>&quot;arrow&quot;</b></font> <font color="#3399ff"><b>then</b></font>
                       write(<font color="#cc0099"><b>&quot;.&quot;</b></font>)
                    <font color="#3399ff"><b>end</b></font>
                <font color="#33cc99"><i>//else</i></font>
                <font color="#33cc99"><i>//  last := true                    </i></font>
                <font color="#3399ff"><b>end</b></font>
                <font color="#33cc99"><i>//visitable.simpleNameCS.accept(self)</i></font>
                pathExpression := pathExpression + visitable.simpleNameCS.~<font color="#3399ff"><b>value</b></font>+<font color="#cc0099"><b>&quot;.&quot;</b></font>

                <font color="#33cc99"><i>//self.currentPackagename + &quot;::&quot; + self.currentClassifiername</i></font>
                <font color="#33cc99"><i>//writeln(self.currentPackagename + &quot;::&quot; + self.currentClassifiername)</i></font>
                <font color="#33cc99"><i>//writeln(pathExpression.substring(0, pathExpression.size -1))</i></font>

                <font color="#3399ff"><b>var</b></font> isMultiple : Boolean <font color="#3399ff"><b>init</b></font> <font color="#3399ff"><b>self</b></font>.ecoreHelper.isMultiple(<font color="#3399ff"><b>self</b></font>.currentPackagename + <font color="#cc0099"><b>&quot;::&quot;</b></font> + <font color="#3399ff"><b>self</b></font>.currentClassifiername, pathExpression.substring(0, pathExpression.size -1),<font color="#cc0099"><b>&quot;.&quot;</b></font>)

                <font color="#3399ff"><b>if</b></font> (previousIsMultiple) <font color="#3399ff"><b>then</b></font>
                    write(<font color="#cc0099"><b>&quot;collect{e | e.&quot;</b></font>)
                    write( visitable.simpleNameCS.~<font color="#3399ff"><b>value</b></font>)
                    write(<font color="#cc0099"><b>&quot;}&quot;</b></font>)
                <font color="#3399ff"><b>else</b></font>
                    write( visitable.simpleNameCS.~<font color="#3399ff"><b>value</b></font>)
                <font color="#3399ff"><b>end</b></font>

                previousIsMultiple:=isMultiple

                <font color="#33cc99"><i>//writeln(isMultiple.toString)</i></font>

                <font color="#3399ff"><b>if</b></font> visitable.arguments.size &gt; 0 <font color="#3399ff"><b>then</b></font>
                    write(<font color="#cc0099"><b>&quot;(&quot;</b></font>)
                    <font color="#3399ff"><b>from</b></font>
                        <font color="#3399ff"><b>var</b></font> it : Iterator&lt;OCLExpressionCS&gt; <font color="#3399ff"><b>init</b></font> visitable.arguments.iterator
                    <font color="#3399ff"><b>until</b></font>
                        it.isOff
                    <font color="#3399ff"><b>loop</b></font>
                        it.next.accept(<font color="#3399ff"><b>self</b></font>)
                        <font color="#3399ff"><b>if</b></font>  it.hasNext <font color="#3399ff"><b>then</b></font>
                            write(<font color="#cc0099"><b>&quot;, &quot;</b></font>)
                        <font color="#3399ff"><b>end</b></font>
                    <font color="#3399ff"><b>end</b></font>
                    write(<font color="#cc0099"><b>&quot;)&quot;</b></font>)
                <font color="#3399ff"><b>end</b></font>

                pathContextCounter := pathContextCounter-1


                <font color="#3399ff"><b>if</b></font> (pathContextCounter==0) <font color="#3399ff"><b>then</b></font>
                    previousIsMultiple:=<font color="#3399ff"><b>false</b></font>
                    pathExpression := <font color="#cc0099"><b>&quot;&quot;</b></font>
                <font color="#3399ff"><b>end</b></font>

            <font color="#3399ff"><b>end</b></font>


<font color="#33cc99"><i>/*</i></font>
<font color="#33cc99"><i>      operation featureCall(visitable: FeatureCallExpCS): Void is</i></font>
<font color="#33cc99"><i>            do</i></font>
<font color="#33cc99"><i>                visitable.simpleNameCS.accept(self)</i></font>
<font color="#33cc99"><i>                if visitable.arguments.size &gt; 0 then</i></font>
<font color="#33cc99"><i>                    write(&quot;(&quot;)</i></font>
<font color="#33cc99"><i>                    from</i></font>
<font color="#33cc99"><i>                        var it : Iterator&lt;OCLExpressionCS&gt; init visitable.arguments.iterator</i></font>
<font color="#33cc99"><i>                    until</i></font>
<font color="#33cc99"><i>                        it.isOff</i></font>
<font color="#33cc99"><i>                    loop</i></font>
<font color="#33cc99"><i>                        it.next.accept(self)</i></font>
<font color="#33cc99"><i>                        if  it.hasNext the</i></font>
<font color="#33cc99"><i>                            write(&quot;, &quot;) </i></font>
<font color="#33cc99"><i>                        end</i></font>
<font color="#33cc99"><i>                    end</i></font>
<font color="#33cc99"><i>                    write(&quot;)&quot;)</i></font>
<font color="#33cc99"><i>                end</i></font>
<font color="#33cc99"><i>            end</i></font>
<font color="#33cc99"><i>        </i></font>
<font color="#33cc99"><i>        method visitFeatureCallExpCS(visitable : FeatureCallExpCS) : Void is</i></font>
<font color="#33cc99"><i>            do</i></font>
<font color="#33cc99"><i>                if visitable.source != void then</i></font>
<font color="#33cc99"><i>                    visitable.source.accept(self)       </i></font>
<font color="#33cc99"><i>                    if visitable.accessor.name == &quot;dot&quot; then</i></font>
<font color="#33cc99"><i>                        var variableName : String init nextName(&quot;variable&quot;)</i></font>
<font color="#33cc99"><i>                      write(&quot;.collect{&quot; + variableName + &quot; | &quot;)</i></font>
<font color="#33cc99"><i>                        write(variableName + &quot;.&quot;)</i></font>
<font color="#33cc99"><i>                        featureCall(visitable)</i></font>
<font color="#33cc99"><i>                        write(&quot;}&quot;)</i></font>
<font color="#33cc99"><i>                    end</i></font>
<font color="#33cc99"><i>                    if visitable.accessor.name == &quot;arrow&quot; then</i></font>
<font color="#33cc99"><i>                       write(&quot;.&quot;)</i></font>
<font color="#33cc99"><i>                         featureCall(visitable)</i></font>
<font color="#33cc99"><i>                    end</i></font>
<font color="#33cc99"><i>                end</i></font>
<font color="#33cc99"><i>            end</i></font>
<font color="#33cc99"><i>            */</i></font>

       <font color="#3399ff"><b>attribute</b></font> __operators: Hashtable&lt;String, OperatorPolicy&gt;
        <font color="#3399ff"><b>property</b></font> <font color="#3399ff"><b>readonly</b></font> operators: Hashtable&lt;String, OperatorPolicy&gt;
            <font color="#3399ff"><b>getter</b></font> <font color="#3399ff"><b>is</b></font>
                <font color="#3399ff"><b>do</b></font>
                    <font color="#3399ff"><b>if</b></font> __operators == <font color="#3399ff"><b>void</b></font> <font color="#3399ff"><b>then</b></font>
                        <font color="#3399ff"><b>var</b></font> functionCall : OperatorPolicy <font color="#3399ff"><b>init</b></font> FunctionCallOp.new
                        <font color="#3399ff"><b>var</b></font> simpleOp : OperatorPolicy <font color="#3399ff"><b>init</b></font> SimpleOP.new
                        __operators := Hashtable&lt;String, OperatorPolicy&gt;.new
                        __operators.put(<font color="#cc0099"><b>&quot;implies&quot;</b></font>, ImpliesOP.new)
                        __operators.put(<font color="#cc0099"><b>&quot;and&quot;</b></font>, functionCall)
                        __operators.put(<font color="#cc0099"><b>&quot;or&quot;</b></font>, functionCall)
                        __operators.put(<font color="#cc0099"><b>&quot;xor&quot;</b></font>, functionCall)
                        __operators.put(<font color="#cc0099"><b>&quot;=&quot;</b></font>, FunctionCallOp.new.withName(<font color="#cc0099"><b>&quot;equals&quot;</b></font>))
                        __operators.put(<font color="#cc0099"><b>&quot;&lt;&quot;</b></font>, FunctionCallOp.new.withName(<font color="#cc0099"><b>&quot;isLower&quot;</b></font>))
                        __operators.put(<font color="#cc0099"><b>&quot;&lt;=&quot;</b></font>, FunctionCallOp.new.withName(<font color="#cc0099"><b>&quot;isLowerOrEqual&quot;</b></font>))
                        __operators.put(<font color="#cc0099"><b>&quot;&gt;&quot;</b></font>,  FunctionCallOp.new.withName(<font color="#cc0099"><b>&quot;isGreater&quot;</b></font>))
                        __operators.put(<font color="#cc0099"><b>&quot;&gt;=&quot;</b></font>,  FunctionCallOp.new.withName(<font color="#cc0099"><b>&quot;isGreaterOrEqual&quot;</b></font>))
                        __operators.put(<font color="#cc0099"><b>&quot;&lt;&gt;&quot;</b></font>,  FunctionCallOp.new.withName(<font color="#cc0099"><b>&quot;equals&quot;</b></font>).withSuffix(<font color="#cc0099"><b>&quot;.~not&quot;</b></font>))
                        __operators.put(<font color="#cc0099"><b>&quot;+&quot;</b></font>,  FunctionCallOp.new.withName(<font color="#cc0099"><b>&quot;plus&quot;</b></font>))
                        __operators.put(<font color="#cc0099"><b>&quot;-&quot;</b></font>, MinusSignOp.new)
                        __operators.put(<font color="#cc0099"><b>&quot;*&quot;</b></font>,  FunctionCallOp.new.withName(<font color="#cc0099"><b>&quot;mult&quot;</b></font>))
                        __operators.put(<font color="#cc0099"><b>&quot;/&quot;</b></font>,  FunctionCallOp.new.withName(<font color="#cc0099"><b>&quot;div&quot;</b></font>))
                        __operators.put(<font color="#cc0099"><b>&quot;includes&quot;</b></font>, FunctionCallOp.new.withName(<font color="#cc0099"><b>&quot;contains&quot;</b></font>))
                        __operators.put(<font color="#cc0099"><b>&quot;includesAll&quot;</b></font>, FunctionCallOp.new.withName(<font color="#cc0099"><b>&quot;containsAll&quot;</b></font>))
                        __operators.put(<font color="#cc0099"><b>&quot;size&quot;</b></font>, FunctionCallOp.new)
                        __operators.put(<font color="#cc0099"><b>&quot;at&quot;</b></font>, FunctionCallOp.new.withName(<font color="#cc0099"><b>&quot;elementAt&quot;</b></font>))
                        __operators.put(<font color="#cc0099"><b>&quot;indexOf&quot;</b></font>, FunctionCallOp.new)
                        __operators.put(<font color="#cc0099"><b>&quot;oclAsType&quot;</b></font>, CastOp.new)
                        __operators.put(<font color="#cc0099"><b>&quot;oclIsUndefined&quot;</b></font>, NotNullOp.new)
                        __operators.put(<font color="#cc0099"><b>&quot;not&quot;</b></font>, functionCall)
                        __operators.put(<font color="#cc0099"><b>&quot;notEmpty&quot;</b></font>, EmptyCallOp.new.withName(<font color="#cc0099"><b>&quot;empty&quot;</b></font>).withSuffix(<font color="#cc0099"><b>&quot;.~not&quot;</b></font>))
                        __operators.put(<font color="#cc0099"><b>&quot;isEmpty&quot;</b></font>, EmptyCallOp.new.withName(<font color="#cc0099"><b>&quot;empty&quot;</b></font>))
                        __operators.put(<font color="#cc0099"><b>&quot;oclIsTypeOf&quot;</b></font>, FunctionCallOp.new.withName(<font color="#cc0099"><b>&quot;isKindOf&quot;</b></font>))
                        __operators.put(<font color="#cc0099"><b>&quot;oclIsKindOf&quot;</b></font>, FunctionCallOp.new.withName(<font color="#cc0099"><b>&quot;isInstanceOf&quot;</b></font>))
                        __operators.put(<font color="#cc0099"><b>&quot;union&quot;</b></font>, FunctionCallOp.new)
                        __operators.put(<font color="#cc0099"><b>&quot;intersection&quot;</b></font>, FunctionCallOp.new)
                        __operators.put(<font color="#cc0099"><b>&quot;including&quot;</b></font>, functionCall)
                        __operators.put(<font color="#cc0099"><b>&quot;excluding&quot;</b></font>, functionCall)
                        __operators.put(<font color="#cc0099"><b>&quot;symmetricDifference&quot;</b></font>, functionCall)
                    <font color="#3399ff"><b>end</b></font>
                    <font color="#3399ff"><b>result</b></font> := __operators
                <font color="#3399ff"><b>end</b></font>


        <font color="#3399ff"><b>method</b></font> visitOperationCallExpCS(visitable : OperationCallExpCS) : <font color="#3399ff"><b>Void</b></font> <font color="#3399ff"><b>is</b></font>
            <font color="#3399ff"><b>do</b></font>
                <font color="#33cc99"><i>//visit(visitable)      </i></font>
                <font color="#3399ff"><b>var</b></font> policy: OperatorPolicy <font color="#3399ff"><b>init</b></font> operators.getValue(visitable.simpleNameCS.~<font color="#3399ff"><b>value</b></font>.toString)
                <font color="#3399ff"><b>if</b></font> policy != <font color="#3399ff"><b>void</b></font> <font color="#3399ff"><b>then</b></font>
                    policy.generate(visitable, <font color="#3399ff"><b>self</b></font>)
                <font color="#3399ff"><b>else</b></font>
                    visitFeatureCallExpCS(visitable)
                <font color="#3399ff"><b>end</b></font>
            <font color="#3399ff"><b>end</b></font>

        <font color="#3399ff"><b>method</b></font> visitIsMarkedPreCS(visitable : IsMarkedPreCS) : <font color="#3399ff"><b>Void</b></font> <font color="#3399ff"><b>is</b></font>
            <font color="#3399ff"><b>do</b></font>
                visit(visitable)
            <font color="#3399ff"><b>end</b></font>

        <font color="#3399ff"><b>method</b></font> visitStateExpCS(visitable : StateExpCS) : <font color="#3399ff"><b>Void</b></font> <font color="#3399ff"><b>is</b></font>
            <font color="#3399ff"><b>do</b></font>
                visit(visitable)
            <font color="#3399ff"><b>end</b></font>

 <font color="#3399ff"><b>operation</b></font> isKermetaKeyword(word: String): Boolean <font color="#3399ff"><b>is</b></font>
          <font color="#3399ff"><b>do</b></font>
                <font color="#3399ff"><b>result</b></font> :=   word.equals(<font color="#cc0099"><b>&quot;package&quot;</b></font>) <font color="#3399ff"><b>or</b></font>
                            word.equals(<font color="#cc0099"><b>&quot;require&quot;</b></font>) <font color="#3399ff"><b>or</b></font>
                            word.equals(<font color="#cc0099"><b>&quot;includeFilter&quot;</b></font>) <font color="#3399ff"><b>or</b></font>
                            word.equals(<font color="#cc0099"><b>&quot;excludeFilter&quot;</b></font>) <font color="#3399ff"><b>or</b></font>
                            word.equals(<font color="#cc0099"><b>&quot;using&quot;</b></font>) <font color="#3399ff"><b>or</b></font>
                            word.equals(<font color="#cc0099"><b>&quot;inherits&quot;</b></font>) <font color="#3399ff"><b>or</b></font>
                            word.equals(<font color="#cc0099"><b>&quot;class&quot;</b></font>) <font color="#3399ff"><b>or</b></font>
                            <font color="#33cc99"><i>//word.equals(&quot;@pre&quot; ) or</i></font>
                            word.equals(<font color="#cc0099"><b>&quot;pre&quot;</b></font>) <font color="#3399ff"><b>or</b></font>
                            word.equals(<font color="#cc0099"><b>&quot;post&quot;</b></font>) <font color="#3399ff"><b>or</b></font>
                            word.equals(<font color="#cc0099"><b>&quot;inv&quot;</b></font>) <font color="#3399ff"><b>or</b></font>
                            word.equals(<font color="#cc0099"><b>&quot;abstract&quot;</b></font>) <font color="#3399ff"><b>or</b></font>
                            word.equals(<font color="#cc0099"><b>&quot;Self&quot;</b></font>) <font color="#3399ff"><b>or</b></font>
                            word.equals(<font color="#cc0099"><b>&quot;Void&quot;</b></font>) <font color="#3399ff"><b>or</b></font>
                            word.equals(<font color="#cc0099"><b>&quot;attribute&quot;</b></font>) <font color="#3399ff"><b>or</b></font>
                            word.equals(<font color="#cc0099"><b>&quot;reference&quot;</b></font>) <font color="#3399ff"><b>or</b></font>
                            word.equals(<font color="#cc0099"><b>&quot;property&quot;</b></font>) <font color="#3399ff"><b>or</b></font>
                            word.equals(<font color="#cc0099"><b>&quot;readonly&quot;</b></font>) <font color="#3399ff"><b>or</b></font>
                            word.equals(<font color="#cc0099"><b>&quot;getter&quot;</b></font>) <font color="#3399ff"><b>or</b></font>
                            word.equals(<font color="#cc0099"><b>&quot;is&quot;</b></font>) <font color="#3399ff"><b>or</b></font>
                            word.equals(<font color="#cc0099"><b>&quot;setter&quot;</b></font>) <font color="#3399ff"><b>or</b></font>
                            word.equals(<font color="#cc0099"><b>&quot;raises&quot;</b></font>) <font color="#3399ff"><b>or</b></font>
                            word.equals(<font color="#cc0099"><b>&quot;select&quot;</b></font>) <font color="#3399ff"><b>or</b></font>
                            word.equals(<font color="#cc0099"><b>&quot;operation&quot;</b></font>) <font color="#3399ff"><b>or</b></font>
                            word.equals(<font color="#cc0099"><b>&quot;method&quot;</b></font>) <font color="#3399ff"><b>or</b></font>
                            word.equals(<font color="#cc0099"><b>&quot;bag&quot;</b></font>) <font color="#3399ff"><b>or</b></font>
                            word.equals(<font color="#cc0099"><b>&quot;set&quot;</b></font>) <font color="#3399ff"><b>or</b></font>
                            word.equals(<font color="#cc0099"><b>&quot;seq&quot;</b></font>) <font color="#3399ff"><b>or</b></font>
                            word.equals(<font color="#cc0099"><b>&quot;oset&quot;</b></font>) <font color="#3399ff"><b>or</b></font>
                            word.equals(<font color="#cc0099"><b>&quot;alias&quot;</b></font>) <font color="#3399ff"><b>or</b></font>
                            word.equals(<font color="#cc0099"><b>&quot;enumeration&quot;</b></font>) <font color="#3399ff"><b>or</b></font>
                            word.equals(<font color="#cc0099"><b>&quot;and&quot;</b></font>) <font color="#3399ff"><b>or</b></font>
                            word.equals(<font color="#cc0099"><b>&quot;or&quot;</b></font>) <font color="#3399ff"><b>or</b></font>
                            word.equals(<font color="#cc0099"><b>&quot;not&quot;</b></font>) <font color="#3399ff"><b>or</b></font>
                            <font color="#33cc99"><i>//word.equals(&quot;self&quot;) or</i></font>
                            word.equals(<font color="#cc0099"><b>&quot;super&quot;</b></font>) <font color="#3399ff"><b>or</b></font>
                            word.equals(<font color="#cc0099"><b>&quot;do&quot;</b></font>) <font color="#3399ff"><b>or</b></font>
                            word.equals(<font color="#cc0099"><b>&quot;end&quot;</b></font>) <font color="#3399ff"><b>or</b></font>
                            word.equals(<font color="#cc0099"><b>&quot;function&quot;</b></font>) <font color="#3399ff"><b>or</b></font>
                            word.equals(<font color="#cc0099"><b>&quot;rescue&quot;</b></font>) <font color="#3399ff"><b>or</b></font>
                            word.equals(<font color="#cc0099"><b>&quot;from&quot;</b></font>) <font color="#3399ff"><b>or</b></font>
                            word.equals(<font color="#cc0099"><b>&quot;until&quot;</b></font>) <font color="#3399ff"><b>or</b></font>
                            word.equals(<font color="#cc0099"><b>&quot;loop&quot;</b></font>) <font color="#3399ff"><b>or</b></font>
                            word.equals(<font color="#cc0099"><b>&quot;if&quot;</b></font>) <font color="#3399ff"><b>or</b></font>
                            word.equals(<font color="#cc0099"><b>&quot;then&quot;</b></font>) <font color="#3399ff"><b>or</b></font>
                            word.equals(<font color="#cc0099"><b>&quot;else&quot;</b></font>) <font color="#3399ff"><b>or</b></font>
                            word.equals(<font color="#cc0099"><b>&quot;raise&quot;</b></font>) <font color="#3399ff"><b>or</b></font>
                            word.equals(<font color="#cc0099"><b>&quot;var&quot;</b></font>) <font color="#3399ff"><b>or</b></font>
                            word.equals(<font color="#cc0099"><b>&quot;init&quot;</b></font>) <font color="#3399ff"><b>or</b></font>
                            word.equals(<font color="#cc0099"><b>&quot;extern&quot;</b></font>) <font color="#3399ff"><b>or</b></font>
                            word.equals(<font color="#cc0099"><b>&quot;true&quot;</b></font>) <font color="#3399ff"><b>or</b></font>
                            word.equals(<font color="#cc0099"><b>&quot;false&quot;</b></font>) <font color="#3399ff"><b>or</b></font>
                            word.equals(<font color="#cc0099"><b>&quot;void&quot;</b></font>) <font color="#3399ff"><b>or</b></font>
                            word.equals(<font color="#cc0099"><b>&quot;result&quot;</b></font>) <font color="#3399ff"><b>or</b></font>
                            word.equals(<font color="#cc0099"><b>&quot;value&quot;</b></font>)
          <font color="#3399ff"><b>end</b></font>

    }


<font color="#3399ff"><b>class</b></font> IteratorPolicy {
    <font color="#3399ff"><b>attribute</b></font> name: String

    <font color="#3399ff"><b>operation</b></font> withName(functionName: String): IteratorPolicy <font color="#3399ff"><b>is</b></font>
        <font color="#3399ff"><b>do</b></font>
            name := functionName
            <font color="#3399ff"><b>result</b></font> := <font color="#3399ff"><b>self</b></font>
        <font color="#3399ff"><b>end</b></font>

    <font color="#3399ff"><b>attribute</b></font> suffix: String

    <font color="#3399ff"><b>operation</b></font> withSuffix(theSuffix: String): IteratorPolicy <font color="#3399ff"><b>is</b></font>
        <font color="#3399ff"><b>do</b></font>
            suffix := theSuffix
            <font color="#3399ff"><b>result</b></font> := <font color="#3399ff"><b>self</b></font>
        <font color="#3399ff"><b>end</b></font>

    <font color="#3399ff"><b>operation</b></font> generate(oclIterator: IteratorExpCS, visitor: Ocl2kmtVisitor): <font color="#3399ff"><b>Void</b></font> <font color="#3399ff"><b>is</b></font>
         <font color="#3399ff"><b>do</b></font>
            <font color="#3399ff"><b>var</b></font> e : Exception <font color="#3399ff"><b>init</b></font> Exception.new
            e.message := <font color="#cc0099"><b>&quot; Unimplemented policy: &quot;</b></font> + oclIterator.simpleNameCS.~<font color="#3399ff"><b>value</b></font>.toString
            <font color="#3399ff"><b>raise</b></font> e
         <font color="#3399ff"><b>end</b></font>
}

<font color="#3399ff"><b>class</b></font> SimpleIteratorIP <font color="#3399ff"><b>inherits</b></font> IteratorPolicy {

    <font color="#3399ff"><b>operation</b></font> generate(oclIterator: IteratorExpCS, visitor: Ocl2kmtVisitor): <font color="#3399ff"><b>Void</b></font> <font color="#3399ff"><b>is</b></font>
         <font color="#3399ff"><b>do</b></font>
            oclIterator.source.accept(visitor)
            visitor.write(<font color="#cc0099"><b>&quot;.&quot;</b></font>)
            <font color="#3399ff"><b>if</b></font> name == <font color="#3399ff"><b>void</b></font> <font color="#3399ff"><b>then</b></font>
                visitor.write(oclIterator.simpleNameCS.~<font color="#3399ff"><b>value</b></font>.toString )
            <font color="#3399ff"><b>else</b></font>
                visitor.write(name)
            <font color="#3399ff"><b>end</b></font>
            visitor.write(<font color="#cc0099"><b>&quot;{ &quot;</b></font>)
            <font color="#3399ff"><b>if</b></font> (oclIterator.variable1 != <font color="#3399ff"><b>void</b></font>) <font color="#3399ff"><b>then</b></font>
                oclIterator.variable1.accept(visitor)
            <font color="#3399ff"><b>else</b></font>
                visitor.write(<font color="#cc0099"><b>&quot; e &quot;</b></font>)
                <font color="#33cc99"><i>//TODO Check that mark</i></font>
            <font color="#3399ff"><b>end</b></font>
            visitor.write(<font color="#cc0099"><b>&quot; | &quot;</b></font>)
            oclIterator.body.accept(visitor)
            visitor.write(<font color="#cc0099"><b>&quot;}&quot;</b></font>)
            <font color="#3399ff"><b>if</b></font> suffix != <font color="#3399ff"><b>void</b></font> <font color="#3399ff"><b>then</b></font>
                visitor.write(suffix)
            <font color="#3399ff"><b>end</b></font>
         <font color="#3399ff"><b>end</b></font>
}

<font color="#3399ff"><b>class</b></font> UniqueIP <font color="#3399ff"><b>inherits</b></font> SimpleIteratorIP {

    <font color="#3399ff"><b>method</b></font> generate(oclIterator: IteratorExpCS, visitor: Ocl2kmtVisitor): <font color="#3399ff"><b>Void</b></font> <font color="#3399ff"><b>is</b></font>
         <font color="#3399ff"><b>do</b></font>
            name := <font color="#cc0099"><b>&quot;select&quot;</b></font>
            <font color="#3399ff"><b>super</b></font>(oclIterator, visitor)
            visitor.write(<font color="#cc0099"><b>&quot;.asSet.size.equals(&quot;</b></font>)
            oclIterator.source.accept(visitor)
            visitor.write(<font color="#cc0099"><b>&quot;.size)&quot;</b></font>)
         <font color="#3399ff"><b>end</b></font>
}

<font color="#3399ff"><b>class</b></font> FunctionIP <font color="#3399ff"><b>inherits</b></font> IteratorPolicy {

    <font color="#3399ff"><b>operation</b></font> generate(oclIterator: IteratorExpCS, visitor: Ocl2kmtVisitor): <font color="#3399ff"><b>Void</b></font> <font color="#3399ff"><b>is</b></font>
         <font color="#3399ff"><b>do</b></font>
            <font color="#3399ff"><b>if</b></font> name == <font color="#3399ff"><b>void</b></font> <font color="#3399ff"><b>then</b></font>
                visitor.write(oclIterator.simpleNameCS.~<font color="#3399ff"><b>value</b></font>.toString )
            <font color="#3399ff"><b>else</b></font>
                visitor.writeln(name)
            <font color="#3399ff"><b>end</b></font>
            visitor.write(<font color="#cc0099"><b>&quot;( &quot;</b></font>)
            oclIterator.source.accept(visitor)
            visitor.write(<font color="#cc0099"><b>&quot;, \&quot;&quot;)</b></font>
            oclIterator.body.accept(visitor)
            visitor.write(<font color="#cc0099"><b>&quot;\&quot;</b></font>)<font color="#cc0099"><b>&quot;)</b></font>
         <font color="#3399ff"><b>end</b></font>
}
</pre>
</body>
</html>
