package rcd;


require kermeta
require "http://www.kermeta.org/decomposer/plan"
require "http://www.kermeta.org/rcd"

require "platform:/resource/fr.irisa.triskell.decompose/src/kermeta/Decomposition.kmt"

using kermeta::standard
using kermeta::utils
using kermeta::persistence
using decomposition
using plan

 
class EcoreDecomposer inherits Decomposer
{
	operation loadModel(path : String) : kompose::Mergeable is do
		stdio.writeln("Load Ecore Model from: "+path)
    	var resource : kermeta::persistence::EMFResource             
   		var repository : EMFRepository init EMFRepository.new             
       	resource ?= repository.getResource(path)
        resource.load
        self.resource:=resource
       result ?= resource.instances.one
   end
   
   operation saveModel(model : kompose::Mergeable, uri : String) is do
   		stdio.writeln("Saving Ecore Model on: "+uri)
   		var resource : kermeta::persistence::EMFResource             
   		var repository : EMFRepository init EMFRepository.new
   		resource ?= repository.createResource(uri, "http://www.kermeta.org/rcd")
        resource.add(model)
        resource.save
   end
   
    operation savePlan(uri : String) is do
   		stdio.writeln("Saving Plan Model on: "+uri)
   		var resource : kermeta::persistence::EMFResource             
   		var repository : EMFRepository init EMFRepository.new
   		resource ?= repository.createResource(uri, "http://www.kermeta.org/decomposer/plan")
   		stdio.writeln(self.planification.toString)
        resource.add(self.planification)
        resource.save
   end
}

@aspect "true"
class Classifier inherits kompose::Mergeable {
	method toString():String is do
		result:="Classifier["+self.name+"]"
	end
}

@aspect "true"
class ClassModel inherits kompose::Mergeable {
	method toString():String is do
		result:="ClassModel["+self.name+"]"
	end
}

@aspect "true"
class Association inherits kompose::Mergeable {
	method toString():String is do
		result:="Association["+self.name+"]"
	end
}

@aspect "true"
class Attribute inherits kompose::Mergeable {
	method toString():String is do
		result:="Attribute["+self.name+"]:"+self.type.toString()
	end
}
