<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Logo Tutorial : Building kmLogo DSL using Kermeta</title><link rel="stylesheet" href="css/docbook.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.74.0"><meta name="description" content="This tutorial is a step-by-step user-guide to build integrated tools with the Kermeta language. The illustrated example here is building the kmLogo DSL with Kermeta."><meta name="keywords" content="Kermeta, metamodeling, language, kmLogo"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="book" lang="en-US"><div class="titlepage"><div><div><div class="mediaobject"><img src="Kermeta-Tutorial-Logo_figures/KermetaLogo.png"></div></div><div><h1 class="title"><a name="logo_tutorial"></a>Logo Tutorial : Building kmLogo DSL using Kermeta</h1></div><div><h2 class="subtitle">Reference manual</h2></div><div><div class="author"><h3 class="author"><span class="firstname">Zo&eacute;</span> <span class="surname">Drey</span></h3></div></div><div><div class="author"><h3 class="author"><span class="firstname">Cyril</span> <span class="surname">Faucher</span></h3></div></div><div><div class="author"><h3 class="author"><span class="firstname">Franck</span> <span class="surname">Fleurey</span></h3></div></div><div><div class="author"><h3 class="author"><span class="firstname">Vincent</span> <span class="surname">Mah&eacute;</span></h3></div></div><div><div class="author"><h3 class="author"><span class="firstname">Didier</span> <span class="surname">Vojtisek</span></h3></div></div><div><div class="author"><h3 class="author"><span class="firstname">Haja</span> <span class="surname">Rambelontsalama</span></h3></div></div><div><p class="pubdate">Build date: 11-February-2010</p></div><div><p class="pubdate">$Date:: 2010-01-26 14:40:23#$</p></div><div><div class="abstract"><p class="title"><b>Abstract</b></p><p>This tutorial is a step-by-step user-guide to build integrated tools with the Kermeta
        language. The illustrated example here is building the kmLogo DSL with Kermeta.</p></div></div></div><hr></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="preface"><a href="#preface.link">Preface</a></span></dt><dt><span class="chapter"><a href="#chapter_introduction.link">1. Introduction</a></span></dt><dt><span class="chapter"><a href="#chapter_installation.link">2. Installation</a></span></dt><dd><dl><dt><span class="section"><a href="#section_prerequisted.link">2.1. Prerequisites</a></span></dt><dt><span class="section"><a href="#section_install_logo_projects.link">2.2. Install logo projects</a></span></dt></dl></dd><dt><span class="chapter"><a href="#chapter_define_metamodel.link">3. Define the metamodel</a></span></dt><dd><dl><dt><span class="section"><a href="#section_from_ecore_to_generated_code.link">3.1. From Ecore to genenerated
        code</a></span></dt><dt><span class="section"><a href="#section_metamodel_with_kermeta.link">3.2. Metamodel Ecore with Kermeta</a></span></dt></dl></dd><dt><span class="chapter"><a href="#chapter_editor.link">4. Editor</a></span></dt><dd><dl><dt><span class="section"><a href="#section_dynamic_instance.link">4.1. Dynamic instance</a></span></dt><dt><span class="section"><a href="#section_tree_view_editor.link">4.2. Tree view editor</a></span></dt><dt><span class="section"><a href="#section_textual_editor.link">4.3. Textual editor</a></span></dt><dt><span class="section"><a href="#section_gmf_editor.link">4.4. GMF editor</a></span></dt></dl></dd><dt><span class="chapter"><a href="#chapter_model_manipulation_kermeta.link">5. Model manipulation in
      Kermeta</a></span></dt><dd><dl><dt><span class="section"><a href="#section_package_registry.link">5.1. Package registry</a></span></dt><dt><span class="section"><a href="#section_serialisation.link">5.2. Serialisation</a></span></dt></dl></dd><dt><span class="chapter"><a href="#chapter_contract.title.link">6. Contract</a></span></dt><dd><dl><dt><span class="section"><a href="#section_static_semantics.link">6.1. Static semantics</a></span></dt><dt><span class="section"><a href="#section_kermeta_implementation.link">6.2. Implementation in
        Kermeta</a></span></dt></dl></dd><dt><span class="chapter"><a href="#chapter_behaviour.link">7. Behaviour</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e853">7.1. Preparation of the environnement</a></span></dt><dt><span class="section"><a href="#section_dynamic_semantic.link">7.2. Dynamic semantic</a></span></dt><dt><span class="section"><a href="#section_virtual_machine.link">7.3. Virtual machine</a></span></dt><dt><span class="section"><a href="#d0e1069">7.4. Operational semantics extra</a></span></dt><dd><dl><dt><span class="section"><a href="#section_call_javaMath.link">7.4.1. Call to java.Math</a></span></dt><dt><span class="section"><a href="#section_implementing_graphical_output.link">7.4.2. Implementing a graphical
          output</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#chapter_model_transformation_compilation.link">8. Model transformation -
        Compilation</a></span></dt><dt><span class="chapter"><a href="#chapter_ui_improvements.link">9. UI improvements</a></span></dt><dd><dl><dt><span class="section"><a href="#section_gui_deployement.link">9.1. GUI deployment setup</a></span></dt></dl></dd><dt><span class="chapter"><a href="#chapter_using_deployed_DSL.link">10. Using the deployed DSL
      environment</a></span></dt><dt><span class="chapter"><a href="#chapter_conclusion.link">11. Conclusion</a></span></dt></dl></div><div class="preface" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a name="preface.link"></a>Preface<span><a name="preface"></a></span></h2></div></div></div><p>Kermeta is a Domain Specific Language dedicated to metamodel engineering. It fills the gap
      let by MOF which defines only the structure of meta-models, by adding a way to specify static
      semantic (similar to OCL) and dynamic semantic (using operational semantic in the operation of
      the metamodel). Kermeta uses the object-oriented paradigm like Java or Eiffel.</p><p></p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="gfx/admonitions/important.gif"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>Kermeta is an evolving software and despite that we put a lot of attention to this
        document, it may contain errors (more likely in the code samples). If you find any error or
        have some information that improves this document, please send it to us using the bug
        tracker in the forge: <a class="ulink" href="http://gforge.inria.fr/tracker/?group_id=32" target="_top">
          <span class="strong"><strong>http://gforge.inria.fr/tracker/?group_id=32</strong></span>
        </a> or using the developer mailing list (kermeta-developers@lists.gforge.inria.fr) Last
        check: v1.2.0.</p></td></tr></table></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="gfx/admonitions/tip.gif"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p> The most update version of this document is available on line from <a class="ulink" href="http://www.kermeta.org/" target="_top">http://www.kermeta.org</a> . </p></td></tr></table></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a name="chapter_introduction.link"></a>Chapter&nbsp;1.&nbsp;Introduction<span></span></h2></div></div></div><p>The Logo language is a small programming language to manage a pen-drawer turtle. Wherever
      the turtle goes, it draw lines to form figures. Logo was initially dedicated to introduce
      programming concepts to children.You can find more information about logo language <a class="ulink" href="http://fr.wikipedia.org/wiki/Logo_(langage)" target="_top">here</a>.</p><p>This tutorial will guide you from the installation of the necessary files to the analysis
      of the different part of the code so as to build a programming environnement for the Logo. </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="gfx/admonitions/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>We <span class="bold"><strong>recommend</strong></span> that you <span class="bold"><strong>firstly</strong></span> read the process-tutorial in order to look at the "<span class="bold"><strong>big picture</strong></span>" of what we are going to build here and to have an
        overview of the <span class="bold"><strong>methodology</strong></span> to follow.</p></td></tr></table></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a name="chapter_installation.link"></a>Chapter&nbsp;2.&nbsp;Installation<span></span></h2></div></div></div><p>In this task you'll learn how to install the predefined logo environment, create and run a
      workbench and install the predefined logo samples.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="section_prerequisted.link"></a>2.1.&nbsp;Prerequisites<span></span></h2></div></div></div><p>Below is the list of the things that you nned to ensure beforehand :</p><div class="itemizedlist"><ul type="disc"><li><p>You should intall Kermeta 1.3.3 on eclipse modelling. Further information on<a class="ulink" href="http://www.kermeta.org/documents/tutorials/tut-howtoinstall/" target="_top"> how to install
                Kermeta</a> and the <a class="ulink" href="../../../../fr.irisa.triskell.kermeta.documentation/build/html.single/Kermeta-Manual/index.html" target="_top">Kermeta language</a>;</p></li><li><p>You should be familiar with ecore metamodel;</p></li><li><p>You should be familiar with eclipse modelling environnement.</p></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="section_install_logo_projects.link"></a>2.2.&nbsp;Install logo projects<span></span></h2></div></div></div><p>Once you have an Eclipse modelling with Kermeta, get the tutorial projects by selecting
          <span class="bold"><strong>File -&gt; New -&gt; Example... -&gt; Kermeta Samples -&gt; Kermeta 2 Logo
          Demo</strong></span>.</p><p>At this point, you shoud have 1 project inside your workspace as illustrated in the
        figure below :</p><div class="itemizedlist"><ul type="disc"><li><p>a project named : <span class="bold"><strong>org.kermeta.kmlogo.logoasm.tutorial</strong></span> containing the files necessary for
            this tutorial.</p></li></ul></div><div class="figure"><a name="d0e162"></a><div class="figure-contents"><div class="mediaobject"><img src="Kermeta-Tutorial-Logo_figures/KermetaInstallLogo2.png" alt="Installation of the Kermeta Tutorial projects"></div></div><p class="title"><b>Figure&nbsp;2.1.&nbsp;Installation of the Kermeta Tutorial projects</b></p></div><br class="figure-break"></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a name="chapter_define_metamodel.link"></a>Chapter&nbsp;3.&nbsp;Define the metamodel<span></span><a name="chapter_MM"></a></h2></div></div></div><p>The first step of this tutorial is to define the abstract syntax. For the logo language,
      the concepts are the instructions to be executed : pen up, pen down, go forward, rotate left
      ... </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="gfx/admonitions/tip.gif"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p> If you want to learn more about how to create an ecore metamodel with eclipse, please
        refer to the available <a class="ulink" href="http://www.kermeta.org/documents/tutorials/tut-create_a_mm/" target="_top">tutorial</a>.</p></td></tr></table></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="section_from_ecore_to_generated_code.link"></a>3.1.&nbsp;From Ecore to genenerated
        code</h2></div></div></div><p>In order to define the metamodel, process as follow : </p><div class="procedure"><ol type="1"><li><p>Inside the project <span class="bold"><strong>
              org.kermeta.kmlogo.logoasm.tutorial</strong></span>, open ther folder <span class="bold"><strong>parts</strong></span> : Here you can see the folders corresponding to the sections of this
            tutorial.</p></li><li><p>Open the folder <span class="bold"><strong>1.metamodel</strong></span> and open the file
              <span class="bold"><strong>ASMLogo.ecore</strong></span> which is the metamodel of your language
            (here logo) and look at its content. In this ecore file you'll notice the various
            instructions supported by the DSL we are building. Some are primitives, for example :
            Back, Forward, Left, PenUp, ... Some are expressions, for example : Plus, Minus, ... And
            some are control structures, for example : If, while, Repeat, ...</p></li><li><p>Let's now set up the property of our metamodel: </p><div class="procedure"><ol type="1"><li><p>Inside the file <span class="bold"><strong>ASMLogo.ecore</strong></span>;</p></li><li><p>Select <span class="bold"><strong>kmLogo</strong></span> package, right-click on it and
                choose <span class="bold"><strong>show properties view</strong></span>;</p></li><li><p>Set the <span class="bold"><strong>ns URI</strong></span> to
                "http://www.kermeta.org/kmLogo" and save it;</p></li></ol></div></li><li><p>Then, create an <span class="bold"><strong>EMF Generator Model</strong></span> (File &gt; New..)
            and name it <span class="bold"><strong>ASMLogo.genmodel</strong></span>, hit next and chosse
              <span class="bold"><strong>Ecore model</strong></span> as model importers, hit next and import
            the previous metamodel (<span class="bold"><strong>Browse workspace</strong></span> &gt;
            org.kermeta.kmlogo.logoasm.tutorial/1.metamodel), <span class="bold"><strong>load</strong></span>
            it, hit next and finish.</p><div class="procedure"><ol type="1"><li><p>Open the file <span class="bold"><strong>ASMLogo.genmodel</strong></span>;</p></li><li><p>Unfold the root element <span class="bold"><strong>ASMLogo</strong></span> and select the
                  <span class="bold"><strong>kmLogo</strong></span> package;</p></li><li><p>Right-click on it and choose<span class="bold"><strong> show properties
                  View</strong></span> (if not already open),  set the <span class="bold"><strong>base
                  package</strong></span> (unfold All in property view) property to : <span class="bold"><strong>org.kermeta.kmlogo.logoasm.model</strong></span>;</p></li><li><p>For the <span class="bold"><strong>ASM package</strong></span> (unfold kmLogo package) set
                its <span class="bold"><strong>File Extension</strong></span> (unfold Model in the property
                view) property to "logoasm";</p></li><li><p>Right-click on the root element <span class="bold"><strong>ASMLogo</strong></span> and
                  choose<span class="bold"><strong> show properties View</strong></span> (if not already
                open); </p></li><li><p>In the <span class="bold"><strong>property view</strong></span>, unfold <span class="bold"><strong>Model</strong></span>: </p><div class="itemizedlist"><ul type="disc"><li><p>Set "Model Directory" to <span class="bold"><strong>/org.kermeta.kmlogo.logoasm.model/src</strong></span>
                    </p></li><li><p>Set "Model Plug-in ID" to <span class="bold"><strong>org.kermeta.kmlogo.logoasm.model</strong></span></p></li></ul></div></li><li><p>In the <span class="bold"><strong>property view</strong></span>, unfold <span class="bold"><strong>Edit</strong></span>: </p><div class="itemizedlist"><ul type="disc"><li><p>Set "Edit Directory" to <span class="bold"><strong>/org.kermeta.kmlogo.logoasm.edit/src</strong></span>
                    </p></li><li><p>Set "Edit Plug-in Class" to <span class="bold"><strong>org.kermeta.kmlogo.logoasm.kmLogo.provider.ASMLogoEditPlugin</strong></span></p></li><li><p>Set "Edit plug-in ID" to <span class="bold"><strong>org.kermeta.kmlogo.logoasm.edit</strong></span></p></li></ul></div></li><li><p>In the <span class="bold"><strong>property view</strong></span>, unfold <span class="bold"><strong>Editor</strong></span>: </p><div class="itemizedlist"><ul type="disc"><li><p>Set "Editor Directory" to <span class="bold"><strong>/org.kermeta.kmlogo.logoasm.editor/src</strong></span>
                    </p></li><li><p>Set "Editor Plug-in Class" to <span class="bold"><strong>org.kermeta.kmlogo.logoasm.kmLogo.presentation.ASMLogoEditorPlugin</strong></span></p></li><li><p>Set "Editor plug-in ID" to <span class="bold"><strong>org.kermeta.kmlogo.logoasm.editor</strong></span></p></li></ul></div></li><li><p>Save and go back to the genmodel editor, right-click on the <span class="bold"><strong>kmLogo package</strong></span> (unfold ASMLogo) and choose<span class="bold"><strong> show properties View</strong></span> (if not already open); </p></li></ol></div></li><li><p>Once we've set up these settings, save your generator model. Let's directly generate
            the associated code for our metamodel. (A needed step for the rest of the
            tutorial):</p><p>Inside the <span class="bold"><strong>ASMLogo.genmodel</strong></span>, right-click on kmLogo
            package and choose <span class="bold"><strong>Generate Model Code</strong></span>. This will add a
            new project <span class="bold"><strong>org.kermeta.kmlogo.logoasm.model</strong></span> to your
            structure.</p><p>Repeat the step above and choose<span class="bold"><strong> Generate Edit
            code</strong></span>. This will add a new project <span class="bold"><strong>org.kermeta.kmlogo.logoasm.model.edit</strong></span> to your structure.</p><p>Repeat again and choose<span class="bold"><strong> Generate Editor Code</strong></span>. This
            will add the project <span class="bold"><strong>org.kermeta.kmlogo.logoasm.model.editor</strong></span>.</p><p>You may <span class="bold"><strong>copy</strong></span> the files ASMLogo.ecore and
            ASMLogo.genmodel inside a folder <span class="bold"><strong>org.kermeta.kmlogo.logoasm.model/model</strong></span> in order to store them.</p><p>You should now have a project structure as illustrated below : </p><div class="figure"><a name="d0e416"></a><div class="figure-contents"><div class="mediaobject"><img src="Kermeta-Tutorial-Logo_figures/KermetaProjectStructure.png" alt="Project structure after generating the model, edit and editor code"></div></div><p class="title"><b>Figure&nbsp;3.1.&nbsp;Project structure after generating the model, edit and editor code</b></p></div><p><br class="figure-break"></p></li><li><p>Go back to the file <span class="bold"><strong>org.kermeta.kmlogo.logoasm.model/model/ASMLogo.ecore</strong></span>:</p><p>Right-click on it and initialise the ecore diagram file (more information about
            create an .ecorediag file from scratch is available here). </p><p>Name it <span class="bold"><strong>ASMLogo.ecorediag</strong></span>, hit next and choose
              <span class="bold"><strong>ASM</strong></span> package as a root element and finish to see the
            graphical representation of your metamodel (if you choose kmLogo as a root element then
            you will have to double-click on<span class="bold"><strong> Package ASM</strong></span> to open it
            and then <span class="bold"><strong>Create</strong></span> button from the window wizard). </p><p>You should obtain an overview of all the concepts in your metamodel (see the figure
            below).</p></li></ol></div><div class="figure"><a name="d0e446"></a><div class="figure-contents"><div class="mediaobject"><img src="Kermeta-Tutorial-Logo_figures/KermetaLogoMM.png" alt="The logo metamodel"></div></div><p class="title"><b>Figure&nbsp;3.2.&nbsp;The logo metamodel</b></p></div><br class="figure-break"><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="gfx/admonitions/important.gif"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p><span class="bold"><strong>Before going further</strong></span> in this tutorial, do not forget
          (if not already done) :</p><div class="itemizedlist"><ul type="disc"><li><p><a class="ulink" href="" target="_top">To set up the nsURI</a> of the <span class="bold"><strong>model/ASMLogo.ecore</strong></span> file;</p></li><li><p>To <a class="link" href="#section_package_registry.title.link">register this ecore
                  model</a> (In deployed mode (ie. in a runtime workbench), the ecore is
                automatically registered by the plugin, in development mode, you need to manually
                register it).</p></li></ul></div></td></tr></table></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="section_metamodel_with_kermeta.link"></a>3.2.&nbsp;Metamodel Ecore with Kermeta</h2></div></div></div><p>Many ecore tools allow you to create your metamodel. Kermeta allows you to do it in a
        "programmatical" way. Analyse the content of the listing below and see what does it stand
        for : </p><pre class="programlisting">
@uri "http://www.kermeta.org/kmLogo"
package kmLogo;

require "kermeta"
alias Integer : kermeta::standard::Integer;
alias Boolean : kermeta::standard::Boolean;
alias String : kermeta::standard::String;
package ASM
{
	abstract class Instruction
	{
	}
	abstract class Primitive inherits Instruction
	{
	}
	class Back inherits Primitive
	{
		attribute steps : Expression[1..1]

	}
	class Forward inherits Primitive
	{
		attribute steps : Expression[1..1]

	}
	class Left inherits Primitive
	{
		attribute angle : Expression

	}
	class Right inherits Primitive
	{
		attribute angle : Expression

	}
	class PenDown inherits Primitive
	{
	}
	class PenUp inherits Primitive
	{
	}
	class Clear inherits Primitive
	{
	}
	abstract class Expression inherits Instruction
	{
	}
	abstract class BinaryExp inherits Expression
	{
		attribute lhs : Expression[1..1]

		attribute rhs : Expression[1..1]

	}
	class Constant inherits Expression
	{
		attribute integerValue : Integer

	}
	class ProcCall inherits Expression
	{
		attribute actualArgs : Expression[0..*]

		reference declaration : ProcDeclaration[1..1]#procCall

	}
	class ProcDeclaration inherits Instruction
	{
		attribute name : String

		attribute args : Parameter[0..*]

		attribute block : Block

		reference procCall : ProcCall[0..*]#declaration

	}
	class Block inherits Instruction
	{
		attribute instructions : Instruction[0..*]

	}
	class If inherits ControlStructure
	{
		attribute thenPart : Block[1..1]

		attribute elsePart : Block

	}
	class ControlStructure inherits Instruction
	{
		attribute condition : Expression

	}
	class Repeat inherits ControlStructure
	{
		attribute block : Block[1..1]

	}
	class While inherits ControlStructure
	{
		attribute block : Block[1..1]

	}
	class Parameter
	{
		attribute name : String

	}
	class ParameterCall inherits Expression
	{
		reference parameter : Parameter[1..1]

	}
	class Plus inherits BinaryExp
	{
	}
	class Minus inherits BinaryExp
	{
	}
	class Mult inherits BinaryExp
	{
	}
	class Div inherits BinaryExp
	{
	}
	class Equals inherits BinaryExp
	{
	}
	class Greater inherits BinaryExp
	{
	}
	class Lower inherits BinaryExp
	{
	}
}
</pre><p>Inside <span class="bold"><strong>org.kermeta.kmlogo.logoasm.model/model</strong></span>, create a
        new folder <span class="bold"><strong>srcKermeta</strong></span>.</p><p>Inside this newly created folder, create a new Kermeta file (.<span class="bold"><strong>kmt</strong></span>) and program the listing above inside (to save time, after analysing the
        listing above, you may copy/paste to replace the generated code). </p><p>After saving, right-click on it and choose <span class="bold"><strong>Kermeta &gt; Generate
          Ecore</strong></span>. </p><p>You should retrieve our logo language's .ecore representation that we saw before.</p></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a name="chapter_editor.link"></a>Chapter&nbsp;4.&nbsp;Editor<span></span><a name="chapter_editor"></a></h2></div></div></div><p>In this task, you will learn how to provide editors to create model instances which
      conforms to your metamodel. There are many ways to do so however in this tutorial we will
      focus more on the textual editor. As these techniques are independant each others, you can
      experiment each of them according to your needs.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="section_dynamic_instance.link"></a>4.1.&nbsp;Dynamic instance<span></span><a name="section_dynamic_instance"></a></h2></div></div></div><p>First option is through the dynamic instance. To do so :</p><div class="procedure"><ol type="1"><li><p>Open the file <span class="bold"><strong>ASMLogo.ecorediag</strong></span> inside the folder
              <span class="bold"><strong>org.kermeta.kmlogo.logoasm.model/model</strong></span>.</p></li><li><p> Go to the <span class="bold"><strong>outline view</strong></span>. Select the top level
            element inside your metamodel (for example here the Block).</p></li><li><p> Right-click on this element and choose <span class="bold"><strong>Create a dynamic
              instance</strong></span>.</p><div class="figure"><a name="d0e535"></a><div class="figure-contents"><div class="mediaobject"><img src="Kermeta-Tutorial-Logo_figures/KermetaDynamicInst.png" alt="Creating a dynamic instance"></div></div><p class="title"><b>Figure&nbsp;4.1.&nbsp;Creating a dynamic instance</b></p></div><br class="figure-break"><p> Name your dynamic model "dots.xmi" and hit finish.</p></li></ol></div><p>Then you can add childs or sibling for the element to construct you model instance. At
        the end, you can obtain a model conform to the logo language in xmi format. </p><p>If you want to learn more, follow the complete example below or check out the other
        available example in the FSM Tutorial.</p><div class="example"><a name="d0e547"></a><div class="example-contents"><div class="orderedlist"><ol type="1"><li><p>Right-click on the file "dots.xmi" and choose "open with .. &gt; Sample Reflective
              Ecore Model Editor".</p></li><li><p>In the editor, unfold "...dots.xmi" and right-click on Block element. Choose
                <span class="bold"><strong>New child &gt; Instructions Right</strong></span> to position the
              turtle. </p></li><li><p>Then, right-click on "Instruction Right" and choose <span class="bold"><strong>New
                child &gt; Angle Constant</strong></span> to define the angle of the rotation. Select the
              element "Constant" and in the properties view, set the <span class="bold"><strong>Intetger
                Value</strong></span> to 90.</p></li><li><p>We set the fisrt instruction. In the editor, right-click and choose <span class="bold"><strong>Validate</strong></span> to check wether your model instance newly created is
              conform to the defined metamodel.</p></li><li><p>Then you can keep on building your model instance : Right-click on "Right"
              element, choose <span class="bold"><strong>New Sibling &gt; Instructions penDown</strong></span> to
              tell the turtle to be "ready to write".</p></li><li><p> After that, Right-click on "PenDown" and choose <span class="bold"><strong>New Sibling
                &gt; Instructions Forward</strong></span> then like we did before, create the <span class="bold"><strong>steps Constant</strong></span> child and set the value to 10. That tell the
              turtle to "draw" the line on 10 of the given metric (pixel).</p></li><li><p>Repeat these above steps to complete your model instance like the illustration
              below and do not forget to <span class="bold"><strong>Validate</strong></span> to check
              conformance from time to time.</p></li></ol></div></div><p class="title"><b>Example&nbsp;4.1.&nbsp;Example creation of the dots.xmi</b></p></div><br class="example-break"><div class="figure"><a name="d0e596"></a><div class="figure-contents"><div class="mediaobject"><img src="Kermeta-Tutorial-Logo_figures/KermetaBlocXmi.png" alt="dots.xmi illustration"></div></div><p class="title"><b>Figure&nbsp;4.2.&nbsp;dots.xmi illustration</b></p></div><br class="figure-break"><p>You have just finished creating your first model instance, save it and keep an eye on it
        because we are going to reuse it later in this tutorial.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="section_tree_view_editor.link"></a>4.2.&nbsp;Tree view editor<span></span></h2></div></div></div><p>Using the tree-view editor is the second way to manipulate metamodel instances. Open
        your ecore file and select a top level element inside your metamodel (for instance Block).
        Right-click on that element and seclect New Child or New Sibling to add elements like we've
        seen on the previous section.</p><p>This step is also largly covered in the FSM tutorial.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="section_textual_editor.link"></a>4.3.&nbsp;Textual editor<span></span></h2></div></div></div><p>A textual editor is also available in order to create a model instance conform to our
        metamodel and can be processed by the interpreter. In this example we will use <a class="ulink" href="http://www.emftext.org" target="_top">EMFText</a> to generate the concrete syntax of our
        metamodel. </p><p>Follow these steps to set up the concrete syntax of your language and its assocoated
        textual editor : </p><div class="procedure"><ol type="1"><li><p>Create a java project and name it : <span class="bold"><strong>org.kermeta.kmlogo.logoasm.emftexteditor</strong></span>. Create a folder <span class="bold"><strong>concrete_syntax</strong></span> inside.</p></li><li><p>Back to the project<span class="bold"><strong>
              org.kermeta.kmlogo.logoasm.tutorial</strong></span>, open the folder <span class="bold"><strong>1.metamodel/concrete_syntax</strong></span> which contain the file : <span class="bold"><strong>ASMLogo.cs</strong></span>.</p></li><li><p>Copy and paste this file into the newly created folder <span class="bold"><strong>org.kermeta.kmlogo.logoasm.emftexteditor/concrete_syntax/</strong></span>.</p><p>Right-clic on the file <span class="bold"><strong>ASMLogo.cs</strong></span> and choose "Open
            With ..." &gt; "EMFText cs editor". Analyse its content : it follow the structure of .cs
            file as described in the <a class="ulink" href="http://www.emftext.org/index.php/EMFText_CS_Language_Reference" target="_top">emftext CS
              language reference</a>.</p><p>Here, we defined the file extension of our DSL (logo), link it to our metamodel
            (through the nsUri) and define the style and the concrete rules for each concept that we
            want to map.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="gfx/admonitions/tip.gif"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>If you meet with some errors, be sure that you register your ecore and that the
              path to your genmodel is correct.</p></td></tr></table></div></li><li><p>Right-click on <span class="bold"><strong>ASMLogo.cs</strong></span> file and choose <span class="bold"><strong>generate Text Ressource</strong></span>.</p><p>This would add two project in your structure : <span class="bold"><strong>org.emftext.commons.antlr3_1_1</strong></span> and <span class="bold"><strong>org.kermeta.kmlogo.logoasm.model.kmLogo.resource.logo</strong></span>.</p></li></ol></div><p>You have just finished to set up your text editor. Keep going through this tutorial to
        test it inside a real interpreter.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="section_gmf_editor.link"></a>4.4.&nbsp;GMF editor<span></span></h2></div></div></div><p>The graphical way to manipulate your metamodel can be done with the GMF editor. </p><p>For further information, please refer to the FSM tutorial on how to graphically edit
        your metamodel.</p></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a name="chapter_model_manipulation_kermeta.link"></a>Chapter&nbsp;5.&nbsp;Model manipulation in
      Kermeta<span></span></h2></div></div></div><p>Thesa are few steps on how to manipulate metamodel in Kermeta. This is about why to
      register your metamodel and how to load/save it.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="section_package_registry.link"></a>5.1.&nbsp;Package registry<span></span></h2></div></div></div><p>This step is fully covered in the FSM tutorial, please refer to this example for further
        information.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="section_serialisation.link"></a>5.2.&nbsp;Serialisation<span></span></h2></div></div></div><p>The FSM tutorial provided a complete example for this part.</p></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a name="chapter_contract.title.link"></a>Chapter&nbsp;6.&nbsp;Contract<span></span><a name="chapter_contract"></a></h2></div></div></div><p>Let's now add some <span class="bold"><strong>static semantic</strong></span> to our metamodel i.e.
      add missing pre/post-conditions to our .ecore in order to express the contraints specified in
      the metamodel.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="section_static_semantics.link"></a>6.1.&nbsp;Static semantics<span></span></h2></div></div></div><p>For this step we are going to add two contracts to our metamodel:</p><div class="itemizedlist"><ul type="disc"><li><p>"no two formal parameters of a procedure may have the same name";</p></li><li><p>"each procedure call provide the same number of arguments as specified in its
              declaration".</p></li></ul></div><p>In OCL you will have the listing below to express it : </p><pre class="programlisting">
package kmLogo::ASM

context ProcCall 
inv apropriate_number_of_actual_parameters :
	actualArgs-&gt;size() = declaration.args-&gt;size()
	
context ProcDeclaration 
inv unique_names_for_formal_arguments :
		args-&gt;forAll ( a1 | args-&gt;forAll ( a2 | a1.name = a2.name implies a1 = a2 ))

endpackage
</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="section_kermeta_implementation.link"></a>6.2.&nbsp;Implementation in
        Kermeta<span></span></h2></div></div></div><p>Kermeta offers same mechanism as OCL to navigate inside the elements. Through aspect
        weaving, Kermeta allow to reopen a class and weave an aspect inside in order to add this
        pre/post conditions. Let's implement the example above in Kermeta :</p><div class="procedure"><ol type="1"><li><p>Create a new plug-in project <span class="bold"><strong>org.kermeta.kmlogo.logoasm.srcKermeta</strong></span> (set all by default, hit next and
            finish). </p><p>Create a folder <span class="bold"><strong>kermeta</strong></span> inside. This is the folder
            where we are going to put all kermeta sources for this tutorial.</p></li><li><p>Inside the folder <span class="bold"><strong>kermeta</strong></span>, create a folder
              <span class="bold"><strong>2.Constraints</strong></span>.</p><p>Inside the folder <span class="bold"><strong>2.Constraints</strong></span>, create a new
            kermeta file <span class="bold"><strong>ASMLogoStaticSemantics.kmt</strong></span> to reopen the
            ProcDeclaration class and weave invariants as aspects into it following the listing
            below (you may copy/paste it if you've already analysed it first): </p><pre class="programlisting"> 
package kmLogo::ASM;
require kermeta
require "http://www.kermeta.org/kmLogo"

aspect class ProcDeclaration{
	/**
	 * No two formal parameters of a procedure may have the same name
	 */
	inv unique_names_for_formal_arguments is
	do
		args.forAll{ a1 | args.forAll{ a2 | 
			a1.name.equals(a2.name).implies(a1.equals(a2))}}
	end
}

aspect class ProcCall{	
	/** 
	 * A procedure is called with the same number of arguments as specified in its declaration
	 */
	inv same_number_of_formals_and_actuals is do 
		actualArgs.size == declaration.args.size
	end 
}
</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="gfx/admonitions/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>If you get errors on "http://www.kermeta.org/kmLogo", check your package
              registration. you may hit the <span class="bold"><strong>check this file</strong></span> button
              (on Kermeta's perspective toolbar) to refresh.</p></td></tr></table></div></li><li><p>After saving it, let's see the results. </p><p>To do so go back to the project <span class="bold"><strong>org.kermeta.kmlogo.logoasm.tutorial</strong></span> for a while.</p><p>Copy the folders: </p><div class="itemizedlist"><ul type="disc"><li><p><span class="bold"><strong>org.kermeta.kmlogo.logoasm.tutorial/parts/2.constracts/models</strong></span> which
                  contains the models conform to our metamodel ecore;</p></li><li><p><span class="bold"><strong>org.kermeta.kmlogo.logoasm.tutorial/parts/2.constracts/tests</strong></span> which
                  contains the main operation for testing the constraints on these models.</p></li></ul></div><p>Paste these folders and its content into <span class="bold"><strong>org.kermeta.kmlogo.logoasm.srcKermeta/kermeta/2.Constraints</strong></span>.</p></li><li><p>Open the file <span class="bold"><strong>tests/CheckModels.kmt</strong></span> and analyse its
            purpose.</p><p>It loads the models inside the models folder and require the kermeta file that we've
            created before.</p></li><li><p>Let's now run our first Kermeta application : Right-click on the file <span class="bold"><strong>CheckModels.kmt</strong></span> and choose <span class="bold"><strong>Run as &gt; Run
              as Kermeta application</strong></span>. </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="gfx/admonitions/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>If you get errors, again, check that you did not forget to register you ecore.
                Maybe it is necessary to clean all the projects or launch the kermeta cleaner (trash
                bin with kermeta icon on your toolbar) or hit the kermeta validator ("check this
                file" button in Kermeta perspective toolbar)</p></td></tr></table></div><p>On your console view, you should view the result below (you can review the models to
            see its conformance to the ecore ) : </p><div class="figure"><a name="d0e827"></a><div class="figure-contents"><div class="mediaobject"><img src="Kermeta-Tutorial-Logo_figures/KermetaOutput.png" alt="Kermeta application checkModels output"></div></div><p class="title"><b>Figure&nbsp;6.1.&nbsp;Kermeta application checkModels output</b></p></div><br class="figure-break"></li></ol></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="gfx/admonitions/important.gif"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p><span class="bold"><strong>Remember</strong></span> : To check the constraints in Kermeta, you
          should call the method <span class="bold"><strong>checkAllInvariants()</strong></span> on root
          element of the model (here the one from <span class="bold"><strong>models/carre.logoasm</strong></span>)</p></td></tr></table></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a name="chapter_behaviour.link"></a>Chapter&nbsp;7.&nbsp;Behaviour<a name="chapter_behaviour"></a></h2></div></div></div><p>Let us now add some <span class="bold"><strong>operational semantics</strong></span> to our
      metamodel. To do so, we are going to add the actions we wish to implement thanks to the
      weaving mechanism in Kermeta.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e853"></a>7.1.&nbsp;Preparation of the environnement<span></span></h2></div></div></div><p>First of all let's prepare the appropriate environnement needed for this implementation.
        The concerned project during this chapter will be <span class="bold"><strong>org.kermeta.kmlogo.logoasm.srcKermeta</strong></span>.</p><div class="procedure"><ol type="1"><li><p>Copy the folders and its content inside <span class="bold"><strong>org.kermeta.kmlogo.logoasm.tutorial/parts/3.behaviour/...</strong></span> into <span class="bold"><strong>org.kermeta.kmlogo.logoasm.srcKermeta/kermeta/</strong></span> i.e.: </p><div class="itemizedlist"><ul type="disc"><li><p><span class="bold"><strong>1.Models</strong></span> where there is the models we are
                  going to simulate;</p></li><li><p><span class="bold"><strong>3.JavaInterfaces</strong></span> where we ca see the needed
                  java program for this tutorial;</p></li><li><p><span class="bold"><strong>4.VirtualMachine</strong></span> where are defined the
                  application domain;</p></li><li><p><span class="bold"><strong>5.Simulator</strong></span> where the execution program are
                  provided.</p></li></ul></div></li><li><p>Inside the <span class="bold"><strong>org.kermeta.kmlogo.logoasm.srcKermeta/src</strong></span> create two packages <span class="bold"><strong>org.kermeta.kmLogo.gui</strong></span> and <span class="bold"><strong>org.kermeta.kmLogo.wrapper</strong></span>.</p><p>Move the files from :</p><div class="itemizedlist"><ul type="disc"><li><p><span class="bold"><strong>3.JavaInterfaces/gui/</strong></span> into the package
                    <span class="bold"><strong>org.kermeta.kmLogo.gui</strong></span>;</p></li><li><p><span class="bold"><strong>3.JavaInterfaces/wrapper/</strong></span> into the package
                    <span class="bold"><strong>org.kermeta.kmLogowrapper</strong></span> (you may delete the
                  folder <span class="bold"><strong>3.JavaInterfaces/gui/</strong></span> and <span class="bold"><strong>3.JavaInterfaces/wrapper/</strong></span> after).</p></li></ul></div></li><li><div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Caution"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Caution]" src="gfx/admonitions/caution.gif"></td><th align="left">Caution</th></tr><tr><td align="left" valign="top"><p>At this point, you should have errors on your wrapper package. It is normal, we
              haven't set up the plugin yet. Though these next steps are not really part of Kermeta
              processing, we have to fix these errors to keep on.</p></td></tr></table></div><p>Replace the file <span class="bold"><strong>META-INF/MANIFEST.MF</strong></span> by the one
            you can find in <span class="bold"><strong>3.JavaInterfaces/plugin</strong></span>. The manifest
            tell the project about its configuration (dependencies, exported package, runtime, ...).
            Have a look at its content and observe how to solve the problem (If errors still
            persist, continue next step).</p><p>Copy the file <span class="bold"><strong>plugin.xml</strong></span> in <span class="bold"><strong>3.JavaInterfaces/plugin</strong></span> and paste it on the root of your project. This is
            the file which handle the plug-in nature of the project. Observe its content (extension,
            ..). (you may delete the folder <span class="bold"><strong>3.JavaInterfaces/plugin</strong></span>
            and the package <span class="bold"><strong>src/org.kermeta.kmlogo.logoasm.srckermeta
            </strong></span> since we don't use it.</p></li><li><p>At this point your project<span class="bold"><strong>
              org.kermeta.kmlogo.logoasm.srcKermeta</strong></span> should have no error and present the
            structure illustrated below:</p><div class="figure"><a name="d0e962"></a><div class="figure-contents"><div class="mediaobject"><img src="Kermeta-Tutorial-Logo_figures/KermetaSrcStructure.png" alt="org.kermeta.kmlogo.logoasm.srcKermeta project structure"></div></div><p class="title"><b>Figure&nbsp;7.1.&nbsp;org.kermeta.kmlogo.logoasm.srcKermeta project structure</b></p></div><br class="figure-break"></li></ol></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="section_dynamic_semantic.link"></a>7.2.&nbsp;Dynamic semantic<span></span></h2></div></div></div><p>Thanks to the weaving, we are going to add some operations and properties to the
        ASMLogo.ecore in order to provide an operational semantics to Logo. </p><p>We will weave an interpreter to the ASM by adding "eval" operations to the ASM
        metaclasses. This eval operation will pass the actual context of the program.</p><div class="procedure"><ol type="1"><li><p>Open <span class="bold"><strong>org.kermeta.kmlogo.logoasm.srcKermeta/kermeta/5.Simulator/LogoDynSemantics.kmt</strong></span>
            and observe how the weaving (obtained through the require statement at the beginning of
            the LogoDynSemantics.kmt) adds some operations and properties to the
            ASMLogo.ecore.</p></li><li><p>In the top right corner of the <span class="bold"><strong>outline view</strong></span>, unfold
              <span class="bold"><strong>kmlogo::ASM package</strong></span>. Then use the red/blue package
            icon to see what comes from the opened kmt file (ine <span class="bold"><strong>red</strong></span>) and what comes from the imported files (in <span class="bold"><strong>blue</strong></span>). So the "blue-red-mix" colored icon tell you that the class has an
            aspect weaved into it.</p></li><li><p>Find the class <span class="bold"><strong>Repeat</strong></span> and observe that it only has
            a Block property imported from the ecore.</p><p>Inside this class, let's now simply add operational behavior in the eval operation
            as following:</p><pre class="programlisting">aspect class Repeat
	{
		method eval(context : Context) : Integer is do 
			from var i : Integer init condition.eval(context)
			until i &lt; 1
			loop
				result := block.eval(context)
				i := i - 1
			end
		end 
	}</pre><p>Save the file and observe that the method eval was added in the outline view of the
            class Repeat. And because this aspect comes from this opened kmt file it is colored in
            red (see figure below).</p><div class="figure"><a name="d0e1010"></a><div class="figure-contents"><div class="mediaobject"><img src="Kermeta-Tutorial-Logo_figures/KermetaAspectOutlineView.png" alt="Outline view"></div></div><p class="title"><b>Figure&nbsp;7.2.&nbsp;Outline view</b></p></div><p><br class="figure-break"></p></li><li><p>Finally, find the class <span class="bold"><strong>Context</strong></span>, and observe what
            is passed between eval() calls.</p></li></ol></div><p>At this point, you know how to weave operational semantic to Kermeta and rapidly
        identify them from the imported one inside the Outline view. Aspected classes are
        represented in Red/Blue color.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="section_virtual_machine.link"></a>7.3.&nbsp;Virtual machine<span></span></h2></div></div></div><p>In order to provide the behavior, the interpreter needs an application domain. In this
        sample we call it Virtual Machine (VM).</p><div class="procedure"><ol type="1"><li><p>Open the file <span class="bold"><strong>org.kermeta.kmlogo.logoasm.srcKermeta/kermeta/4.VirtualMachine/VMLogo.ecore</strong></span>,
            initialise its ecore diagram file to see its representation. </p><p>In this ecore file you'll notice the various notions needed for this VM : turtle,
            segment and points. </p></li><li><p>Open <span class="bold"><strong>4.VirtualMachine/LogoVMSemantics.kmt</strong></span> and
            observe how the weaving (obtained through the require statement at the beginning of the
            LogoVMSemantics.kmt) adds some operations and properties to the VMLogo.ecore. Those
            operations have some impacts on the GUI through command like stdio.writeln. </p></li><li><p>Like in the section before, use the outline view to identify what has been added (in
            red) to the structure (in bue).</p></li><li><p>Find the operation <span class="bold"><strong>move</strong></span> in the class <span class="bold"><strong>Turtle</strong></span> and observe some interactions with the UI
            (stdio.out).</p></li></ol></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="gfx/admonitions/important.gif"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>As you may have noticed inside <span class="bold"><strong>LogoVMSemantics.kmt</strong></span>,
          there is a call (require to the beginning of the file) to <span class="bold"><strong>Math.kmt</strong></span> which is a Java interface needed to properly execute the simulator.
            So<span class="bold"><strong> before moving onto the testing the simulator</strong></span>, let's
          have a look at how to set up this interface into the next section.</p></td></tr></table></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e1069"></a>7.4.&nbsp;Operational semantics extra<span></span></h2></div></div></div><p>In this step, we will see how some extra feature has been implemented in the operational
        sematics. It will explain how to call some java code to implement extra features.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a name="section_call_javaMath.link"></a>7.4.1.&nbsp;Call to java.Math</h3></div></div></div><p>This step will show you how a call to java may workaround some missing feature in
          Kermeta. It will explain how how to call java.lang.Math from Kermeta. This is useful since
          the Kermeta doesn't provides sin, cos, tan operator by default. This may also be useful in
          case of major performance issue for a specific task.</p><div class="procedure"><ol type="1"><li><p>Open <span class="bold"><strong>org.kermeta.kmlogo.logoasm.srcKermeta/kermeta/3.JavaInterfaces/Math.kmt</strong></span>
              which is the Kermeta wrapper. It defines the operations as seen by a kermeta code. The
              calls to java are done using the <span class="bold"><strong>extern</strong></span> keyword. It
              will call the static java operation with the given qualified name.</p></li><li><p>Then, open the file <span class="bold"><strong>src/org.kermeta.kmlogo.wrapper/Math.java</strong></span> the Java wrapper. It defines
              the static operations that the interpreter can call. All parameters must be of type
              RuntimeObject. This class is in charge of:</p><div class="itemizedlist"><ul type="disc"><li><p>translating the RuntimeObject to and from classical java object (here
                    java.lang.Real);</p></li><li><p>calling the appropriate java code </p></li></ul></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="gfx/admonitions/tip.gif"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>Remember that the objects in java side must implement a RuntimeObject in order
                to be manipulated with Kermeta. This is why all static method contains Runtimeobject
                parameters which is the Kermeta object kept in memory at runtime, and at last, must
                return a RuntimeObject. </p><p>Also notice that the conversion to java types is done by the <span class="bold"><strong>TYPE.create()</strong></span> method.</p></td></tr></table></div></li><li><p>So in order to use these wrapper, simply <span class="bold"><strong>import</strong></span>
              the Math.kmt file where you need it (here in <span class="bold"><strong>LogoVMSemantics.kmt</strong></span>). And use it as a normal kermeta class. Since both
              java code is contained by the same plugin, there is no need of classpath declaration.
              If you need to use java code from another plugin, make sure that your plugin has a
              dependency to it. </p></li><li><p>To test this section, open the kermeta file <span class="bold"><strong>3.JavaInterfaces/test/testMath.kmt</strong></span> which contains the main operation to
              launch the java wrapper. Observe how a main class is defined in Kermeta and the use of
              Math.kmt.</p><p>Right-click on <span class="bold"><strong>testMath.kmt</strong></span> and choose <span class="bold"><strong>Run &gt; Run as Kermeta Application</strong></span>, you should obtain the
              results illustrated below :</p><div class="figure"><a name="d0e1134"></a><div class="figure-contents"><div class="mediaobject"><img src="Kermeta-Tutorial-Logo_figures/KermetaCallJava.png" alt="Call to java Math results"></div></div><p class="title"><b>Figure&nbsp;7.3.&nbsp;Call to java Math results</b></p></div><p><br class="figure-break"></p></li></ol></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a name="section_implementing_graphical_output.link"></a>7.4.2.&nbsp;Implementing a graphical
          output<span></span></h3></div></div></div><p>This section will guide you through the code of the implementation of a graphical
          interface for the logo turtle. It is similiar to the call to Java.Math previously
          seen.</p><div class="procedure"><ol type="1"><li><p>Open the file <span class="bold"><strong>org.kermeta.kmlogo.logoasm.srcKermeta/kermeta/3.JavaInterfaces/TurtleGUI.kmt</strong></span>.
              Like the java call that we have previously seen, it correspond to the kermeta wrapper.
              It defines the classes as seen by kermeta programs. For this application, it provides
              operations like drawLine, drawTurtle or clearDrawing. Note that it need an
              "initialize" operation in order to correctly create the object. </p></li><li><p>Then open the file<span class="bold"><strong>org.kermeta.kmlogo.logoasm.srcKermeta/src/org.kermeta.kmlogo.wrapper/TurtleGUIWrapper.java</strong></span>.
              It defines the static operations that the interpreter can call. All parameters must be
              of type RuntimeObject. This class is in charge of :</p><div class="itemizedlist"><ul type="disc"><li><p>translating the RuntimeObject to and from classical java object;</p></li><li><p>calling the appropriate java code. The associated java object (here a
                    ITurtleGUI) is stored into the UserData of the RuntimeObject. </p></li></ul></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="gfx/admonitions/tip.gif"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>Again, remember that the objects in java side must implement a RuntimeObject in
                order to be manipulated with Kermeta. This is why all static method contains
                Runtimeobject parameters which is the Kermeta object kept in memory at runtime, and
                at last, must return a RuntimeObject. </p><p>Also notice that the <span class="bold"><strong>initialize()</strong></span> method allow
                the "conversion" into java side i.e.: it creates a java object from the given name
                so as to represent the GUI (turtleGUI). Then it sets this object inside the
                RuntimeObject by the method <span class="bold"><strong>setUserData()</strong></span> to store
                it for later re-use which is done with <span class="bold"><strong>getUserData()</strong></span>. The conversion to java types is done by the <span class="bold"><strong>TYPE.getValue()</strong></span> method in this direction. </p><p>So if you want to implement yours, be sure that all your java object are not
                external to the Kermeta (RuntimeObject) domain, otherwise you must implement an
                internal controller to set up the glue (i.e.: the mapping).</p></td></tr></table></div></li><li><p>Then, the extra step here is implementing the graphical user interface. This is
              done by the classes in <span class="bold"><strong>org.kermeta.kmlogo.logoasm.srcKermeta/src/org.kermeta.kmlogo.gui/</strong></span>. In
              order to allow some extensibility, it has been splitted in 2, an interface <span class="bold"><strong>ITurtleGUI</strong></span> and a simple concrete AWT implementation <span class="bold"><strong>TurtleSimpleAWTGUI</strong></span>.</p></li><li><p>The last step before testing is to provide a simple controler that ask to the GUI
              to update the graphical view of a given Turtle. This is done by the file: <span class="bold"><strong>4.VirtualMachine/TurtleControler.kmt</strong></span> which implement
                <span class="bold"><strong>4.VirtualMachine/MoveListener.kmt</strong></span> (merely a turtle
              movement listener).</p></li><li><p>After succesfully testing the call to Java.Math, let's now test the virtual
              machine that we saw in section 7.3. To do so, open <span class="bold"><strong>4.VirtualMachine/tests/testVM.kmt</strong></span>. This file will initiate a turtle and
              draw a square using the kermeta wrappers and the java wrappers that we saw before
              (look at the required files define at the beginning of the kmt to see the interaction
              between the files). Right-click on this file an <span class="bold"><strong>run it as a
                Kermeta application</strong></span> to see the graphical representation illustred below
              (notice by the way the console output that illustrate the impact of the GUI as
              mentioned in the step 2 of section 7.3): </p><div class="figure"><a name="d0e1215"></a><div class="figure-contents"><div class="mediaobject"><img src="Kermeta-Tutorial-Logo_figures/KermetaLogoOutput.png" alt="VM testing output"></div></div><p class="title"><b>Figure&nbsp;7.4.&nbsp;VM testing output</b></p></div><p><br class="figure-break"></p></li><li><p>Open <span class="bold"><strong>org.kermeta.kmlogo.logoasm.srcKermeta/5.Simulator/
                LogoSimulator.kmt</strong></span>. This class provides an execute operation. This
              operation allows to load a model that conforms to the ASMLogo.ecore and start the
              evaluation of the logo instructions. Finally, it asks to the controler to update the
              graphical view. This is the main entry and the loader for a logo model
              instance.</p><p>Now that we are sure that the VM is working correctly, let's test the interpreter
              that we have set up. To do so, open the file <span class="bold"><strong>5.Simulator/tests/carre.kmt</strong></span>. It will instanciate a simulator, load a
              model from <span class="bold"><strong>1.Models/carre.logoasm</strong></span> and execute the
              interpreter. Right-click the file and<span class="bold"><strong> run as kermeta
                application</strong></span>, you should obtain the same illustration as before. </p></li><li><p>Let's have another test. Remember the "dots.xmi" that you created before inside
                <span class="bold"><strong>org.kermeta.kmlogo.logoasm.model/model</strong></span> (if not a
              copy is available at "org.kermeta.kmlogo.logoasm.tutorial/parts/1.metamodel/model").
              Move it to the folder <span class="bold"><strong>org.kermeta.kmlogo.logoasm.srcKermeta/kermeta/1.Models/</strong></span>. Open it and
              save it as <span class="bold"><strong>dots.logoasm</strong></span> so as to convert it as a
              model instance understandable by our interpreter. Now, open the file <span class="bold"><strong>5.Simulator/tests/dots.kmt</strong></span> and see that it calls the model
              we've just renamed. Run it as a Kermeta application to see the results (you can test
              the other models (*.logoasm) in the folder <span class="bold"><strong>1.Model</strong></span>).</p></li></ol></div></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a name="chapter_model_transformation_compilation.link"></a>Chapter&nbsp;8.&nbsp;Model transformation -
        Compilation<a name="chapter_model_transformation_compilation"></a></h2></div></div></div><p>In this next step, we'll discover how to map a logo language to lego Mindstorm
      environnement. Logo language here is like a PIM and the target program is like a PSM. </p><p>Kermeta allow to weave a "compilation" aspect into the logo metamodel.</p><div class="procedure"><ol type="1"><li><p>Copy the folder <span class="bold"><strong>org.kermeta.kmlogo.logoasm.tutorial/parts/4.compiler/6.NXTCompiler</strong></span> to
            <span class="bold"><strong>org.kermeta.kmlogo.logoasm.srcKermeta/kermeta</strong></span>
        </p></li><li><p>Open the file <span class="bold"><strong>6.NXTCompiler/LogoNXCCompiler.kmt</strong></span>. It
          adds some operations and properties to the ASMLogo.ecore. In order to provide a compiler
          to Logo, it weaves "compileToNXC" operations to the ASM metaclasses. The compiled code
          uses a predefined API specific to the target platform (here a Lego Mindstorm
          robot).</p></li><li><p>Find operation "compileToNXC" of class "If" and observe how the code is
          compiled.</p></li><li><p>Find operation compileToStdOut() of class "NXCCompiler", normally (when we fix the
          compiler as now  it is hard coded) it should call an operation "getAPI" to define the base
          API of the target platform.</p><p>To launch compiling, refer to the "chapter 10 Using the deployed DSL
          environment".</p></li></ol></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a name="chapter_ui_improvements.link"></a>Chapter&nbsp;9.&nbsp;UI improvements</h2></div></div></div><p>This chapter introduces the code needed to deploy a Kermeta code for a end user (eclipse
      GUI). It will use the interpreter as sample. </p><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="section_gui_deployement.link"></a>9.1.&nbsp;GUI deployment setup<span></span></h2></div></div></div><p>We need to add some GUI elements to interract with the interpreter sample through
        eclipse GUI. </p><div class="procedure"><ol type="1"><li><p>Create a new plug-in project and name it : <span class="bold"><strong>org.kermeta.kmlogo.logoasm.ui</strong></span>. This plugin project contains the eclipse
            extension and the code that allows to launch a kermeta program from Eclipse GUI. This
            allows to hide to the end user in which language the transformation is written.</p><p>On the creational wizard : Be sure that you set the activator at <span class="bold"><strong>org.kermeta.kmlogo.logoasm.ui.Activator</strong></span> then hit next.</p><p>Select<span class="bold"><strong> custom plug-in wizard</strong></span> and select <span class="bold"><strong>New File Wizard</strong></span> and <span class="bold"><strong>Popup Menu</strong></span>
            then hit next.</p></li><li><p>In the <span class="bold"><strong>New Wizard Option</strong></span> : </p><div class="itemizedlist"><ul type="disc"><li><p> set the Java package name to <span class="bold"><strong>org.kermeta.kmlogo.logoasm.ui.tools.wizards</strong></span>;</p></li><li><p>set Wizard Category Name to <span class="bold"><strong>Kermeta
                  samples</strong></span>;</p></li><li><p>set WizardClass Name to <span class="bold"><strong>KmLogoExampleWizard</strong></span>;</p></li><li><p>set WizardPage Class Name to <span class="bold"><strong>KmLogoExampleWizardPage</strong></span>
                </p></li><li><p>set Wizard name to <span class="bold"><strong>KmLogo samples</strong></span>;</p></li><li><p>file extension to <span class="bold"><strong>.kmt</strong></span>.</p></li></ul></div><p>In the <span class="bold"><strong>Sample Popup Menu</strong></span></p><div class="itemizedlist"><ul type="disc"><li><p>set Submenu name to <span class="bold"><strong>Logo</strong></span>;</p></li><li><p>set Action Label to <span class="bold"><strong>Run Logo
                  Simulator</strong></span>;</p></li><li><p>set Java package name to <span class="bold"><strong>org.kermeta.kmlogo.logoasm.ui.popup.actions</strong></span>;</p></li><li><p>set Action Class to <span class="bold"><strong>RunLogo</strong></span>;</p></li></ul></div><p>If you are asked wether to open the plug-in perspective which you are not familiar
            with, you can choose "No".</p></li><li><p>Copy (and replace) the files from the folder :</p><div class="itemizedlist"><ul type="disc"><li><p><span class="bold"><strong>CompileNXCLogoK.java</strong></span>,<span class="bold"><strong>
                    ExecHelper.java</strong></span>, <span class="bold"><strong>RunLogoK.java</strong></span>,<span class="bold"><strong> ConvertToAsmlogoK</strong></span>,
                    <span class="bold"><strong>Activator.java</strong></span> from the folder <span class="bold"><strong>org.kermeta.kmlogo.logoasm.tutorial/parts/5.ui/uiSetting/ui</strong></span> into the
                    package<span class="bold"><strong> org.kermeta.kmlogo.logoasm.ui</strong></span>;</p></li><li><p><span class="bold"><strong>CompileLogoNXC.java</strong></span>, <span class="bold"><strong>UploadRXE.java</strong></span>, <span class="bold"><strong>RunLogo.java</strong></span>,
                    <span class="bold"><strong>ConvertToAsmlogo</strong></span>, from the folder <span class="bold"><strong>org.kermeta.kmlogo.logoasm.tutorial/parts/5.ui/uiSetting/popup</strong></span> into
                  the package <span class="bold"><strong>org.kermeta.kmlogo.logoasm.ui.popup.actions</strong></span>;</p></li><li><p><span class="bold"><strong>KmLogoExampleWizard.java</strong></span> into the package
                    <span class="bold"><strong>org.kermeta.kmlogo.logoasm.ui.tools.wizard</strong></span>.</p></li></ul></div><p>Inside the package <span class="bold"><strong>org.kermeta.kmlogo.logoasm.ui.tools.wizard</strong></span>, delete the file <span class="bold"><strong>KmLogoExampleWizardPage.java</strong></span> since we do not use it.</p><p>It is normal that you got errors at this time just because there are needed
            librairies that we shoul define in next step.</p><p>
            </p><div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Caution"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Caution]" src="gfx/admonitions/caution.gif"></td><th align="left">Caution</th></tr><tr><td align="left" valign="top"><p><span class="bold"><strong>RunLogo.java</strong></span> is the code to call the Logo
                interpreter (the operational behavior we've defined for it). Open it and look at how
                is manipulated the kmt file;</p><p><span class="bold"><strong>RunLogoK.java</strong></span> is code calls Kermeta interpreter
                with a given kermeta program and parameters. In addition to initializing the
                interpreter, this code also sets the correct java classpath. Otherwise, Kermeta
                interpreter will not correctly find the java code called via the "extern". </p></td></tr></table></div><p>
          </p></li><li><p>Set up the missing librairies : Copy the folder <span class="bold"><strong>org.kermeta.kmlogo.logoasm.tutorial/parts/5.ui/uiSetting/lib</strong></span> and paste it
            into your root project.</p><p>Unfold this folder, add <span class="bold"><strong>bluecove.jar</strong></span>, <span class="bold"><strong>icommand.jar</strong></span>, <span class="bold"><strong>RXTXcomm.jar</strong></span> to
            the Java build path (right-click) and move to the next step.</p></li><li><p>Copy the file <span class="bold"><strong>org.kermeta.kmlogo.logoasm.tutorial/parts/5.ui/uiSetting/plugin/plugin.xml</strong></span>
            and overwrite the one in the created project. </p><p>Open the file and have a look to the popupMenus extension. They declares the actions
            for the end user.</p></li><li><p>Copy the folder <span class="bold"><strong>org.kermeta.kmlogo.logoasm.tutorial/parts/5.ui/uiSetting/icons</strong></span> to the root
            of the project <span class="bold"><strong>org.kermeta.kmlogo.logoasm.ui</strong></span> so as to
            set up the correct icons for the ui.</p><p>Copy (and replace) the folder <span class="bold"><strong>org.kermeta.kmlogo.logoasm.tutorial/parts/5.ui/uiSetting/editor/icons</strong></span> to
            the root of the project <span class="bold"><strong>org.kermeta.kmlogo.logoasm.editor</strong></span> so as to set up the correct icons for
            the ui.</p></li><li><p>Copy and replace the file <span class="bold"><strong>META-INF/MANIFEST.MF</strong></span> by
            the one from <span class="bold"><strong>org.kermeta.kmlogo.logoasm.tutorial/parts/5.ui/uiSetting/plugin</strong></span>.</p><p>Open the file and have a look at the dependecies and the export package of the
            project.</p><p>To be sure that the editor'configuration has not been overwritten, right-click on
              <span class="bold"><strong>org.kermeta.kmlogo.logoasm.emftexteditor/concrete_syntax/ASMLogo.cs </strong></span> and
            choose to <span class="bold"><strong>Generate Text Ressource</strong></span> again.</p></li></ol></div><p>Now that everything is correctly configured, let's jump into the last step of this
        tutorial which is the deployement the Logo demo.</p></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a name="chapter_using_deployed_DSL.link"></a>Chapter&nbsp;10.&nbsp;Using the deployed DSL
      environment<span></span></h2></div></div></div><p>It is time for testing the whole now! This last step describe the way you use your DSL
      within an eclipse workbench.</p><div class="procedure"><ol type="1"><li><p>Start a new eclipse worbench <span class="bold"><strong>Run &gt; Run Configuration &gt; new
            Eclipse application</strong></span></p></li><li><p>Create a simple project and name it <span class="bold"><strong>example</strong></span></p></li><li><p>Go to <span class="bold"><strong>File &gt; New &gt; EMFText &gt; EMFText .logo file</strong></span> and
          create a file <span class="bold"><strong> carre.logo</strong></span> in this newly created
          project.</p></li><li><p>Type in the example code below to tell the turtle to draw a square. If you get some
          errors, hit <span class="bold"><strong>CtrlSpace</strong></span> and enjoy the built-in context
          assistant to help you resolving.</p><div class="figure"><a name="d0e1568"></a><div class="figure-contents"><div class="mediaobject"><img src="Kermeta-Tutorial-Logo_figures/KermetaLogoCarre.png" alt="Logo : Code example"></div></div><p class="title"><b>Figure&nbsp;10.1.&nbsp;Logo : Code example</b></p></div><br class="figure-break"><p>Save your program and right-click on it and choose <span class="bold"><strong>Logo &gt; Logo
            to logoasm</strong></span> in our created pop-up menu. Look at your project directory a new
          file <span class="bold"><strong>carre.logoasm</strong></span> was created.</p></li><li><p>Rihgt-click on the file carre.logoasm and select <span class="bold"><strong>Logo &gt; Run Logo
            Simulator</strong></span>.</p><p>You should see our graphical representation of a turtle drawing a square like in
          section 7.4.2.</p><p>Now, on the file carre.logoasm, you can use the same Logo menu to generate NXC
          compiler by choosing <span class="bold"><strong>Generate NXC Code</strong></span> (If you want an
          xmi version you can File &gt; Save your file in <span class="bold"><strong>.xmi</strong></span>
          type)</p><p>Now you should have a ".nxc" file which is a C-like language containing the
          instructions. You convert it to a binary file ".rxe" one by choosing <span class="bold"><strong>Logo &gt; Compile to NXT Binary</strong></span> when right-clicking on ".nxc" file.</p><p>Finally you got a ".rxe" that you can upload by bluetooth to your Logo turtle device
          by the same menu <span class="bold"><strong>Logo &gt; Upload RXE</strong></span>.</p><p>
          </p><div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Caution"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Caution]" src="gfx/admonitions/caution.gif"></td><th align="left">Caution</th></tr><tr><td align="left" valign="top"><p>You need to set up a corresponding environment (which is not covered by this
              tutorial) if you want to implement the compiler.</p></td></tr></table></div><p>
        </p></li></ol></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a name="chapter_conclusion.link"></a>Chapter&nbsp;11.&nbsp;Conclusion<span></span></h2></div></div></div><p>This is the end of this tutorial. Now you should be able to implement your own DSL
      language using Kermeta. Through this example, we provided a Model Delevelopment Kit (MDK) in
      order to you being able to build your own one from <span class="bold"><strong>"just" an .ecore file
        and Kermeta</strong></span>. Like the FSM tutorial, this was a concrete example, the process is
      described in the process tutorial. Information on Kermeta language is available inside the
      manual.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="gfx/admonitions/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>You may launch <span class="bold"><strong>File -&gt; New -&gt; Example... -&gt; Kermeta Samples -&gt;
          Kermeta 2 Logo Demo (soluce)</strong></span> if you want to compare your results with the
        soluce or if you want to shortcut to the final results directly.</p></td></tr></table></div></div></div></body></html>