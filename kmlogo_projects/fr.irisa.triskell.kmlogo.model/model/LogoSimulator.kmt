/* $Id: LogoSimulator.kmt,v 1.1 2007-09-14 08:18:28 ffleurey Exp $
 * Creation date: May 30, 2007
 * License:
 * Copyright:
 * Authors:
 */
@mainClass "kmLogo::Interpreter"
@mainOperation "main"


package kmLogo;

require kermeta
require "LogoDynSemantics.kmt"
require "TurtleControler.kmt"

using kermeta::standard
using kermeta::utils
using kermeta::persistence
using kermeta::io
using kmLogo::controler


class Interpreter 
{
	attribute context : Context
	reference root : ASM::Instruction
	
	operation execute(uri : String) is
	do
		// create a new context
		context := Context.new
		context.reset
		
		// load the program
		root := loadProgram(uri)
		
		// create and initialize the GUI
		var controler : TurtleControler init TurtleControler.new
		controler.initialize(context.turtle)
		
		// run the program
		root.eval(context)

		// update the GUI
		controler.modelChanged
	end
	
	operation loadProgram(uri : String) : ASM::Instruction is do
		var res : EMFRepository init EMFRepository.new
        var resource : Resource init res.createResource(uri, "http://kmLogo.ecore/ASM")
        resource.load()
        result ?= resource.instances.one  
	end
	
	operation main() is
	do
		execute("tests/test2.xmi")
	end
}

