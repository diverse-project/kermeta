<project name="MetaCore" default="build_kermeta_model" basedir=".">
	
	<description>
        Build file for MetaCore
    </description>

	<!-- CLASSPATH AND LIBRARY : Change that to fit your config -->
	<!--<property name="eclipse_dir" location="/home/apps/eclipse3"/>-->
	<property name="eclipse_dir" location="/data/apps/eclipse"/>
	
	<property name="libdir" location="./lib"/>
	
	<path id="full.classpath">
			<pathelement location="${eclipse_dir}/plugins/org.eclipse.emf.common_2.0.1/runtime/common.jar"/>
		    <pathelement location="${eclipse_dir}/plugins/org.eclipse.emf.ecore_2.0.1/runtime/ecore.jar"/>
		    <pathelement location="${eclipse_dir}/plugins/org.eclipse.emf.ecore.xmi_2.0.1/runtime/ecore.xmi.jar"/>
			<pathelement location="../EcoreMerge/runtime/"/>
		    <pathelement path="${classpath}"/>
			<pathelement path="./build/class/"/>
			<fileset dir="${libdir}" includes="**/*.jar"/>
	</path>
	
		<!-- SOURCE DIR -->
		<property name="src.dir" location="./src/ecore"/>	
		
		<!-- BUILD DIR -->
		<property name="build.dir" location="./build/ecore"/>		
	
		<!-- DIST DIR -->
		<property name="dist.dir" location="./dist"/>		
	
	
	<!-- BUILD kermeta MODEL -->
	<target name="build_kermeta_model">
		<echo> Merging  base models</echo>
		<java classname="fr.irisa.triskell.kermeta.dev.model.PackageMerge" fork="yes" classpathref="full.classpath">
			<arg line="${build.dir}/kermeta.ecore ${src.dir}/behavior ${src.dir}/structure"/>
		</java>

		<echo> Updating package NSUri and NS prefix...</echo>
		<java classname="fr.irisa.triskell.kermeta.dev.model.FixPackageNSUri" fork="yes" classpathref="full.classpath">
			<arg line="${build.dir}/kermeta.ecore"/>
		</java>
		
		
		<copy tofile="${build.dir}/kermeta_java.ecore" file="${build.dir}/kermeta.ecore"/>
		
		
		
		<java classname="fr.irisa.triskell.kermeta.dev.model.KermetaPrimitiveTypes" fork="yes" classpathref="full.classpath">
						<arg line="${build.dir}/kermeta.ecore"/>
				</java> 
		<copy tofile="${dist.dir}/kermeta.ecore" file="${build.dir}/kermeta.ecore"/>
		
		<echo> Updating element names for eclipse plugin... </echo>
		<java classname="fr.irisa.triskell.kermeta.dev.model.CustomizeName" fork="yes" classpathref="full.classpath">
				<arg line="${build.dir}/kermeta_java.ecore"/>
		</java> 
		
		<echo> Generating visitor... </echo>
		<mkdir dir="src/java/fr/irisa/triskell/kermeta/visitor"/>
		<java classname="fr.irisa.triskell.kermeta.dev.model.CreateGenericVisitor" fork="yes" classpathref="full.classpath">
			<arg line="${build.dir}/kermeta_java.ecore fr.irisa.triskell.kermeta.visitor ./src/java/fr/irisa/triskell/kermeta/visitor Kermeta"/>
		</java> 

		<echo> Done. </echo>
	</target>
	
	<target name="build_ecore_visitor">
	<echo> Generating visitor... </echo>
			<mkdir dir="src/java/fr/irisa/triskell/ecore/visitor"/>
			<java classname="fr.irisa.triskell.kermeta.dev.model.CreateGenericVisitor" fork="yes" classpathref="full.classpath">
				<arg line="${src.dir}/Ecore.ecore fr.irisa.triskell.ecore.visitor ./src/java/fr/irisa/triskell/ecore/visitor Ecore"/>
			</java> 
	</target>
	
	
</project>