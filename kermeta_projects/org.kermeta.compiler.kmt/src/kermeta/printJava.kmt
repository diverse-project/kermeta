/* $Id: printJava.kmt,v 1.7 2008-07-16 07:06:28 cfaucher Exp $
 * Creation date: January 24, 2008
 * License: EPL
 * Copyright: IRISA / INRIA / Universite Rennes 1
 * Authors: Cyril Faucher <cfaucher@irisa.fr>
 */

package kermeta::language;

require kermeta
require "http://www.eclipse.org/emf/2002/Ecore"
require "platform:/resource/org.kermeta.compiler.kmt/src/kermeta/pass1/Pass1.kmt"
require "platform:/resource/org.kermeta.compiler.kmt/src/kermeta/pass2/Pass2.kmt"
require "platform:/resource/org.kermeta.compiler.kmt/src/kermeta/pass2/CreateBehavior.kmt"
require "platform:/resource/org.kermeta.compiler.kmt/src/kermeta/common/ContainmentTraversable.kmt"
require "platform:/resource/org.kermeta.compiler.kmt/src/kermeta/common/TraceStructure.kmt"
require "platform:/resource/org.kermeta.compiler.kmt/src/kermeta/helper/KM2EcoreHelper.kmt"
require "platform:/resource/org.kermeta.compiler.kmt/src/kermeta/KM2EcoreContext.kmt"

using kermeta::language::structure
using kermeta::language::behavior
using kermeta::utils
using ecore
using km2ecore
using km2ecore::helper::ecore

package structure {

	aspect class Object {
		operation print(context : KM2EcoreContext) : Void is do
			stdio.writeln("")
		end
	}
	
	aspect class Package {
		method print(context : KM2EcoreContext) : Void is do
			stdio.writeln("package " + self.name + ";\n")
			// Compile the owned elements
			self.eachOwnedElement{ cd | cd.print(context) }
		end
	}
	
	aspect class TypeDefinition {
		method print(context : KM2EcoreContext) : Void is do
			stdio.writeln("")
		end
	}
	
	aspect class ClassDefinition {
		method print(context : KM2EcoreContext) : Void from TypeDefinition is do
			stdio.writeln("class " + self.name + " {")
			// Set the traceability
			//self.ecoreModelElement := EcoreModelElementHelper.new.findEClassProxy(self)
			// Compile the owned elements
			self.eachOwnedElement{ o | o.print(context) }
			stdio.writeln("}\n---------------------------------------\n")
		end
		
	}
	
	aspect class Type {
		method print(context : KM2EcoreContext) : Void is do
			stdio.writeln("")
		end
	}
	
	aspect class PrimitiveType {
		method print(context : KM2EcoreContext) : Void from TypeDefinition is do
			stdio.writeln("\tprimitiveType " + self.name + "\n")
			//stdio.writeln("F2-2: " + self.name)
		end
	}
	
	aspect class MultiplicityElement {
		method print(context : KM2EcoreContext) :Void is do
			stdio.writeln("")
		end
	}
	
	aspect class Property {
		method print(context : KM2EcoreContext) : Void from MultiplicityElement is do
			stdio.writeln("")
		end
	}
	
	aspect class Operation {
		method print(context : KM2EcoreContext) : Void from MultiplicityElement is do
			stdio.writeln("\toperation " + self.name)
			// Set the traceability
			
			var javaCode : StringBuffer init StringBuffer.new
			
			// The Java source code is provided by: self.body.print(context)
			javaCode.append( self.createBehaviorJava(context) )
			
			// Finally print the EAnnotation containing the Java code in the Ecore model
	        stdio.writeln(javaCode.toString)
		end
	}

}

package behavior {
}