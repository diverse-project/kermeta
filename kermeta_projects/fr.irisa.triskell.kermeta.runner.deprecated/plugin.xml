<?xml version="1.0" encoding="UTF-8"?>
<?eclipse version="3.0"?>
<plugin>

     <extension
      
            id="KermetaPerspectives"
            name="kermetaPerspectives"
            point="org.eclipse.ui.perspectives">
         <perspective
               class="fr.irisa.triskell.kermeta.runner.perspective.KermetaPerspective"
               icon="icons/kermeta_logo.gif"
               name="Kermeta Metamodeling"
               id="kermetaPerspective"/>
      </extension>
      <extension
            point="org.eclipse.ui.perspectiveExtensions">
         <perspectiveExtension targetID="kermetaPerspective">
            <newWizardShortcut id="fr.irisa.triskell.kermeta.runner.wizards.kermetaNewFileWizard"/>
            <actionSet id="org.eclipse.debug.ui.launchActionSet"/>
    <!--        <actionSet id="kermetaActionSet"/> -->
        <showInPart
               id="org.eclipse.ui.views.ResourceNavigator">
         </showInPart>
         <showInPart
               id="org.eclipse.jdt.ui.PackageExplorer">
         </showInPart>
         <perspectiveShortcut id="org.eclipse.ui.resourcePerspective"/>
         <viewShortcut id="org.eclipse.ui.views.properties.PropertySheet"/>
         <viewShortcut id="org.eclipse.ui.views.ProblemView"/>
         <perspectiveShortcut id="org.eclipse.jdt.ui.JavaPerspective"/>
         </perspectiveExtension>
         <perspectiveExtension targetID="org.eclipse.ui.resourcePerspective">
            <newWizardShortcut id="fr.irisa.triskell.kermeta.runner.wizards.kermetaNewFileWizard"/>
            <viewShortcut id="org.eclipse.jdt.ui.TypeHierarchy"/>
            <perspectiveShortcut id="org.eclipse.debug.ui.DebugPerspective"/>
            <actionSet id="org.eclipse.jdt.ui.JavaActionSet"/>
            <perspectiveShortcut id="kermetaPerspective"/>
         </perspectiveExtension>
      </extension>

   <extension point="org.eclipse.ui.popupMenus">
    <objectContribution
            objectClass="org.eclipse.core.resources.IFile"
            nameFilter="*.kmt"
            id="popIFile">
   <!--      <menu
               label="KermetaMenu"
               path="additions"
               id="fr.irisa.triskell.kermeta.runner.menu1">
            <separator
                  >
            </separator>
         </menu> -->

      </objectContribution>
      <objectContribution
            objectClass="org.eclipse.core.resources.IProject"
            id="popIProject"/>
      <objectContribution
            adaptable="false"
            id="fr.irisa.triskell.kermeta.runner.objectContribution1"
            objectClass="org.eclipse.debug.core.model.IDebugElement">
         <menu
               id="fr.irisa.triskell.kermeta.runner.menu1"
               label="Debug mode"
               path="additions">
            <separator name="fr.irisa.triskell.kermeta.runner.separator1"/>
         </menu>
      </objectContribution>

   </extension>

   <!-- Extension point for the Kermeta Run menu item in the Run properties -->
   <extension point="org.eclipse.debug.core.launchConfigurationTypes">
    <launchConfigurationType
          sourceLocatorId="kermetaSourceLocator"
          delegate="fr.irisa.triskell.kermeta.runner.launching.KermetaLaunchConfiguration"
          public="true"
          name="Kermeta Application"
          modes="run, debug"
          id="KermetaLaunchConfiguration">
    </launchConfigurationType>
    <launchConfigurationType
          delegate="fr.irisa.triskell.kermeta.runner.launching.ConstraintLaunchConfiguration"
          id="ConstraintLaunchConfiguration"
          modes="run, debug"
          name="Kermeta Constraint Application"
          public="true"
          sourceLocatorId="kermetaSourceLocator"/>
   </extension>

	<!-- Tab groups for the launch configuration manager -->
      <extension
         point="org.eclipse.debug.ui.launchConfigurationTabGroups">
      <launchConfigurationTabGroup
            type="KermetaLaunchConfiguration"
            class="fr.irisa.triskell.kermeta.runner.launching.KermetaLaunchConfigTabGroup"
            description="Define the launch arguments for the selected KMT file"
            id="KermetaTabGroup">
         <launchMode
               description="description du launch mode"
               mode="run"/>
         <launchMode
               description="Debug configuration"
               mode="debug"
               perspective="org.eclipse.debug.ui.DebugPerspective"/>
      </launchConfigurationTabGroup>
      <launchConfigurationTabGroup
            class="fr.irisa.triskell.kermeta.runner.launching.KermetaLaunchConfigTabGroup"
            description="kermeta interpreter with constraints"
            id="ConstraintTabGroup"
            type="ConstraintLaunchConfiguration">
         <launchMode
               description="run mode with constraint interpretation"
               mode="run"/>
         <launchMode
               description="Debug configuration"
               mode="debug"
               perspective="org.eclipse.debug.ui.DebugPerspective"/>
      </launchConfigurationTabGroup> 
   </extension> 
 
   <!-- Perspective -->
      <extension
            point="org.eclipse.debug.ui.launchConfigurationTypeImages">
         <launchConfigurationTypeImage
               icon="icons/kermeta_logo.gif"
               configTypeID="KermetaLaunchConfiguration"
               id="fr.irisa.triskell.kermeta.runner.launchConfigurationTypeImage1"/>
         <launchConfigurationTypeImage
               configTypeID="ConstraintLaunchConfiguration"
               icon="icons/kermeta_logo.gif"
               id="fr.irisa.triskell.kermeta.runner.launchConfigurationTypeImage2"/>
      </extension>
      <extension
            point="org.eclipse.debug.ui.launchGroups">
         <launchGroup
               bannerImage="icons/kermeta_logo.gif"
               label="Kermeta Run"
               category="KermetaWizard"
               mode="run"
               image="icons/kermeta_logo.gif"
               id="KermetaLaunchGroup"/>
  <!--       <launchGroup
               bannerImage="icons/full/wizban/run_wiz.gif"
               label="Run"
               mode="run"
               image="icons/full/ctool16/run_exc.gif"
               id="org.eclipse.debug.ui.launchGroup.run"/>
      -->         
      </extension>
     <extension
            point="org.eclipse.debug.ui.launchShortcuts">
         <shortcut
               label="Kermeta App"
               class="fr.irisa.triskell.kermeta.runner.launching.KermetaLaunchShortcut"
               icon="icons/kermeta_logo.gif"
               id="fr.irisa.triskell.kermeta.runner.kermetashortcut"
               modes="run">
            <contextualLaunch>
               <contextLabel
                     label="Kermeta App"
                     mode="run"/>
			   <enablement>
	              <with
	                    variable="selection">
                  <count
                        value="1">
                  </count>
               		<iterate operator="or">
                 		<or>
                   			<test property="org.eclipse.debug.ui.matchesPattern" value="*.kmt"/>
                   			<test property="org.eclipse.debug.ui.matchesPattern" value="*.km"/>
                 		</or>
               		</iterate>
               </with>
            </enablement>
            </contextualLaunch>
         </shortcut> 
         <shortcut
               label="Kermeta Constraint"
               class="fr.irisa.triskell.kermeta.runner.launching.ConstraintLaunchShortcut"
               icon="icons/kermeta_logo.gif"
               id="fr.irisa.triskell.kermeta.runner.constraintshortcut"
               modes="run">
            <contextualLaunch>
               <contextLabel
                     label="Kermeta App with constraints"
                     mode="run"/>
			   <enablement>
	              <with
	                    variable="selection">
                  <count
                        value="1">
                  </count>
               		<iterate operator="or">
                 		<or>
                   			<test property="org.eclipse.debug.ui.matchesPattern" value="*.kmt"/>
                   			<test property="org.eclipse.debug.ui.matchesPattern" value="*.km"/>
                 		</or>
               		</iterate>
               </with>
            </enablement>
            </contextualLaunch>
         </shortcut>
         <shortcut
               class="fr.irisa.triskell.kermeta.runner.launching.KermetaLaunchShortcut"
               icon="icons/kermeta_logo.gif"
               id="fr.irisa.triskell.kermeta.runner.debugkermetashortcut"
               label="Debug Kermeta App"
               modes="debug">
            <contextualLaunch>
               <contextLabel
                     label="Debug Kermeta App"
                     mode="debug"/>
               <enablement>
                  <count value="1"/>
                  <iterate operator="or">
                     <test
                           property="org.eclipse.debug.ui.matchesPattern"
                           value="*.kmt"/>
                     <test
                           property="org.eclipse.debug.ui.matchesPattern"
                           value="*.km"/>
                  </iterate>
               </enablement>
            </contextualLaunch>
         </shortcut>
      </extension>
      <extension
            point="org.eclipse.ui.newWizards">
         <wizard
               icon="icons/newkermetafile.png"
               class="fr.irisa.triskell.kermeta.runner.wizards.KermetaNewFileWizard"
               finalPerspective="kermetaPerspective"
               category="fr.irisa.triskell.kermeta.KermetaWizard"
               descriptionImage="icons/kermeta.png"
               project="true"
               preferredPerspectives="org.eclipse.ui.resourcePerspective"
               name="New Kermeta file"
               id="fr.irisa.triskell.kermeta.runner.wizards.kermetaNewFileWizard"/>
      </extension>
      <extension
            point="org.eclipse.debug.core.sourceLocators">
         <sourceLocator
               class="fr.irisa.triskell.kermeta.runner.launching.KermetaSourceLocator"
               name="fr.irisa.triskell.kermeta.runner.kermetaSourceLocator"
               id="kermetaSourceLocator"/>
      </extension>
      <!-- Kermeta launch short cut -->
     <extension
           point="org.eclipse.ui.importWizards">
     </extension>
     <!-- When Kermeta Project will be really "functionally" interesting, we will
          create a specific KermetaProject class -->
     <extension
           point="org.eclipse.debug.core.watchExpressionDelegates">
        <watchExpressionDelegate
              debugModel="fr.irisa.triskell.kermeta.runner.debug"
              delegateClass="fr.irisa.triskell.kermeta.runner.debug.model.KermetaWatchExpressionDelegate"/>
     </extension>
     <extension
           point="org.eclipse.debug.ui.debugModelPresentations">
        <debugModelPresentation
              class="fr.irisa.triskell.kermeta.runner.debug.model.KermetaDebugModelPresentation"
              id="fr.irisa.triskell.kermeta.runner.debug"/>
     </extension>
 <!--    <extension
           point="org.eclipse.debug.core.breakpoints">
        <breakpoint
              class="fr.irisa.triskell.kermeta.runner.debug.model.KermetaBreakpoint"
              id="kermetaBreakpoint"
              markerType="kermetaBreakpointMarker"
              name="kermeta breakpoint"/>
     </extension>
     <extension
           id="kermetaBreakpointMarker"
           name="kermetaBreakpointMarker"
           point="org.eclipse.core.resources.markers">
        <super type="org.eclipse.debug.core.lineBreakpointMarker"/> -->
<!--        <super type="org.eclipse.debug.core.breakpointMarker"/> -->
<!--        <persistent value="false"/>
     </extension>
     <extension
      point="org.eclipse.ui.ide.markerImageProviders">
   <imageprovider
         icon="./icons/breakpoint.png"
         id="kermetaBreakpointImage"
         markertype="kermetaBreakpointMarker"/>
</extension>
     -->
     <extension 
	point="org.eclipse.core.resources.markers"
	id="kermetaBreakpointMarker">
	<super type="org.eclipse.debug.core.lineBreakpointMarker"/>
	<persistent value="true"/>
</extension>
<extension 
	point="org.eclipse.debug.core.breakpoints">
	<breakpoint id="kermetaBreakpoint"
		markerType="fr.irisa.triskell.kermeta.runner.kermetaBreakpointMarker"
		class="fr.irisa.triskell.kermeta.runner.debug.model.KermetaBreakpoint"/>
</extension>

<extension
	point="org.eclipse.ui.ide.markerImageProviders">
	<imageprovider id="kermetaBreakPointImage"
		markertype="fr.irisa.triskell.kermeta.runner.kermetaBreakpointMarker"
		icon="icons/breakpoint.gif"/>
</extension>
     

     <extension
           id="fr.irisa.triskell.kermeta.runner.EditorActions"
           point="org.eclipse.ui.editorActions">
        <editorContribution
              id="fr.irisa.triskell.kermeta.runner.breakpointAction"
              targetID="org.eclipse.ui.editors.text.texteditor">
           <action
                 actionID="RulerDoubleClick"
                 class="fr.irisa.triskell.kermeta.runner.actions.KermetaBreakpointActionDelegate"
                 icon="icons/breakpoint.png"
                 id="fr.irisa.triskell.kermeta.runner.breakpointAction"
                 label="Add a breakpoint"
                 state="true"
                 style="push"
                 tooltip="Kermeta breakpoint"/>
        </editorContribution>
     </extension>
     <!-- This extension does not look useful for launchability -->
<!--     <extension
           point="org.eclipse.core.runtime.adapters">
        <factory
        	  class=""
              adaptableType="org.eclipse.core.resources.IFile">
           <adapter type="org.eclipse.debug.ui.actions.ILaunchable"/>
        </factory> 
     </extension> 
   -->
   
   <!-- popup menu, when right-clicking on the TextEditor ruler -->
   <!-- popup menu -->
<extension point="org.eclipse.ui.popupMenus">
	<viewerContribution 
    	id="fr.irisa.triskell.kermeta.runner.KermetaEditPopupActions" 
    	targetID="#TextRulerContext">
		<action
        class="fr.irisa.triskell.kermeta.runner.actions.KermetaBreakpointActionDelegate"
        icon="icons/kermeta_logo.gif"
        id="org.eclipse.jdt.ui.actions.ManageBreakpointRulerActionDelegate"
        label="Add Breakpoint"
        menubarPath="debug"
        style="push">
		</action>
	</viewerContribution>
	
</extension>
<extension
      point="org.eclipse.debug.ui.stringVariablePresentations">
   <variablePresentation
         argumentSelector="fr.irisa.triskell.kermeta.runner.debug.model.KermetaVariable"
         variableName="fr.irisa.triskell.kermeta.runner.debug.model.KermetaVariable"/>
</extension>

<extension
      point="org.eclipse.core.variables.valueVariables">
   <variable
         initializerClass="fr.irisa.triskell.kermeta.runner.debug.model.KermetaVariable"
         name="fr.irisa.triskell.kermeta.runner.variable2"/>
</extension>
<extension
      point="org.eclipse.ui.console.consolePageParticipants">
   <consolePageParticipant
         class="fr.irisa.triskell.kermeta.runner.console.ConsolePageParticipant"
         id="fr.irisa.triskell.kermeta.runner.consolePageParticipant">
      <enablement>
  	    <instanceof value="fr.irisa.triskell.kermeta.runner.console.InternalIOConsole"/>
  	  </enablement>
   </consolePageParticipant>
</extension>

   
   
     

</plugin>
