<!-- $Id: test_build.xml,v 1.5 2005-12-09 16:18:39 dvojtise Exp $ -->
<project name="run interpreter tests" default="all" basedir=".">
	
	<description>
        Run interpreter tests
    </description>
	
        <property name="report.dir" location="./reports"/>
	<property name="eclipse.home" location="c:/eclipse3.1/eclipse"/>

	<property name="build.bin" location="../../build/class"/>
	<property name="src" location="../../src/java"/>
	<property name="test.src" location="../../test/junit"/>
	
	
	<property name="kermeta.interpreter.class" location="..\..\build\class"/>
	<property name="kermeta.interpreter.jar" location="..\..\..\fr.irisa.triskell.kermeta\lib\interpreter_kermeta.jar"/>
	<property name="kermeta.model.jar" location="..\..\..\fr.irisa.triskell.kermeta\lib\model_kermeta.jar"/>
	<property name="kermeta.io.jar" location="..\..\..\fr.irisa.triskell.kermeta\lib\io_kermeta.jar"/>
	<property name="traceability.jar" location="..\..\..\fr.irisa.triskell.kermeta\lib\traceability.jar"/>
	
	<property name="log4j.jar" location="..\..\..\fr.irisa.triskell.kermeta\lib\thirdparty\log4j.jar"/>
	<property name="antlr.jar" location="..\..\..\fr.irisa.triskell.kermeta\lib\thirdparty\antlr.jar"/>
	<property name="ldt-core.jar" location="..\..\..\fr.irisa.triskell.kermeta\lib\thirdparty\ldt-core.jar"/>
	
    <property name="emf.common.jar" location="${eclipse.home}/plugins/org.eclipse.emf.common_2.1.0.jar"/>
    <property name="emf.ecore.jar" location="${eclipse.home}/plugins/org.eclipse.emf.ecore_2.1.0.jar"/>
    <property name="emf.ecore.xmi.jar" location="${eclipse.home}/plugins/org.eclipse.emf.ecore.xmi_2.1.0.jar"/>

	
	<path id="interpreter.class.path">
	    <pathelement location="${kermeta.model.jar}"/>
	    <pathelement location="${kermeta.io.jar}"/>
	    <pathelement location="${kermeta.model.jar}"/>
	    <pathelement location="${traceability.jar}"/>
	    <pathelement location="${emf.common.jar}"/>
	    <pathelement location="${emf.ecore.jar}"/>
	    <pathelement location="${emf.ecore.xmi.jar}"/>
	    <pathelement location="${log4j.jar}"/>
	    <pathelement location="${antlr.jar}"/>
	    <pathelement location="${ldt-core.jar}"/>
	    <pathelement path="${java.class.path}"/>
	</path>
	
	<target name="all"
		description="run all interpreter tests">
		<antcall target="run_interpreter_tests"/>
	</target>
	
	<target name="compile_java">
	    <mkdir dir="${build.bin}"/> 
		<javac srcdir="${src}:${test.src}" 
    	    destdir="${build.bin}"
   			debug="true">
   			<classpath >
   				<!--<pathelement path="${MTLcompiler.path}/bin"/>-->
   				<path refid="interpreter.class.path"/> 
   			</classpath>
   		</javac>
	</target>
	
	<target name="run_interpreter_tests" 
		description="run interpreter tests" depends="compile_java">
	    <mkdir dir="${report.dir}"/> 
	    <mkdir dir="${report.dir}/html"/>
		<junit printsummary="yes" haltonfailure="no">
		  <classpath>
		    	<pathelement location="${kermeta.interpreter.class}"/>
				<path refid="interpreter.class.path"/> 
		  </classpath>

		  <formatter type="plain"/>

		  <test name="kermeta_interpreter.test.JunitTestSuite" haltonfailure="no" todir="${report.dir}" outfile="TEST-interpreter-result">
		    <formatter type="xml"/>
		  </test>
		  
		</junit>
		<junitreport todir="${report.dir}">
		  <fileset dir="${report.dir}">
		    <include name="TEST-*.xml"/>
		  </fileset>
		  <report format="frames" todir="${report.dir}/html"/>
		</junitreport>
	</target>
</project>
