/* $Id: Ecore2KermetaQuickFixWizardPage.java,v 1.6 2007-07-20 15:09:18 ftanguy Exp $
 * Project: Kermeta (First iteration)
 * File: KermetaNewFileWizardPage.java
 * License: EPL
 * Copyright: IRISA / INRIA / Universite de Rennes 1
 * ----------------------------------------------------------------------------
 * Creation date: May 19, 2005
 * Authors: 
 * 			zdrey
 * 			dvojtise
 * Notes :
 * 	This file was primarily generated by Eclipse plug-in helper
 */

package fr.irisa.triskell.kermeta.tools.wizards;

import org.eclipse.jface.viewers.IStructuredSelection;
import org.eclipse.jface.wizard.WizardPage;
import org.eclipse.swt.SWT;
import org.eclipse.swt.events.ModifyEvent;
import org.eclipse.swt.events.ModifyListener;
import org.eclipse.swt.events.SelectionEvent;
import org.eclipse.swt.events.SelectionListener;
import org.eclipse.swt.graphics.Font;
import org.eclipse.swt.layout.GridData;
import org.eclipse.swt.layout.GridLayout;
import org.eclipse.swt.widgets.Button;
import org.eclipse.swt.widgets.Composite;
import org.eclipse.swt.widgets.Event;
import org.eclipse.swt.widgets.Group;
import org.eclipse.swt.widgets.Label;
import org.eclipse.swt.widgets.Listener;
import org.eclipse.swt.widgets.Text;

import fr.irisa.triskell.kermeta.loader.ecore.ecore2km.Ecore2KM;

/**
 * The Quick fix page allows to enable or disable some simple 
 * quick fixes to be run while transforming Ecore to Kermeta files.
 */
public class Ecore2KermetaQuickFixWizardPage extends WizardPage implements Listener
{

    
    public static final int GRID_DATA_WIDTH = 150;
   
    private Text methodRenamePrefixText;
    private Text methodRenamePostfixText;
    private Group operationPropertyGroup;
    private Group operationGroup;
    private Button isEnableCheckBox;
    private Button isOpPropertyEnabledCheckBox;
    private Button isOperationEnabledCheckBox;
    private Composite container;
    
	

	
	/**
	 * Constructor for SampleNewWizardPage.
	 * @param pageName
	 */
	public Ecore2KermetaQuickFixWizardPage(IStructuredSelection selection) {
		super("wizardPage");
		setTitle("Ecore2Kermeta quick fixes");
		setDescription("Indicate here which fixes you want to apply while transforming your ecore into kermeta (this will not change the ecore file).");
		
	}
	
    /**
     * This is a copy of createControl of super class, extended in order to add
     * a specific group for default folders (src/lib)
     * @see org.eclipse.jface.dialogs.IDialogPage#createControl(org.eclipse.swt.widgets.Composite)
     */
    public void createControl(Composite parent)
    {

		container = new Composite(parent, SWT.NULL);
		GridLayout layout = new GridLayout();
		container.setLayout(layout);
		layout.numColumns = 1;
		
		Composite groupcontainer = new Composite(container, SWT.NULL);
		layout = new GridLayout(2, false);
		groupcontainer.setLayout(layout);
		layout.makeColumnsEqualWidth = false;
		layout.verticalSpacing = 9;		
		Label label = new Label(groupcontainer, SWT.NULL);
		label.setText("&Enable quick fixes ");
		isEnableCheckBox = new Button(groupcontainer, SWT.CHECK);
		
		createQuickFixOperationPropertyGroup(container);
		createQuickFixOperationGroup(container);
		
		initialize();
		dialogChanged();
		setControl(container);
    }
    
    /**
     * Create a window that propose to the user the specification of a 
     * root package, a main class, and a main method.
     */
    protected void createQuickFixOperationPropertyGroup(Composite parent)
    {
        Font font = parent.getFont();
        // Advanced group
        operationPropertyGroup = new Group(parent, SWT.NONE);
        GridLayout layout = new GridLayout(2,false);
        operationPropertyGroup.setLayout(layout);
        operationPropertyGroup.setLayoutData(new GridData(GridData.FILL_HORIZONTAL));
        operationPropertyGroup.setFont(font);
        operationPropertyGroup.setText("Fix Operation/Property name conflicts"); //$NON-NLS-1$
        // Create the pacakge, class, operation fields
		Label label = new Label(operationPropertyGroup, SWT.NULL);
		label.setText("Enable Operation/Property name conflicts quick fix ");
		isOpPropertyEnabledCheckBox = new Button(operationPropertyGroup, SWT.CHECK);
		isOpPropertyEnabledCheckBox.setSelection(true);
        createLabel(operationPropertyGroup, "Operation prefix ", true, font);
        methodRenamePrefixText = createText(operationPropertyGroup, true, font, Ecore2KM.methodRenamePrefix);
        createLabel(operationPropertyGroup, "Operation postfix ", true, font);
        methodRenamePostfixText = createText(operationPropertyGroup, true, font, Ecore2KM.methodRenamePostfix);
    }
    
    /**
     * Create a window that propose to the user the specification of a 
     * root package, a main class, and a main method.
     */
    protected void createQuickFixOperationGroup(Composite parent)
    {
        Font font = parent.getFont();
        // Advanced group
        operationGroup = new Group(parent, SWT.NONE);
        GridLayout layout = new GridLayout(2,false);
        operationGroup.setLayout(layout);
        operationGroup.setLayoutData(new GridData(GridData.FILL_HORIZONTAL));
        operationGroup.setFont(font);
        operationGroup.setText("Fix Operation conflicts"); //$NON-NLS-1$
        // Create the pacakge, class, operation fields

		Label label = new Label(operationGroup, SWT.NULL);
		label.setText("Enable Operation name conflicts quick fix ");
		isOperationEnabledCheckBox = new Button(operationGroup, SWT.CHECK);
		isOperationEnabledCheckBox.setSelection(true);
		
        /*createLabel(operationGroup, "Operation prefix (if conflict) ", true, font);
        methodRenamePrefixText = createText(operationGroup, true, font, ECore2Kermeta.methodRenamePrefix);
        createLabel(operationGroup, "Operation postfix (if conflict) ", true, font);
        methodRenamePostfixText = createText(operationGroup, true, font, ECore2Kermeta.methodRenamePostfix);
        */
    }
    
	/**
	 * initialize the different listener so they can activate the dialog change
	 * (is there a better way to do it ?)
	 */	
	private void initialize() {

		isEnableCheckBox.addSelectionListener(new SelectionListener() {			

			public void widgetSelected(SelectionEvent e) {
				dialogChanged();
				
			}

			public void widgetDefaultSelected(SelectionEvent e) {
				dialogChanged();
				
			}
		});
		
		methodRenamePrefixText.addModifyListener(new ModifyListener(){

			public void modifyText(ModifyEvent e) {
				dialogChanged();
			}});
	    methodRenamePostfixText.addModifyListener(new ModifyListener(){

			public void modifyText(ModifyEvent e) {
				dialogChanged();
			}});

	    isOpPropertyEnabledCheckBox.addSelectionListener(new SelectionListener() {
			
			public void widgetSelected(SelectionEvent e) {
				dialogChanged();
				
			}

			public void widgetDefaultSelected(SelectionEvent e) {
				dialogChanged();
				
			}
		});
	}
	

	
	/**
	 * Ensures that at least one of the prefix or postfix are set.
	 * deals with disabled components
	 */
	private void dialogChanged() {
		operationPropertyGroup.setEnabled(isQuickFixEnabled());
		operationGroup.setEnabled(isQuickFixEnabled());

	    methodRenamePrefixText.setEnabled(isQuickFixEnabled());
	    methodRenamePostfixText.setEnabled(isQuickFixEnabled());
	    isOpPropertyEnabledCheckBox.setEnabled(isQuickFixEnabled());
	    isOperationEnabledCheckBox.setEnabled(isQuickFixEnabled());
		
		if (isQuickFixEnabled() && 
				isOpPropertyFixEnabled() && 
				(getOpPostfixString().compareTo("") == 0) &&
				(getOpPrefixString().compareTo("") == 0))
			updateStatus("You must set either a prefix and/or a postfix");
		else
			updateStatus(null);
	}

	private void updateStatus(String message) {
		setErrorMessage(message);
		setPageComplete(message == null);
	}



	
	
	
  
    /**
     * Create the text field for the Root package.
     * Also sets a default value for this root package.
     * @param parent
     */
    protected Label createLabel(Group advancedGroup, String label, boolean enabled, Font font)
    {
        Label _label = new Label(advancedGroup, SWT.NONE);
		_label.setText(label); //$NON-NLS-1$
		_label.setEnabled(enabled);
		_label.setFont(font);
		return _label;
    }

    protected Text createText(Group advancedGroup, boolean enabled, Font font, String defaultValue)
    {
        Text _text = new Text(advancedGroup, SWT.BORDER);
        GridData data = new GridData(GridData.FILL_HORIZONTAL);
        data.widthHint = GRID_DATA_WIDTH;
        _text.setLayoutData(data);
        _text.setEnabled(enabled);
        _text.setFont(font);
        _text.setText(defaultValue);
        return _text;
    }
	
    
    public boolean isQuickFixEnabled() {
    	return this.isEnableCheckBox.getSelection();
    }
    public boolean isOpPropertyFixEnabled() {
    	return this.isOpPropertyEnabledCheckBox.getSelection();
    }

    public boolean isOperationFixEnabled() {
    	return this.isOperationEnabledCheckBox.getSelection();
    }
    public String getOpPrefixString() {
    	return this.methodRenamePrefixText.getText();
    }
    public String getOpPostfixString() {
    	return this.methodRenamePostfixText.getText();
    }
    
    
    
    public void handleEvent(Event e)
    {
        dialogChanged();
    }
    
    
}