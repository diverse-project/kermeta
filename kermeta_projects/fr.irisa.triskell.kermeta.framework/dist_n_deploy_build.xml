<!-- $Id: dist_n_deploy_build.xml,v 1.25 2007-09-13 09:04:38 ftanguy Exp $ -->
<project name="kermeta_framework" default="all" basedir=".">
	
	<description>
        Deploy the dist jar to the projects that use it
    </description>
	
	<property name="eclipse.home" location="/home/paco/Desktop/eclipse"/>

	<path id="project.class.path">
		
		<pathelement location="build/class"/>

	  	<pathelement location="../fr.irisa.triskell.eclipse.util/bin"/>
	  	<pathelement location="../fr.irisa.triskell.kermeta.io/build/class"/>
	  	<pathelement location="../fr.irisa.triskell.kermeta.model/build/class"/>
	  	<pathelement location="../fr.irisa.triskell.kermeta.interpreter/build/class"/>
  		<pathelement location="../fr.irisa.triskell.traceability.model/build/class"/>

	  	<pathelement location="lib/thirdparty/log4j.jar"/>
	  	<pathelement location="lib/thirdparty/antlr.jar"/>
	  	<pathelement location="lib/thirdparty/ldt-core.jar"/>
	  	<pathelement location="lib/thirdparty/emfatic-core.jar"/>
  		
		<fileset dir="${eclipse.home}/plugins">
		    <include name="**/org.eclipse.emf.common_*.jar"/>
			<include name="**/org.eclipse.emf.ecore_*.jar"/>
			<include name="**/org.eclipse.emf.ecore.xmi_*.jar"/>
			<include name="**/org.eclipse.emf.validation_*.jar"/>
			<include name="**/org.eclipse.equinox.common_*.jar"/>
			<include name="**/org.eclipse.equinox.registry_*.jar"/>
			<include name="**/org.eclipse.equinox.preferences_*.jar"/>
			<include name="**/org.eclipse.osgi_*.jar"/>
			<include name="**/org.eclipse.core.runtime_*.jar"/>
			<include name="**/org.eclipse.core.jobs_*.jar"/>
			<include name="**/org.eclipse.core.resources_*.jar"/>
			<include name="**/org.eclipse.ui.workbench_*.jar"/>
			<include name="**/org.eclipse.jface_*.jar"/>
			<include name="**/org.eclipse.swt.*.jar"/>
		</fileset>		
	</path>

	<target name="all"
		description="create and deploy the jar file and the km file">
		<antcall target="create_framework"/>
		<antcall target="deploy"/>	
	</target>
	<target name="deploy" 
		description="deploy the framework file">
		<delete>
			<fileset dir="../fr.irisa.triskell.kermeta.io/src/kermeta" includes="**/*.ecore"/>
			<fileset dir="../fr.irisa.triskell.kermeta.io/src/kermeta" includes="**/*.km"/>
		</delete>
		<copy todir="../fr.irisa.triskell.kermeta.io/src/kermeta">
		  <fileset dir="dist"
		  />
		</copy>
	</target>
	
	<target name="create_framework" 
			description="create the km file">
		<delete>
			<fileset dir="dist" includes="**/*.ecore"/>
			<fileset dir="dist" includes="**/*.km"/>
		</delete>
		<mkdir dir="dist"/>
		<java classname="fr.irisa.triskell.kermeta.dev.framework.CompileFramework">
			<classpath refid="project.class.path"/>
		</java>
	</target>

</project>