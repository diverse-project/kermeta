<!-- $Id$ -->
<project name="kermeta_framework" default="all" basedir=".">
	
	<description>
        Deploy the dist jar to the projects that use it
    </description>
	
	<property name="eclipse.home" location="${basedir}/../../"/>

	<path id="project.class.path">
		
		<pathelement location="build/class"/>

		<pathelement location="../fr.irisa.triskell.eclipse.util/bin"/>
	  	<pathelement location="../fr.irisa.triskell.kermeta.io/build/class"/>
		<pathelement location="../org.kermeta.io.loader/bin"/>
		<pathelement location="../fr.irisa.triskell.kermeta.model/build/class"/>
	  	<pathelement location="../fr.irisa.triskell.kermeta.interpreter/build/class"/>
  		<pathelement location="../fr.irisa.triskell.traceability.model/bin"/>
  		<pathelement location="../org.eclipse.gymnast.runtime.core/bin"/>
  		<pathelement location="../org.kermeta.log4j.util/bin"/>
  		<pathelement location="../org.kermeta.merger/bin"/>
  		<pathelement location="../org.antlr.antlr2/bin"/>

		<fileset dir="${eclipse.home}/plugins">
		    <include name="**/org.eclipse.emf.common_*.jar"/>
			<include name="**/org.eclipse.emf.ecore_*.jar"/>
			<include name="**/org.eclipse.emf.ecore.xmi_*.jar"/>
			<include name="**/org.eclipse.emf.validation_*.jar"/>
			<include name="**/org.eclipse.equinox.common_*.jar"/>
			<include name="**/org.eclipse.equinox.registry_*.jar"/>
			<include name="**/org.eclipse.equinox.preferences_*.jar"/>
			<include name="**/org.eclipse.osgi_*.jar"/>
			<include name="**/org.eclipse.core.runtime_*.jar"/>
			<include name="**/org.eclipse.core.jobs_*.jar"/>
			<include name="**/org.eclipse.core.resources_*.jar"/>
			<include name="**/org.eclipse.ui.workbench_*.jar"/>
			<include name="**/org.eclipse.jface_*.jar"/>
			<include name="**/org.eclipse.swt.*.jar"/>
			<include name="**/org.antlr_*.jar"/>
			<include name="**/org.antlr_*/antlr.jar"/>
			<include name="**/org.apache.log4j_*.jar"/>
			<include name="**/org.apache.commons.logging_*.jar"/>
		</fileset>		
	</path>

	<target name="all"
		description="create and deploy the jar file and the km file">
		<antcall target="create_framework"/>
		<antcall target="deploy"/>	
	</target>
	<target name="deploy" 
		description="deploy the framework file">
		<delete>
			<fileset dir="../fr.irisa.triskell.kermeta.io/src/kermeta" includes="**/*.ecore"/>
			<fileset dir="../fr.irisa.triskell.kermeta.io/src/kermeta" includes="**/*.km"/>
			<fileset dir="../fr.irisa.triskell.kermeta.io/src/kermeta" includes="**/*.traceability"/>
		</delete>
		<copy todir="../fr.irisa.triskell.kermeta.io/src/kermeta">
		  <fileset dir="dist"
		  />
		</copy>
	</target>
	
	<target name="create_framework" 
			description="create the km file">
		<delete>
			<fileset dir="dist" includes="**/*.ecore"/>
			<fileset dir="dist" includes="**/*.km"/>
			<fileset dir="dist" includes="**/*.traceability"/>
		</delete>
		<mkdir dir="dist"/>
		<java classname="fr.irisa.triskell.kermeta.dev.framework.CompileFramework">
			<classpath refid="project.class.path"/>
		</java>
	</target>

</project>