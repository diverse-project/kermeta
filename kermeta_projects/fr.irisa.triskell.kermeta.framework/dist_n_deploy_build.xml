<!-- $Id: dist_n_deploy_build.xml,v 1.20 2007-07-12 07:42:23 cfaucher Exp $ -->
<project name="kermeta_framework" default="all" basedir=".">
	
	<description>
        Deploy the dist jar to the projects that use it
    </description>
	
	<property name="eclipse_dir" location="C:/eclipse3.3_1"/>
	
	<property name="kermeta.framework.jar" location="dist/framework.jar"/>
	<property name="kermeta.framework.km" location="dist/framework.km"/>
  	<path id="project.class.path">
		<pathelement location="build/class"/>
	  	<pathelement location="../fr.irisa.triskell.kermeta.io/build/class"/>
	  	<pathelement location="../fr.irisa.triskell.kermeta.model/build/class"/>
	  	<pathelement location="../fr.irisa.triskell.traceability.model/build/class"/>
	  	<pathelement location="../fr.irisa.triskell.kermeta.interpreter/build/class"/>
	  	<pathelement location="lib/thirdparty/log4j.jar"/>
	  	<pathelement location="lib/thirdparty/antlr.jar"/>
	  	<pathelement location="lib/thirdparty/ldt-core.jar"/>
	  	<pathelement location="lib/thirdparty/emfatic-core.jar"/>
  		
  		<pathelement location="${eclipse_dir}/plugins/org.eclipse.emf.common_2.3.0.v200706262000.jar"/>
	    <pathelement location="${eclipse_dir}/plugins/org.eclipse.emf.ecore_2.3.0.v200706262000.jar"/>
	    <pathelement location="${eclipse_dir}/plugins/org.eclipse.emf.ecore.xmi_2.3.0.v200706262000.jar"/>
	    <pathelement location="${eclipse_dir}/plugins/org.eclipse.emf_2.3.0.v200706262000.jar"/>

	</path>

	<target name="all"
		description="create and deploy the jar file and the km file">
		<antcall target="create_jar"/>
		<antcall target="create_km"/>
		<antcall target="deploy"/>	
	</target>
	<target name="deploy" 
		description="deploy the jar file">
		<copy file="${kermeta.framework.km}" todir="../fr.irisa.triskell.kermeta/lib/"/>
		<copy file="${kermeta.framework.km}" todir="../fr.irisa.triskell.kermeta.texteditor/lib/"/>
		<!--copy file="${kermeta.framework.km}" todir="../fr.irisa.triskell.kermeta.io/lib/"/-->
		<copy file="${kermeta.framework.km}" todir="../fr.irisa.triskell.kermeta.interpreter/lib/"/>
	</target>
	
	<target name="create_km" 
			description="create the km file">
		<java classname="fr.irisa.triskell.kermeta.dev.framework.CompileFramework">
			<classpath refid="project.class.path"/>
		</java>
	</target>
	<target name="create_jar" 
		description="create the jar file">
		<tstamp/>
		<jar destfile="${kermeta.framework.jar}">
			<!-- files to include in the jar -->
			<fileset dir="build/class"/>
			<fileset dir="src/java"/>
			<!-- manifest to include -->
		    <manifest>
		    	<attribute name="Built-By" value="${user.name}"/>  
				<attribute name="Class-Path" value=""/>
		    	<section name="${ant.project.name}">
		      		<attribute name="Specification-Title" value="${ant.project.name}"/>
      				<attribute name="Specification-Version" value="${TSTAMP} ${TODAY}"/>
      				<attribute name="Specification-Vendor" value="Irisa/Triskell"/>
      				<attribute name="Implementation-Title" value="common"/>
      				<attribute name="Implementation-Version" value="${TSTAMP} ${TODAY}"/> 
      				<attribute name="Implementation-Vendor" value="Irisa/Triskell"/>
    			</section>
		    </manifest>
		</jar>
	</target>
</project>