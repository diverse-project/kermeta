@mainClass "testLoadEcoreFile::Main"
@mainOperation "main"


package testLoadEcoreFile;


require kermeta
require "platform:/plugin/fr.irisa.triskell.kermeta/lib/ecore.kmt"
using kermeta::persistence
using kermeta::standard
using ecore

class Main
{
    operation main() : Void is do 
        var inputModel : Set<ecore::EPackage> init loadClassModel
        

        
        stdio.write("Beg\\in\n tr\nuc")
        inputModel.each{ p | printPackageContent(p) }
        stdio.write("\nEnd\n")        
        
      
    end
    
    operation printPackageContent(aPackage : EPackage)  is do 
    	stdio.writeln("Package " + aPackage.name)
    	aPackage.eClassifiers.each{c | stdio.writeln(  "   Class " + c.name)}         
    end
    
    operation loadClassModel() : Set<EPackage> is do             
   		var repository : EMFRepository init EMFRepository.new             
   		//var resource : Resource init repository.createResource("platform:/resource/fr.irisa.triskell.kermeta.tests/test/interpreter/emf_testcases/instances/fsm.ecore","platform:/resource/fr.irisa.triskell.kermeta.tests/test/interpreter/emf_testcases/instances/Ecore.ecore")
		var resource : Resource init repository.createResource("platform:/resource/fr.irisa.triskell.kermeta.tests/test/interpreter/emf_testcases/instances/fsm.ecore","platform:/resource/fr.irisa.triskell.kermeta.tests/test/interpreter/emf_testcases/instances/Ecore.ecore")
   		resource.load()      
           	stdio.writeln(resource.toString)
      	stdio.writeln(resource.instances.toString)
      	stdio.writeln(resource.instances.size.toString)
       
       	result := Set<EPackage>.new
       	from var it : Iterator<Object> init resource.instances.iterator
       	until it.isOff
       	loop
           var next : Object init it.next
           if (EPackage.isInstance(next)) then 
           		var aPackage : EPackage 
           		aPackage ?= next
           		//stdio.writeln(aPackage.name)
           		result.add(aPackage)
           end
       	end     
   end
    
}