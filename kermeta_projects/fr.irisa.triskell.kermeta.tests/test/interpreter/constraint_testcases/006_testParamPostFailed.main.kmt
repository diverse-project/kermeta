/* $Id: 006_testParamPostFailed.main.kmt,v 1.3 2008-07-31 16:11:45 dvojtise Exp $
 * Creation date: January 23, 2007
 * License:
 * Copyright:
 * Authors:
 */
@mainClass "paramPostFailed::Main"
@mainOperation "main"


package paramPostFailed;


require kermeta

using kermeta::standard
using kermeta::exceptions
using kermeta::kunit

class Main inherits TestCase
{
	reference str : String
	
	operation main() : Void is do
    	var tr : TestRunner init TestRunner.new
		tr.run(Main)
		tr.printTestResult
    end
	
    operation test0() : Void is do 
       do
        	truc("bidule")
     	rescue (err : ConstraintViolatedPre)
        	stdio.writeln(err.toString)
        	stdio.writeln(err.message)
        	assert(false)
       	rescue (err : ConstraintViolatedPost)
       		stdio.writeln( "Exception catched" )
        	stdio.writeln(err.toString)
        	stdio.writeln(err.message)
        	assert(true)
       end
    end
    
    
    operation truc(param : String)  : String
    pre lapre is
    	param != "machin"
    post lapost is do str == param end
    is
    	do   	
        	stdio.writeln("test")
	        // to make the execution fail:
        	str := "not param's value"
			result := void

	end
     
}