/* $Id: trek2junit.kmt,v 1.2 2008-01-31 14:33:41 cfaucher Exp $
 * Creation date: Jan 30, 2008
 * License: EPL
 * Copyright: IRISA / INRIA / Universite de Rennes 1
 * Authors: Cyril Faucher <cfaucher@irisa.fr>
 */
@mainClass "org::kermeta::compiler::trek2docbook::Main"
@mainOperation "main"

package org::kermeta::compiler::trek2docbook;

require kermeta
require "http://www.kermeta.org/trek"

require "CompilerTestSuite.kmt"
require "CompilerUseCase.kmt"

using ecore
using kermeta::standard
using kermeta::persistence
using kermeta::language::structure
using kermeta::utils
using kermeta::io
using trek
using org::kermeta::compiler::trek2junit::kermeta

class Main
{

	/** Load the given UseKaseModel */
	operation load() : UseKaseModel is do
		var firstPackage : UseKaseModel init UseKaseModel.new
		var repository : EMFRepository init EMFRepository.new             

   		var resource : Resource init repository.getResource("platform:/resource/org.kermeta.compiler.tests/unit_test/unit_test.trek")
       	
       	stdio.writeln("Resource loading start")
       	resource.load()
		stdio.writeln("Resource loading end")
		result ?=resource.instances.one
	end

	/**
	 *
	 */
	operation main(generationFolder : String) : Void is do
	
		var useKaseModel : UseKaseModel init UseKaseModel.new
       	useKaseModel := load()
       	
       	var main_uc : KUseCase init KUseCase.new
       	main_uc := useKaseModel.kuseCases.detect{ uc |
       		uc.id == "comp_structure"
       	}
       	var content_uc : StringBuffer init StringBuffer.new
		content_uc.append(JUnitTestSuiteTemplate.new.generate(main_uc))
		    			
		var ioHelper_uc : FileIO init FileIO.new
		var filename_uc : String init generationFolder + "K" + main_uc.id + "TestSuite.java"
				           			
		ioHelper_uc.writeTextFile(filename_uc,content_uc.toString)


       	main_uc.refinedBy.each{ uc |
			var content : StringBuffer init StringBuffer.new
	       	content.append(JUnitUseCaseTemplate.new.generate(uc))
	       			
			var ioHelper : FileIO init FileIO.new
			var filename : String init generationFolder + "K" + uc.id + "UseCase.java"
			           			
			ioHelper.writeTextFile(filename,content.toString)
       	}
       	
		stdio.writeln("End of the generation of Test suite")

	end
}