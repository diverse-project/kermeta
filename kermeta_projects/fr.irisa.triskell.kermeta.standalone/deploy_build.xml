<!-- $Id: deploy_build.xml,v 1.2 2008-07-18 09:36:08 dvojtise Exp $ -->
<project name="kermeta_standalone" default="all" basedir=".">
        
    <description>
        Deploy the standalone version of kermeta
    </description>

	<property name="kermeta.plugins" location="../fr.irisa.triskell.kermeta.site/plugins/"/> <!-- version if you have buid the update site for kermeta -->
    <!-- <property name="kermeta.plugins" location="../../../deployedKermeta/eclipse/plugins/"/> --> <!-- version for daily build -->
     

    <target name="all"
		description="Deploy the standalone version of kermeta">
        <antcall target="copy"/>
		<antcall target="jardesc_like"/>
    </target>
	
	<target name="copy"
		description="copy the jar and kermeta models needed by the stand alone version">
		<unzip dest="./tmp">
			<fileset dir="${kermeta.plugins}" includes="**/fr.irisa.triskell.kermeta.io_*.jar"/>
			<fileset dir="${kermeta.plugins}" includes="**/fr.irisa.triskell.kermeta_*.jar"/>
		</unzip>
		<copy todir="./lib/" flatten="true">
			<fileset dir="./tmp/src/kermeta/" includes="framework.km"/>
			<fileset dir="./tmp/lib" includes="ecore.kmt"/>
		</copy>
		<copy todir="./lib/" flatten="true"> <!-- rename to traceability.jar -->
			<fileset dir="${kermeta.plugins}" includes="**/fr.irisa.triskell.traceability_*.jar"/>
		    <mapper type="merge" to="traceability.jar"/>
		</copy>
		<delete dir="./tmp"/>
	</target>
	
    <target name="jardesc_like" 
                description="create kermeta.jar from model, io and interpreter">
    	<unzip dest="./tmp">
			<fileset dir="${kermeta.plugins}" includes="**/fr.irisa.triskell.kermeta.io_*.jar"/>
			<fileset dir="${kermeta.plugins}" includes="**/fr.irisa.triskell.kermeta_*.jar"/>
			<fileset dir="${kermeta.plugins}" includes="**/fr.irisa.triskell.kermeta.interpreter_*.jar"/>
		</unzip>
		
		<copy todir="./kermeta/fr/irisa/triskell/utils">
			<fileset dir="./tmp/fr/irisa/triskell/utils"/>
		</copy>
		
		<copy todir="./kermeta/fr/irisa/triskell/kermeta">
			<fileset dir="./tmp/fr/irisa/triskell/kermeta"/>
		</copy>

		<copy todir="./kermeta/fr/irisa/triskell/ecore/visitor" flatten="true">
			<resources>
				<file file="./tmp/fr/irisa/triskell/kermeta/loader/ecore/EcoreVisitor.class"/>
			</resources>
		</copy>
		
		<delete file="./kermeta/fr/irisa/triskell/kermeta/loader/ecore/EcoreVisitor.class"/>

		<zip destfile="./dist/kermeta.jar"
		     basedir="./kermeta"
		     update="true"
		/>
		
		<delete dir="./tmp"/>
		<delete dir="./kermeta"/>
    </target>

</project>