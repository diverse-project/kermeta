<project name="build_kermeta_standaolne" default="all">

	<property name="env.WORKSPACE" location="."/>
	<property name="latest.full.kermeta.dir" location="latest_full_kermeta"/>
	<property name="dist.folder" location="dist"/>
	
	
	<target name="all" depends="build, test">
	</target>
	<target name="build" depends="clean, get_latest">
		<ant antfile="deploy_build.xml" 
			target="all"
			dir="imported_projects/fr.irisa.triskell.kermeta.standalone">
			<property name="kermeta.plugins" location="${latest.full.kermeta.dir}/eclipse/plugins"/>
		</ant>
		<mkdir dir="${dist.folder}"/>
		<zip destfile="${dist.folder}/kemeta_standalone_full.zip"
				     basedir="imported_projects/fr.irisa.triskell.kermeta.standalone/dist/all_in_one_jar"
				/>
		<zip destfile="${dist.folder}/kermeta_standalone_no_thirdparty_in_main_jar.zip"
						     basedir="imported_projects/fr.irisa.triskell.kermeta.standalone/dist/no_thirdparty_in_main_jar"
						/>
	</target>
	<target name="test" >
		<ant antfile="test_standalone_build.xml" 
					target="all"
					dir="imported_projects/org.kermeta.standalone.tests">
			<property name="dist.location" location="imported_projects/fr.irisa.triskell.kermeta.standalone/dist/no_thirdparty_in_main_jar"/>
			<!-- <property name="junit4.jar" location="imported_projects/fr.irisa.triskell.kermeta.standalone/lib/thirdparty/junit.jar"/>	-->
			<property name="junit4.jar" location="lib/junit.jar"/>
		</ant>
	</target>
	
	
	
	<target name="clean">
		<delete dir="${latest.full.kermeta.dir}/eclipse"></delete>
	</target>
	<target name="get_latest">	
		<mkdir dir="${latest.full.kermeta.dir}"/>			
		<get src="http://tipimouss.irisa.fr:8090/view/KermetaRelease/job/full_kermeta_studio_compile/lastSuccessfulBuild/artifact/full_kermeta_studio_compile/I.DevelopmentBuild/org.kermeta.studio.main.feature-DevelopmentBuild.zip" 
			dest="${latest.full.kermeta.dir}/org.kermeta.studio.main.feature-DevelopmentBuild.zip"
			usetimestamp="true"/>
		<unzip dest="${latest.full.kermeta.dir}">
		    <fileset dir="${latest.full.kermeta.dir}">
		        <include name="**/*.zip"/>
		    </fileset>
		</unzip>
	</target>
	
</project>