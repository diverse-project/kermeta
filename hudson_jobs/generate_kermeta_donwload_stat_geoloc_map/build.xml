<project name="build_eclipse_bases_for_kermeta" default="all">

	<property name="env.WORKSPACE" location="."/>
	<property name="simple.maven.osgi.file.deploy.url" value="http://tipimouss.irisa.fr/maven2-snapshots/org/kermeta/tools/tools.simple.maven.osgi.file.deploy/1.0.0-SNAPSHOT/tools.simple.maven.osgi.file.deploy-1.0.0-SNAPSHOT.jar"/>
	<property name="data.folder" location="${env.WORKSPACE}/data"/>
	<property name="deploy.server" value="web1.irisa.fr"/>
	<property name="deploy.user" value="web-triskell"/>
	<property name="deploy.path" value="/home/web/apache/sites/kermeta.org/htdocs/docs"/>
	
	
	<target name="all" depends="">
	    <antcall target="get_stat_raw_data"/>
	    <antcall target="generate_map"/>
	</target>	
	<target name="get_stat_raw_data">
		<echo>Step 1 - Retrieve latest version of the raw stat data</echo>
		<delete failonerror="false">
			<fileset dir="www.kermeta.org" includes="*"/>
		</delete>
		<!-- <mkdir dir="${data.folder}"/>-->
		<exec executable="wget" failonerror="true">
			<arg value="-nv"/>
			<arg value="-r"/>
			<arg value="-l"/><arg value="2"/>
			<arg value="-A"/><arg value="txt"/>
			<arg value="http://www.kermeta.org//awstats_data/kermeta_update/"/>
		</exec>
	</target>
	<target name="generate_map">
		<echo>Step 2 - Preparation of the map</echo>
		<exec executable="mvn" failonerror="true">
			<arg value="compile" />
			<arg value="exec:java" />
			<arg value="-e" />
			<arg value="-Dexec.mainClass=fr.inria.ipstat.geoloc.mapper.MapperCLI"/>
			<arg value="-Dexec.executableDependency=true"/>
			<!-- <arg value="-Dexec.args=www.kermeta.org/awstats_data/kermeta_update"/> -->
			<arg value="-Dexec.args=&quot;www.kermeta.org/awstats_data/kermeta_update/awstats032011.kermeta-org-update.txt&quot;&quot;"/>
		</exec>
		
	</target>
	<!-- <target name="publish_kml" >
			<scp todir="${deploy.user}@${deploy.server}:${deploy.path}/fr.irisa.triskell.kermeta.documentation/build"
				keyfile="${key.file}"
				passphrase=""
			    trust="yes">
			    <fileset dir="imported_projects/fr.irisa.triskell.kermeta.documentation/build">
			      		<include name="**/**"/>
				      	<exclude name="**/docboo42/**"/>
					  	<exclude name="**/eclipse.help/**"/>
			    </fileset>
			</scp>
		</target> -->
</project>