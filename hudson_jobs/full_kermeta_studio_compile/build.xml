<project name="build_kermeta_bases" default="all">

	<!-- initialize env with Hudson variable -->
	<property environment="env"/>
	
	<property name="env.WORKSPACE" location="."/>
	<property name="eclipse.native.version.name" value="linux_x86_64"/>
	<property name="equinox.jar.filename" value="org.eclipse.equinox.launcher_1.1.1.R36x_v20101122_1400.jar"/>
	<property name="pde.build.foldername" value="org.eclipse.pde.build_3.6.2.R36x_20110203"/>
	<property name="eclipse.workspace.dir" location="${env.WORKSPACE}/eclipseworkspace"/>	
	<property name="eclipse.build.dir" location="."/>
	<property name="eclipse.build.scripts.dir" location="./eclipse_build_scripts"/>
	
	<property name="studio.base.dir" location="${env.WORKSPACE}/studiobase/"/>
	<property name="studio.archive.extension" value="tar.gz"/>
	<property name="studio.base.url" value="http://tipimouss.irisa.fr:8090/job/provision_eclipse_helios_bases_for_kermeta/lastSuccessfulBuild/artifact/provision_eclipse_helios_bases_for_kermeta/build/kermeta_helios_linux_x86_64_base.${studio.archive.extension}"/>
	<property name="eclipse.bin.home" location="${studio.base.dir}/eclipse"/>
	
	<target name="all" depends="get_studio_base, compile">
		
	</target>

	<target name="get_studio_base">
		<ant antfile="get_studio_base_build.xml">
  			<property name="studio.base.url" value="${studio.base.url}"/>
  			<property name="archive.extension" value="${studio.archive.extension}"/>
			<property name="studio.base.dir" location="${studio.base.dir}"/>
		</ant>
	</target>

	
	<target name="compile" depends="unzip_external_sources, compile_eclipse_help">	
		<mkdir dir="${eclipse.workspace.dir}"/>
		<delete dir="./I.DevelopmentBuild"/>
		<java jar="${eclipse.bin.home}/plugins/${equinox.jar.filename}"
		           fork="true"
		           failonerror="true"
		           maxmemory="128m"
		           >
			<arg value="-application"/>
			<arg value="org.eclipse.ant.core.antRunner"/>
			<arg value="-buildfile"/>
			<arg value="${eclipse.bin.home}/plugins/${pde.build.foldername}/scripts/build.xml"/>
			<arg value="-data"/>
			<arg value="${eclipse.workspace.dir}"/>
			<arg value="-Dbuilder=${eclipse.build.scripts.dir}"/>
			<arg value="-DbuildDirectory=${eclipse.build.dir}"/>
			<!--<arg value="-Dcomponent=traceability"/>-->
			<!--<arg value="-Dpde.build.scripts=${eclipse.home}/plugins/org.eclipse.pde.build_3.4.1.R34x_v20080805/scripts"/>-->
			<arg value="-Dbase=${studio.base.dir}"/>
		</java>
	</target>
	
	<target name="unzip_external_sources">
		<ant dir="${eclipse.build.dir}/plugins/org.antlr.antlr2" antfile="unjar_build.xml">
		</ant>
		<ant dir="${eclipse.build.dir}/plugins/org.antlr.antlr3" antfile="unjar_build.xml">
		</ant>
	</target>
	
	<!-- build the eclipse help of the documentation plugins -->
	<target name="compile_eclipse_help">
		<!-- documentation from Kermeta main plugin -->
		
		<!-- <ant dir="${eclipse.build.dir}/plugins/fr.irisa.triskell.kermeta.ket.documentation/src" 
					antfile="KET_Manual_build.xml"	target ="eclipse.help"/> -->
	</target>
	
</project>