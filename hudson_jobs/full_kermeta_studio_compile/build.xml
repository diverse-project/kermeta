<project name="build_kermeta_bases" default="all">

	<!-- initialize env with Hudson variable -->
	<property environment="env"/>
	
	<property name="env.WORKSPACE" location="."/>
	<property name="eclipse.native.version.name" value="linux_x86_64"/>
	<property name="equinox.jar.filename" value="org.eclipse.equinox.launcher_1.0.201.R35x_v20090715.jar"/>
	<property name="pde.build.foldername" value="org.eclipse.pde.build_3.5.2.R35x_20100114"/>
	
	<property name="eclipse.workspace.dir" location="${env.WORKSPACE}/eclipseworkspace"/>	
	<property name="eclipse.build.dir" location="."/>
	<property name="eclipse.build.scripts.dir" location="./eclipse_build_scripts"/>
	
	<property name="studio.base.dir" location="${env.WORKSPACE}/studiobase/"/>
	<property name="studio.base.url" value="http://tipimouss.irisa.fr:8090/job/provision_eclipse_bases_for_kermeta/lastSuccessfulBuild/artifact/provision_eclipse_bases_for_kermeta/build/kermeta_linux_x86_64_base.zip"/>
	<property name="eclipse.bin.home" location="${studio.base.dir}/eclipse"/>
	
	<target name="all" depends="get_studio_base, compile">
		
	</target>

	<target name="get_studio_base">
		<ant antfile="get_studio_base_build.xml">
  			<property name="studio.base.url" value="${studio.base.url}"/>
			<property name="studio.base.dir" location="${env.WORKSPACE}/studiobase/"/>
		</ant>
	</target>

	
	<target name="compile" depends="unzip_external_sources, compile_eclipse_help">	
		<mkdir dir="${eclipse.workspace.dir}"/>
		<delete dir="./I.DevelopmentBuild"/>
		<java jar="${eclipse.bin.home}/plugins/${equinox.jar.filename}"
		           fork="true"
		           failonerror="true"
		           maxmemory="128m"
		           >
			<arg value="-application"/>
			<arg value="org.eclipse.ant.core.antRunner"/>
			<arg value="-buildfile"/>
			<arg value="${eclipse.bin.home}/plugins/${pde.build.foldername}/scripts/build.xml"/>
			<arg value="-data"/>
			<arg value="${eclipse.workspace.dir}"/>
			<arg value="-Dbuilder=${eclipse.build.scripts.dir}"/>
			<arg value="-DbuildDirectory=${eclipse.build.dir}"/>
			<!--<arg value="-Dcomponent=traceability"/>-->
			<!--<arg value="-Dpde.build.scripts=${eclipse.home}/plugins/org.eclipse.pde.build_3.4.1.R34x_v20080805/scripts"/>-->
			<arg value="-Dbase=${studio.base.dir}"/>
		</java>
	</target>
	
	<target name="unzip_external_sources">
		<ant dir="${eclipse.build.dir}/plugins/org.antlr.antlr2" antfile="unjar_build.xml">
		</ant>
	</target>
	
	<!-- build the eclipse help of the documentation plugins -->
	<target name="compile_eclipse_help">
		<!-- documentation from Kermeta main plugin -->
		<ant dir="${eclipse.build.dir}/plugins/fr.irisa.triskell.kermeta.documentation/src" 
			antfile="Kermeta-Manual_build.xml" target ="eclipse.help"/>
		<ant dir="${eclipse.build.dir}/plugins/fr.irisa.triskell.kermeta.documentation/src" 
			antfile="KerMeta-UI-UserGuide_build.xml" target ="eclipse.help"/>
		<ant dir="${eclipse.build.dir}/plugins/fr.irisa.triskell.kermeta.documentation/src" 
			antfile="KerMeta-how-to-install-KerMeta_build.xml" target ="eclipse.help"/>
		<ant dir="${eclipse.build.dir}/plugins/fr.irisa.triskell.kermeta.documentation/src" 
			antfile="Kermeta-MDK_build.xml"	target ="eclipse.help"/>
		<ant dir="${eclipse.build.dir}/plugins/fr.irisa.triskell.kermeta.documentation/src" 
			antfile="Kermeta-Tutorial-Process_build.xml"	target ="eclipse.help"/>		
		<ant dir="${eclipse.build.dir}/plugins/fr.irisa.triskell.kermeta.documentation/src" 
			antfile="Kermeta-Deploying-a-code_build.xml" target ="eclipse.help"/>
		<ant dir="${eclipse.build.dir}/plugins/fr.irisa.triskell.kermeta.documentation/src" 
			antfile="KermetaEMFTutorial_build.xml" target ="eclipse.help"/>
		<ant dir="${eclipse.build.dir}/plugins/fr.irisa.triskell.kermeta.documentation/src" 
			antfile="Kermeta-How-to-create-a-metamodel_build.xml" target ="eclipse.help"/>
		<ant dir="${eclipse.build.dir}/plugins/fr.irisa.triskell.kermeta.documentation/src" 
			antfile="Kermeta-How-to-add-behavior-to-a-metamodel_build.xml"	target ="eclipse.help"/>
		<ant dir="${eclipse.build.dir}/plugins/fr.irisa.triskell.kermeta.documentation/src" 
			antfile="Kermeta-How-to-use-run-configuration_build.xml"	target ="eclipse.help"/>
		
		<ant dir="${eclipse.build.dir}/plugins/fr.irisa.triskell.kermeta.ket.documentation/src" 
					antfile="KET_Manual_build.xml"	target ="eclipse.help"/>
		<ant dir="${eclipse.build.dir}/plugins/org.kermeta.ecore.documentation/src" 
					antfile="Ecore-MDK_build.xml"	target ="eclipse.help"/>
	</target>
	
</project>