@mainClass "tools_tests::ToolCloneOperationTestCase"
@mainOperation "test_CloneTool_Operation"

package tools_tests;


require kermeta
require "../../src/kermeta/transformations/UmlCloneFactory.kmt"

using uml2
using uml2::transformations

class ToolCloneOperationTestCase inherits kermeta::kunit::TestCase
{
	reference orig : Operation
	reference clone : Operation
	reference InClass : Class
	reference InOutClass : Class
	reference OutClass : Class
	reference ReturnClass : Class
	reference ExcClass : uml2::Type
	
	method setUp() is do
		//creating needed instances
		orig := Operation.new
		orig.name := "op"
		orig.visibility := VisibilityKind.private
		orig.isStatic := true
		
		var in : Parameter init Parameter.new
		in.name := "in"
		in.direction := ParameterDirectionKind.in
		InClass := Class.new
		in.type := InClass
		var inout : Parameter init Parameter.new
		inout.name := "inout"
		inout.direction := ParameterDirectionKind.inout
		InOutClass := Class.new
		inout.type := InOutClass
		var out : Parameter init Parameter.new
		out.name := "out"
		out.direction := ParameterDirectionKind.out
		OutClass := Class.new
		out.type := OutClass
		var ret : Parameter init Parameter.new
		ret.name := "ret"
		ret.direction := ParameterDirectionKind.return
		ReturnClass := Class.new
		ret.type := ReturnClass
		
		ExcClass :=  uml2::Class.new
		ExcClass.name := "exc"
		orig.raisedException.add(ExcClass)
		
		orig.ownedParameter.add(in)
		orig.ownedParameter.add(inout)
		orig.ownedParameter.add(out)
		orig.returnResult.add(ret)
		
		var factory : UmlCloneFactory init UmlCloneFactory.new
		clone := factory.cloneOperation(orig)
	end
	
	method tearDown() is do
		// We don't need to tearDown anything in this test case.
	end
    
    operation test_CloneTool_Operation() is do
    	assertTrueWithMsg(clone != void,
    		"the cloneOperation() method must return something")
    	assertTrueWithMsg(Operation.isInstance(clone),
    		"the object returned by cloneOperation() method must be a Operation")
    	assertTrueWithMsg(clone != orig,
    		"the clone object must be different than the original")
    end
    operation test_CloneTool_OperationProperties() is do
    	assertTrueWithMsg(clone.name == orig.name,
    		"the clone must be have the same name than the original")
    	assertTrueWithMsg(clone.visibility == VisibilityKind.private,
    		"the clone must be have the same visibility than the original")
    end
    operation test_CloneTool_OperationParameters() is do
    	assertTrueWithMsg(clone.ownedParameter.size == 3,
    		"the clone must be have the parameters of the original")
    	assertTrueWithMsg(clone.ownedParameter.elementAt(0).name == "in"
    		and clone.ownedParameter.elementAt(1).name == "inout"
    		and clone.ownedParameter.elementAt(2).name == "out",
    		"the clone parameter must be have the same name than the original")
    	assertTrueWithMsg(clone.ownedParameter.elementAt(0).type == InClass,
    		"the clone parameters must be have the same type than the original")
    	assertTrueWithMsg(clone.ownedParameter.elementAt(1).type == InOutClass,
    		"the clone parameters must be have the same type than the original")
    	assertTrueWithMsg(clone.ownedParameter.elementAt(2).type == OutClass,
    		"the clone parameters must be have the same type than the original")
    end
    operation test_CloneTool_OperationReturn() is do
    
    //DEBUG
    clone.returnResult.each{ p |
    stdio.writeln("DEBUG - test Oper : clone.returnResult = "+p.toString)}
    
    	assertTrueWithMsg(clone.returnResult.size == 1,
    		"the clone must be have the parameters of the original")
    	assertTrueWithMsg(clone.returnResult.elementAt(0).name == "ret",
    		"the clone parameter must be have the same name than the original")
    	assertTrueWithMsg(clone.returnResult.elementAt(0).type == ReturnClass,
    		"the clone parameters must be have the same type than the original")
    end
    operation test_CloneTool_OperationException() is do
    	assertTrueWithMsg(clone.raisedException.size == 1,
    		"the clone must be have the exceptions raised by the original")
    	assertTrueWithMsg(clone.raisedException.one.name == "exc",
    		"the clone exception must be have the same name than the original")
    	assertTrueWithMsg(clone.raisedException.one == ExcClass,
    		"the clone exception must be of the same type than the original")
    end
}