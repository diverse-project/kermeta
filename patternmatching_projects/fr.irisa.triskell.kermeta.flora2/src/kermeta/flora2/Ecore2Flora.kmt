/* $Id: Ecore2Flora.kmt,v 1.5 2007-07-26 12:40:07 bmorin Exp $
 * Creation date: October 4, 2006
 * License: EPL
 * Copyright:
 * Authors:
 */
 
 
package kermeta::flora2;

require kermeta

require "http://www.eclipse.org/emf/2002/Ecore"
require "platform:/lookup/fr.irisa.triskell.kermeta.flora2/src/kermeta/flora2/Ecore2FloraBasicElements.kmt"
//require "../../flora2/Flora2wVisitor.kmt"    
using kermeta::standard 
   
using ecore 
//using flora2::visitors  
  

class Ecore2Flora inherits Ecore2FloraBasicElements {

   /* Returns a set of clauses for a given metamodel. Each classifier (EClass or Datatype) 
    * of the metamodel is mapped into a CompoundedExpression with expressions for the declaration
    * of the type, features and operations.
    * The mapping of each class is delegated to transformClass
    */
   operation transformMetamodel(epackages: Sequence<EPackage>) : flora2::Clause[0..*] is do 
      var clauses : oset flora2::Clause[0..*] init OrderedSet<flora2::Clause>.new
      
      // FIXME : Deal with namespace while are creating clauses of the packages 
        
      epackages.each{ p | clauses.addAll (createClausesForPack(p))}  
      result := clauses    
   end
   
   operation createClausesForPack(epack: EPackage) : flora2::Clause[0..*] is do  
       var clauses : oset flora2::Clause[0..*] init OrderedSet<flora2::Clause>.new     
       var eclassifiers : EClassifier[0..*] init epack.eClassifiers
        //stdio.writeln("...creating facts related to the metamodel1")       
              
       eclassifiers.select{ e | EClass.isInstance(e)}.collect{ c| var eclass : EClass eclass ?=c}.
         each{c | clauses.add( createClauseForClassDeclaration(c))} 
      
       epack.eSubpackages.each{ p | clauses.addAll (createClausesForPack(p))}  
       result := clauses      
   end
}

 

