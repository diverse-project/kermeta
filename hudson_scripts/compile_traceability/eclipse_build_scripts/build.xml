<project default="main">

	<property name="pde.build.scripts" value="${basedir}/../org.eclipse.releng.basebuilder/plugins/org.eclipse.pde.build_3.0.0/scripts" />
	
	<target name="main">
		<touch file="${user.home}/.cvspass" />


		<!--Default values for required properties-->
		<property name="buildDirectory" value="${basedir}/src" />
		<condition property="baseLocation" value="${buildDirectory}/eclipse">
			<isset property="performance.base" />
		</condition>
		<available file="${buildDirectory}/label.properties" property="label.properties.exists" />
		<antcall target="create.label.properties" />
		<property file="${buildDirectory}/label.properties" />

		<!--fetch the HEAD stream of all projects if build type specified as N-->
		<condition property="fetchTag" value="HEAD">
			<equals arg1="${buildType}" arg2="N" />
		</condition>
		<property name="fetchTag" value="false" />
		

		<!--set the compiler and compiler arguments-->
		<!--the default compiler is set to the one used by eclipse rel. eng. -->
		<property name="build.compiler" value="org.eclipse.jdt.core.JDTCompilerAdapter" />
		<property name="compilerArg" value="-enableJavadoc -encoding ISO-8859-1 -nowarn" />
		<property name="javacSource" value="1.5" />
		<property name="javacTarget" value="1.5" />
		<property name="javacDebugInfo" value="true" />
		<property name="javacFailOnError" value="true" />
		<property name="noclean" value="true"/>

		<!--bootclasspath-->
		<path id="default.bootclasspath">
			<fileset dir="${java.home}/lib">
				<include name="*.jar" />
			</fileset>
		</path>
		<path id="mac.bootclasspath">
		    <fileset dir="${java.home}/..">
		        <include name="Classes/**/*.jar"/>
		    </fileset>
		</path>
		<property name="mac.bootclasspath" refid="mac.bootclasspath" />
		<condition property="bootclasspath" value="${mac.bootclasspath}" >
	     		<os family="mac"/>
	    </condition>
		<property name="bootclasspath" refid="default.bootclasspath" />

		<!--this property required as of Eclipse 3.0 stream builds > 20031126 -->
		<property name="buildingOSGi" value="true" />

		<!--run the build for the specified component-->
		<!--don't want to fetch ... <ant antfile="build.xml" dir="${pde.build.scripts}">
			<property name="builder" value="${basedir}/${component}" />
		</ant>-->
		<ant antfile="build.xml" dir="${pde.build.scripts}" target="generate">
			<property name="builder" value="${basedir}/${component}" />
		</ant>
		<ant antfile="build.xml" dir="${pde.build.scripts}" target="process">
			<property name="builder" value="${basedir}/${component}" />
		</ant>
		<ant antfile="build.xml" dir="${pde.build.scripts}" target="assemble">
			<property name="builder" value="${basedir}/${component}" />
		</ant>
		<ant antfile="build.xml" dir="${pde.build.scripts}" target="package">
			<property name="builder" value="${basedir}/${component}" />
		</ant>
		<ant antfile="build.xml" dir="${pde.build.scripts}" target="postBuild">
			<property name="builder" value="${basedir}/${component}" />
		</ant> 
		
	</target>
	
	<target name="create.label.properties" unless="label.properties.exists">
			<mkdir dir="${buildDirectory}" />
			<tstamp/>
			<property name="date" value="${DSTAMP}" />
			<property name="time" value="${TSTAMP}" />
			<property name="timestamp" value="${date}${time}" />
			<property name="buildType" value="I" />
			<property name="buildId" value="${buildType}${date}" />

			<!--this naming convention used by php scripts on download server-->
			<property name="buildLabel" value="${buildType}-${buildId}-${timestamp}" />

			<!--store the build label information in a file-->
			<echo file="${buildDirectory}/label.properties" append="true" >
			buildType=${buildType}
			</echo>
			<echo file="${buildDirectory}/label.properties" append="true" >
			buildId=${buildId}
			</echo>
			<echo file="${buildDirectory}/label.properties" append="true" >
			timestamp=${timestamp}
			</echo>
			<echo file="${buildDirectory}/label.properties" append="true" >
			buildLabel=${buildLabel}
			</echo>
		</target>

</project>
