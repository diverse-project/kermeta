/* 
 * Creation : July 7, 2008
 * Licence  : EPL 
 * Copyright: IRISA / INRIA Rennes
 * Authors  : Brice Morin, Equipe-Projet INRIA Triskell
 *            bmorin[at]irisa.fr
 *
 */
@mainClass "runtime2SCA::Main"
@mainOperation "main"


package runtime2SCA;


require kermeta
require "./system2composite.kmt"


using kermeta::standard
using kermeta::persistence
using kermeta::io
using art
using art::implem
using sca

class Main
{
	@main ""
	operation main() : Void is do
		var modelURI : String init "platform:/resource/CrisisManagement/3_FirePlanner_DefaultNotification_FireDepartment.art"
		var file : String init "C:/DiVAStudio/DiVAStudio_1.0.0/workspace/CrisisManagement/3_FirePlanner_DefaultNotification_FireDepartment.composite"
		
	 	mainWithParameter(modelURI, file)
	end
	
	operation mainWithParameter(modelURI : String, file : String) : Void is do
		
	 	var content : String
	 	var system : System init loadModel(EMFRepository.new, modelURI)
	
	 	var generator : SCA init SCA.new
	 	content := generator.generate(system) 
		stdio.write("Generating base configuration...")
		var fileWriter : FileIO init FileIO.new
		fileWriter.writeTextFile(file,content)
		stdio.write("OK!")
	end
	
	operation loadModel(repository : EMFRepository, model : String) : System is
	do
		var resource : Resource init repository.createResource(model, "http://art")
		resource.load
		result ?= resource.instances.one	
	end
}